<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="﻿
- Extract hourly, daily and monthly climate data from ECCC datamart In this post, we will see how to automatically download all weather data for one station from environment and climate change canada using Python librairies.
Here&rsquo;s the URL to get historical data.
We will use a daily updated list of Climate stations in the National Archive available on this link.
As usual, we import our python librairies:
import os import wget import numpy as np import shutil import xml.">

  
  <link rel="alternate" hreflang="en-us" href="/post/working_with_eccc_climate_data/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/working_with_eccc_climate_data/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/post/working_with_eccc_climate_data/">
  <meta property="og:title" content="ECCC climate data | GDueymes">
  <meta property="og:description" content="﻿
- Extract hourly, daily and monthly climate data from ECCC datamart In this post, we will see how to automatically download all weather data for one station from environment and climate change canada using Python librairies.
Here&rsquo;s the URL to get historical data.
We will use a daily updated list of Climate stations in the National Archive available on this link.
As usual, we import our python librairies:
import os import wget import numpy as np import shutil import xml."><meta property="og:image" content="/post/working_with_eccc_climate_data/featured.png">
  <meta property="twitter:image" content="/post/working_with_eccc_climate_data/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-03-10T09:38:17-07:00">
    
    <meta property="article:modified_time" content="2020-03-10T09:38:17-07:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/working_with_eccc_climate_data/"
  },
  "headline": "ECCC climate data",
  
  "image": [
    "/post/working_with_eccc_climate_data/featured.png"
  ],
  
  "datePublished": "2020-03-10T09:38:17-07:00",
  "dateModified": "2020-03-10T09:38:17-07:00",
  
  "author": {
    "@type": "Person",
    "name": "Guillaume Dueymes"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "GDueymes",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "﻿\n- Extract hourly, daily and monthly climate data from ECCC datamart In this post, we will see how to automatically download all weather data for one station from environment and climate change canada using Python librairies.\nHere\u0026rsquo;s the URL to get historical data.\nWe will use a daily updated list of Climate stations in the National Archive available on this link.\nAs usual, we import our python librairies:\nimport os import wget import numpy as np import shutil import xml."
}
</script>

  

  


  


  





  <title>ECCC climate data | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>ECCC climate data</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Mar 10, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  

  
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 409px;">
  <div style="position: relative">
    <img src="/post/working_with_eccc_climate_data/featured_hu1f4d54d86a98cf04d0fe202ebeb47ccb_80822_720x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>﻿</p>
<h2 id="--extract-hourly-daily-and-monthly-climate-data-from-eccc-datamart">- Extract hourly, daily and monthly climate data from ECCC datamart</h2>
<p>In this post, we will see how to automatically download all weather data for one station from environment and climate change canada using Python librairies.</p>
<p>Here&rsquo;s the  <a href="https://climate.weather.gc.ca/">URL</a> to get historical data.</p>
<p>We will use a daily updated list of Climate stations in the National Archive available on this <a href="https://drive.google.com/drive/folders/1WJCDEU34c60IfOnG4rv5EPZ4IhhW9vZH">link</a>.</p>
<p>As usual, we import our python librairies:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> wget
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> shutil
<span style="color:#f92672">import</span> xml.etree.ElementTree <span style="color:#f92672">as</span> ET
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
</code></pre></div><p>First, we can open and read the list of Climate stations using Pandas:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;J:/Donnees_Stations/Donnees_EC/Codes/Station_Inventory_EN.csv&#39;</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;,&#39;</span>, skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)
df<span style="color:#f92672">.</span>head()
</code></pre></div><pre><code>|    | Name                   | Province         |   Climate ID |   Station ID |   WMO ID |   TC ID |   Latitude (Decimal Degrees) |   Longitude (Decimal Degrees) |   Latitude |   Longitude |   Elevation (m) |   First Year |   Last Year |   HLY First Year |   HLY Last Year |   DLY First Year |   DLY Last Year |   MLY First Year |   MLY Last Year |
|---:|:-----------------------|:-----------------|-------------:|-------------:|---------:|--------:|-----------------------------:|------------------------------:|-----------:|------------:|----------------:|-------------:|------------:|-----------------:|----------------:|-----------------:|----------------:|-----------------:|----------------:|
|  0 | ACTIVE PASS            | BRITISH COLUMBIA |      1010066 |           14 |      nan |     nan |                        48.87 |                       -123.28 |  485200000 | -1231700000 |             4   |         1984 |        1996 |              nan |             nan |             1984 |            1996 |             1984 |            1996 |
|  1 | ALBERT HEAD            | BRITISH COLUMBIA |      1010235 |           15 |      nan |     nan |                        48.4  |                       -123.48 |  482400000 | -1232900000 |            17   |         1971 |        1995 |              nan |             nan |             1971 |            1995 |             1971 |            1995 |
|  2 | BAMBERTON OCEAN CEMENT | BRITISH COLUMBIA |      1010595 |           16 |      nan |     nan |                        48.58 |                       -123.52 |  483500000 | -1233100000 |            85.3 |         1961 |        1980 |              nan |             nan |             1961 |            1980 |             1961 |            1980 |
|  3 | BEAR CREEK             | BRITISH COLUMBIA |      1010720 |           17 |      nan |     nan |                        48.5  |                       -124    |  483000000 | -1240000000 |           350.5 |         1910 |        1971 |              nan |             nan |             1910 |            1971 |             1910 |            1971 |
|  4 | BEAVER LAKE            | BRITISH COLUMBIA |      1010774 |           18 |      nan |     nan |                        48.5  |                       -123.35 |  483000000 | -1232100000 |            61   |         1894 |        1952 |              nan |             nan |             1894 |            1952 |             1894 |            1952 |
</code></pre>
<p>In this Dataframe, we have all informations to select and work with climate stations:</p>
<ul>
<li>Name : name of the station</li>
<li>Province:  province of the station</li>
<li>Climate ID: Climate ID number</li>
<li>Station ID: Station ID number</li>
<li>Latitude: latitude of the station in decimal degrees</li>
<li>Longitude: longitude of the station in decimal degrees</li>
<li>First Year: first year of record</li>
<li>Last Year: last year of record</li>
<li>HLY First Year: first year of hourly record</li>
<li>HLY Last Year: last year of hourly record</li>
<li>DLY First Year: first year of daily record</li>
<li>DLY Last Year: last year of daily record</li>
<li>MLY First Year: first year of monthly record</li>
<li>MLY Last Year: last year of monthly record</li>
</ul>
<p>We can easily create 3 dataframes to distinguish hourly, daily and monthly datasets:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_hourly <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;Name&#39;</span>, <span style="color:#e6db74">&#39;Province&#39;</span>,<span style="color:#e6db74">&#39;Climate ID&#39;</span>,<span style="color:#e6db74">&#39;Station ID&#39;</span>,<span style="color:#e6db74">&#39;Latitude (Decimal Degrees)&#39;</span>,
              <span style="color:#e6db74">&#39;Longitude (Decimal Degrees)&#39;</span>,<span style="color:#e6db74">&#39;HLY First Year&#39;</span>,<span style="color:#e6db74">&#39;HLY Last Year&#39;</span>]]<span style="color:#f92672">.</span>dropna()

df_daily <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;Name&#39;</span>, <span style="color:#e6db74">&#39;Province&#39;</span>,<span style="color:#e6db74">&#39;Climate ID&#39;</span>,<span style="color:#e6db74">&#39;Station ID&#39;</span>,<span style="color:#e6db74">&#39;Latitude (Decimal Degrees)&#39;</span>,
              <span style="color:#e6db74">&#39;Longitude (Decimal Degrees)&#39;</span>,<span style="color:#e6db74">&#39;DLY First Year&#39;</span>,<span style="color:#e6db74">&#39;DLY Last Year&#39;</span>]]<span style="color:#f92672">.</span>dropna()

df_monthly <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#39;Name&#39;</span>, <span style="color:#e6db74">&#39;Province&#39;</span>,<span style="color:#e6db74">&#39;Climate ID&#39;</span>,<span style="color:#e6db74">&#39;Station ID&#39;</span>,<span style="color:#e6db74">&#39;Latitude (Decimal Degrees)&#39;</span>,
              <span style="color:#e6db74">&#39;Longitude (Decimal Degrees)&#39;</span>,<span style="color:#e6db74">&#39;MLY First Year&#39;</span>,<span style="color:#e6db74">&#39;MLY Last Year&#39;</span>]]<span style="color:#f92672">.</span>dropna()
</code></pre></div><p>We will use wget python command to download data using a specific path:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">wget<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=csv&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=01&amp;Day=14&amp;timeframe=1&#39;</span>)
</code></pre></div><p>With:</p>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">year</td>
<td align="right">year of the record</td>
</tr>
<tr>
<td align="right">month</td>
<td align="right">month of the record</td>
</tr>
<tr>
<td align="right">format</td>
<td align="right">[csv</td>
</tr>
<tr>
<td align="right">timeframe = 1</td>
<td align="right">for hourly data</td>
</tr>
<tr>
<td align="right">timeframe = 2</td>
<td align="right">for daily data</td>
</tr>
<tr>
<td align="right">timeframe = 3</td>
<td align="right">for monthly data</td>
</tr>
</tbody>
</table>
<pre><code>- Day: the value of the &quot;day&quot; variable is not used and can be an arbitrary value
- For another station, change the value of the variable stationID
- For the data in XML format, change the value of the variable format to xml in the URL.
</code></pre>
<h3 id="1--working-with-hourly-data">1- Working with hourly data:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_hourly<span style="color:#f92672">.</span>head()
</code></pre></div><pre><code>|    | Name              | Province         |   Climate ID |   Station ID |   Latitude (Decimal Degrees) |   Longitude (Decimal Degrees) |   HLY First Year |   HLY Last Year |
|---:|:------------------|:-----------------|-------------:|-------------:|-----------------------------:|------------------------------:|-----------------:|----------------:|
| 28 | DISCOVERY ISLAND  | BRITISH COLUMBIA |      1012475 |        27226 |                        48.42 |                       -123.23 |             1997 |            2020 |
| 39 | ESQUIMALT HARBOUR | BRITISH COLUMBIA |      1012710 |           52 |                        48.43 |                       -123.44 |             1994 |            2020 |
| 49 | KELP REEFS        | BRITISH COLUMBIA |      1013998 |        10853 |                        48.55 |                       -123.24 |             1997 |            2020 |
| 53 | MALAHAT           | BRITISH COLUMBIA |      1014818 |        10730 |                        48.58 |                       -123.58 |             1991 |            1992 |
| 54 | MALAHAT           | BRITISH COLUMBIA |      1014820 |           65 |                        48.57 |                       -123.53 |             1994 |            2020 |
</code></pre>
<p>We want to extract hourly observations from DISCOVERY ISLAND in 2019. So we will select id_stat = 27226, year = 2019 and timeframe = 1 .</p>
<h3 id="--we-want-to-work-in-csv-format">- We want to work in csv format.</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">id_stat <span style="color:#f92672">=</span> <span style="color:#ae81ff">27226</span>
year <span style="color:#f92672">=</span> <span style="color:#ae81ff">2019</span>
wget<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=csv&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=01&amp;Day=14&amp;timeframe=1&#39;</span>)
</code></pre></div><pre><code>'en_climate_hourly_BC_1012475_001-2019_P1H.csv'
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;en_climate_hourly_BC_1012475_001-2019_P1H.csv&#39;</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;,&#39;</span>, skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
df<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">2</span>)
</code></pre></div><pre><code>|    |   Longitude (x) |   Latitude (y) | Station Name     |   Climate ID | Date/Time        |   Year |   Month |   Day | Time   |   Temp (°C) |   Temp Flag |   Dew Point Temp (°C) |   Dew Point Temp Flag |   Rel Hum (%) |   Rel Hum Flag |   Wind Dir (10s deg) |   Wind Dir Flag |   Wind Spd (km/h) |   Wind Spd Flag |   Visibility (km) |   Visibility Flag |   Stn Press (kPa) |   Stn Press Flag |   Hmdx |   Hmdx Flag |   Wind Chill |   Wind Chill Flag |   Weather |
|---:|----------------:|---------------:|:-----------------|-------------:|:-----------------|-------:|--------:|------:|:-------|------------:|------------:|----------------------:|----------------------:|--------------:|---------------:|---------------------:|----------------:|------------------:|----------------:|------------------:|------------------:|------------------:|-----------------:|-------:|------------:|-------------:|------------------:|----------:|
|  0 |         -123.23 |          48.42 | DISCOVERY ISLAND |      1012475 | 2019-01-01 00:00 |   2019 |       1 |     1 | 00:00  |         5.2 |         nan |                   0.7 |                   nan |            73 |            nan |                   17 |             nan |                 5 |             nan |               nan |               nan |            102.87 |              nan |    nan |         nan |          nan |               nan |       nan |
|  1 |         -123.23 |          48.42 | DISCOVERY ISLAND |      1012475 | 2019-01-01 01:00 |   2019 |       1 |     1 | 01:00  |         5.2 |         nan |                   0.7 |                   nan |            72 |            nan |                   17 |             nan |                 5 |             nan |               nan |               nan |            102.87 |              nan |    nan |         nan |          nan |               nan |       nan |
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">url_template <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://climate.weather.gc.ca/climateData/bulkdata_e.html?format=csv&amp;stationID=5415&amp;Year={year}&amp;Month={month}&amp;timeframe=1&amp;submit=Download+Data&#34;</span>
url_template
</code></pre></div><pre><code>'http://climate.weather.gc.ca/climateData/bulkdata_e.html?format=csv&amp;stationID=5415&amp;Year={year}&amp;Month={month}&amp;timeframe=1&amp;submit=Download+Data'
</code></pre>
<h3 id="--if-we-work-in-xml-format">- If we work in xml format:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tmp_file <span style="color:#f92672">=</span> wget<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=01&amp;Day=14&amp;timeframe=1&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tree<span style="color:#f92672">=</span>ET<span style="color:#f92672">.</span>parse(tmp_file)
os<span style="color:#f92672">.</span>remove(tmp_file)
root<span style="color:#f92672">=</span>tree<span style="color:#f92672">.</span>getroot()
</code></pre></div><p>Here is the structure of xml file and informations we could find in &lsquo;stationinformation&rsquo; child:</p>
<p><img src="image1.png" alt="png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">stationsinfo<span style="color:#f92672">=</span>root<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;stationinformation&#39;</span>)

stationsinfo[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#39;latitude&#39;</span>, stationsinfo[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>text, <span style="color:#e6db74">&#39;longitude&#39;</span>, stationsinfo[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">.</span>text
<span style="color:#75715e">###############################################################</span>
<span style="color:#75715e">######### stationsinfo[0].text : station name</span>
<span style="color:#75715e">######### stationsinfo[1].text : province</span>
<span style="color:#75715e">######### stationsinfo[2].text : provider</span>
<span style="color:#75715e">######### stationsinfo[3].text : latitude  </span>
<span style="color:#75715e">######### stationsinfo[4].text : longitude</span>
</code></pre></div><pre><code>('DISCOVERY ISLAND', 'latitude', '48.42', 'longitude', '-123.23')
</code></pre>
<p>Climate records are available in &lsquo;station data&rsquo; child:</p>
<p><img src="image2.png" alt="png">
Let&rsquo;s extract Temperature data for one year:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">stationsdata <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#39;.//stationdata&#39;</span>)
result <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span>  stationdata <span style="color:#f92672">in</span> stationsdata    :<span style="color:#75715e"># loop over hourly values or child </span>
    champs<span style="color:#f92672">=</span>stationdata<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;temp&#39;</span>) 
    tmp<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>array(result,<span style="color:#e6db74">&#34;float&#34;</span>)  
    result<span style="color:#f92672">.</span>append(champs<span style="color:#f92672">.</span>text)   
    tmp<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>array(result,<span style="color:#e6db74">&#34;float&#34;</span>)   
</code></pre></div><p>To loop over years available for this station:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">id_stat <span style="color:#f92672">=</span> <span style="color:#ae81ff">27226</span>
yi <span style="color:#f92672">=</span> <span style="color:#ae81ff">2015</span>
yf <span style="color:#f92672">=</span><span style="color:#ae81ff">2020</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataset <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> year <span style="color:#f92672">in</span> range(yi,yf<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):    <span style="color:#75715e">### loop over years</span>
    <span style="color:#66d9ef">for</span> month <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">13</span>):
        tmp_file <span style="color:#f92672">=</span> wget<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=&#39;</span><span style="color:#f92672">+</span>str(month)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Day=14&amp;timeframe=1&#39;</span>)
        tree<span style="color:#f92672">=</span>ET<span style="color:#f92672">.</span>parse(tmp_file)
        os<span style="color:#f92672">.</span>remove(tmp_file)
        root<span style="color:#f92672">=</span>tree<span style="color:#f92672">.</span>getroot()       
        stationsdata <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#39;.//stationdata&#39;</span>)
        temperature <span style="color:#f92672">=</span> []  
        date  <span style="color:#f92672">=</span> []
        data  <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span>  stationdata <span style="color:#f92672">in</span> stationsdata: 
            date<span style="color:#f92672">.</span>append(stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;year&#39;</span>]<span style="color:#f92672">+</span>
                        <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">+</span>stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;month&#39;</span>]<span style="color:#f92672">+</span>
                        <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">+</span>stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;day&#39;</span>]<span style="color:#f92672">+</span> 
                        <span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">+</span>stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;hour&#39;</span>]<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;:00&#39;</span>)                  
            champs<span style="color:#f92672">=</span>stationdata<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;temp&#39;</span>)
            tmp <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(champs<span style="color:#f92672">.</span>text,<span style="color:#e6db74">&#34;float&#34;</span>)
            <span style="color:#66d9ef">if</span>  tmp <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;nan&#39;</span>:
                temperature<span style="color:#f92672">.</span>append(np<span style="color:#f92672">.</span>nan)
            <span style="color:#66d9ef">else</span>:   
                temperature<span style="color:#f92672">.</span>append(tmp)   <span style="color:#75715e">#  loop over days in one year</span>

        data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;date&#39;</span>:date, 
                <span style="color:#e6db74">&#39;air_temperature&#39;</span>:temperature} 
        data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(data)
        dataset<span style="color:#f92672">.</span>append(data)
dataset <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat(dataset)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tabulate <span style="color:#f92672">import</span> tabulate
<span style="color:#66d9ef">print</span>(tabulate(dataset<span style="color:#f92672">.</span>head(), headers<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;keys&#39;</span>, tablefmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pipe&#39;</span>))
</code></pre></div><pre><code>|    | date          |   air_temperature |
|---:|:--------------|------------------:|
|  0 | 2015-1-1 0:00 |               3   |
|  1 | 2015-1-1 1:00 |               2.9 |
|  2 | 2015-1-1 2:00 |               3   |
|  3 | 2015-1-1 3:00 |               3.1 |
|  4 | 2015-1-1 4:00 |               3.1 |
</code></pre>
<p>To save our dataframe into csv format:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataset<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#34;./Hourly_dataset.csv&#34;</span>, index <span style="color:#f92672">=</span> False, header <span style="color:#f92672">=</span> True, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;,&#39;</span>)
</code></pre></div><p>We Can make  quick plot using  plotly.express:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> plotly.express <span style="color:#f92672">as</span> px
<span style="color:#f92672">import</span> plotly
fig <span style="color:#f92672">=</span> px<span style="color:#f92672">.</span>line(dataset, x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;date&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;air_temperature&#39;</span>)
fig<span style="color:#f92672">.</span>update_layout(title_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Hourly temperature record&#39;</span>,
                  xaxis_rangeslider_visible<span style="color:#f92672">=</span>True)
</code></pre></div><p><img src="file1.png" alt="png">
Follow this <a href="http://www.guillaumedueymes.com/Plotly_plots/file1.html">link</a> for interactive plot:</p>
<p>To save our file in html:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> plotly.io <span style="color:#f92672">as</span> pio
pio<span style="color:#f92672">.</span>write_html(fig, file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;file1.html&#39;</span>, auto_open <span style="color:#f92672">=</span> True)
</code></pre></div><p>To save our file in png:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig<span style="color:#f92672">.</span>write_image(<span style="color:#e6db74">&#34;file1.png&#34;</span>)
</code></pre></div><h3 id="2--working-with-daily-data">2- Working with daily data:</h3>
<p>We will do the same job with daily mean temperature for one Climate station:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_daily<span style="color:#f92672">.</span>head()
</code></pre></div><pre><code>|    | Name                   | Province         |   Climate ID |   Station ID |   Latitude (Decimal Degrees) |   Longitude (Decimal Degrees) |   DLY First Year |   DLY Last Year |
|---:|:-----------------------|:-----------------|-------------:|-------------:|-----------------------------:|------------------------------:|-----------------:|----------------:|
|  0 | ACTIVE PASS            | BRITISH COLUMBIA |      1010066 |           14 |                        48.87 |                       -123.28 |             1984 |            1996 |
|  1 | ALBERT HEAD            | BRITISH COLUMBIA |      1010235 |           15 |                        48.4  |                       -123.48 |             1971 |            1995 |
|  2 | BAMBERTON OCEAN CEMENT | BRITISH COLUMBIA |      1010595 |           16 |                        48.58 |                       -123.52 |             1961 |            1980 |
|  3 | BEAR CREEK             | BRITISH COLUMBIA |      1010720 |           17 |                        48.5  |                       -124    |             1910 |            1971 |
|  4 | BEAVER LAKE            | BRITISH COLUMBIA |      1010774 |           18 |                        48.5  |                       -123.35 |             1894 |            1952 |
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tmp_file <span style="color:#f92672">=</span> wget<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=01&amp;Day=14&amp;timeframe=2&#39;</span>)
tree<span style="color:#f92672">=</span>ET<span style="color:#f92672">.</span>parse(tmp_file)
os<span style="color:#f92672">.</span>remove(tmp_file)
root<span style="color:#f92672">=</span>tree<span style="color:#f92672">.</span>getroot()
</code></pre></div><p>Here is the structure of xml file and informations we could find in &lsquo;stationinformation&rsquo; child:</p>
<p><img src="image1.png" alt="png"></p>
<p>Climate records are available in &lsquo;station data&rsquo; child:</p>
<p><img src="image3.png" alt="png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">url_template <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=01&amp;Day=14&amp;timeframe=2&#39;</span>
url_template
</code></pre></div><pre><code>'http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=5415&amp;Year=2020&amp;Month=01&amp;Day=14&amp;timeframe=2'
</code></pre>
<p>We want to extract 4 specific years for Climate station with ID=27226:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">id_stat <span style="color:#f92672">=</span> <span style="color:#ae81ff">27226</span>
df_daily[df_daily[<span style="color:#e6db74">&#39;Station ID&#39;</span>] <span style="color:#f92672">==</span> id_stat][<span style="color:#e6db74">&#39;DLY First Year&#39;</span>]
yi <span style="color:#f92672">=</span> <span style="color:#ae81ff">2015</span>
yf <span style="color:#f92672">=</span> <span style="color:#ae81ff">2020</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataset <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> year <span style="color:#f92672">in</span> range(yi,yf<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):    <span style="color:#75715e">### loop over years</span>
        tmp_file <span style="color:#f92672">=</span> wget<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=1&amp;Day=14&amp;timeframe=2&#39;</span>)
        tree<span style="color:#f92672">=</span>ET<span style="color:#f92672">.</span>parse(tmp_file)
        os<span style="color:#f92672">.</span>remove(tmp_file)
        root<span style="color:#f92672">=</span>tree<span style="color:#f92672">.</span>getroot()       
        stationsdata <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#39;.//stationdata&#39;</span>)
        temperature <span style="color:#f92672">=</span> []  
        date  <span style="color:#f92672">=</span> []
        data  <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span>  stationdata <span style="color:#f92672">in</span> stationsdata: 
            date<span style="color:#f92672">.</span>append(stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;year&#39;</span>]<span style="color:#f92672">+</span>
                        <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">+</span>stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;month&#39;</span>]<span style="color:#f92672">+</span>
                        <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">+</span>stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;day&#39;</span>])                  
            champs<span style="color:#f92672">=</span>stationdata<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;meantemp&#39;</span>)
            tmp <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(champs<span style="color:#f92672">.</span>text,<span style="color:#e6db74">&#34;float&#34;</span>)
            <span style="color:#66d9ef">if</span>  tmp <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;nan&#39;</span>:
                temperature<span style="color:#f92672">.</span>append(np<span style="color:#f92672">.</span>nan)
            <span style="color:#66d9ef">else</span>:   
                temperature<span style="color:#f92672">.</span>append(tmp)   <span style="color:#75715e">#  loop over days in one year</span>

        data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;date&#39;</span>:date, 
                <span style="color:#e6db74">&#39;temperature&#39;</span>:temperature} 
        data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(data)
        dataset<span style="color:#f92672">.</span>append(data)
dataset <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat(dataset)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataset<span style="color:#f92672">.</span>head()
</code></pre></div><pre><code>|    | date     |   temperature |
|---:|:---------|--------------:|
|  0 | 2015-1-1 |           nan |
|  1 | 2015-1-2 |           nan |
|  2 | 2015-1-3 |           nan |
|  3 | 2015-1-4 |           nan |
|  4 | 2015-1-5 |           nan |
</code></pre>
<p>We Can make  quick plot using  plotly.express:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> plotly.express <span style="color:#f92672">as</span> px
fig <span style="color:#f92672">=</span> px<span style="color:#f92672">.</span>line(dataset, x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;date&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;temperature&#39;</span>)
fig<span style="color:#f92672">.</span>update_layout(title_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Time Series with Rangeslider&#39;</span>,
                  xaxis_rangeslider_visible<span style="color:#f92672">=</span>True)
</code></pre></div><p><img src="file2.png" alt="png">
Follow this <a href="http://www.guillaumedueymes.com/Plotly_plots/file2.html">link</a> for interactive plot:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataset<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#34;./Daily_dataset.csv&#34;</span>, index <span style="color:#f92672">=</span> False, header <span style="color:#f92672">=</span> True, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;,&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> plotly.io <span style="color:#f92672">as</span> pio
pio<span style="color:#f92672">.</span>write_html(fig, file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;file2.html&#39;</span>, auto_open <span style="color:#f92672">=</span> True)
fig<span style="color:#f92672">.</span>write_image(<span style="color:#e6db74">&#34;file2.png&#34;</span>)
</code></pre></div><h3 id="3--working-with-monthly-data">3- Working with monthly data:</h3>
<p>We will do the same job with monthly total precipitation for one Climate station:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_monthly<span style="color:#f92672">.</span>head()
</code></pre></div><pre><code>|    | Name                   | Province         |   Climate ID |   Station ID |   Latitude (Decimal Degrees) |   Longitude (Decimal Degrees) |   MLY First Year |   MLY Last Year |
|---:|:-----------------------|:-----------------|-------------:|-------------:|-----------------------------:|------------------------------:|-----------------:|----------------:|
|  0 | ACTIVE PASS            | BRITISH COLUMBIA |      1010066 |           14 |                        48.87 |                       -123.28 |             1984 |            1996 |
|  1 | ALBERT HEAD            | BRITISH COLUMBIA |      1010235 |           15 |                        48.4  |                       -123.48 |             1971 |            1995 |
|  2 | BAMBERTON OCEAN CEMENT | BRITISH COLUMBIA |      1010595 |           16 |                        48.58 |                       -123.52 |             1961 |            1980 |
|  3 | BEAR CREEK             | BRITISH COLUMBIA |      1010720 |           17 |                        48.5  |                       -124    |             1910 |            1971 |
|  4 | BEAVER LAKE            | BRITISH COLUMBIA |      1010774 |           18 |                        48.5  |                       -123.35 |             1894 |            1952 |
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tmp_file <span style="color:#f92672">=</span> wget<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=01&amp;Day=14&amp;timeframe=3&#39;</span>)
url_template <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Month=01&amp;Day=14&amp;timeframe=3&#39;</span>
url_template
tree<span style="color:#f92672">=</span>ET<span style="color:#f92672">.</span>parse(tmp_file)
os<span style="color:#f92672">.</span>remove(tmp_file)
root<span style="color:#f92672">=</span>tree<span style="color:#f92672">.</span>getroot()
url_template
</code></pre></div><pre><code>'http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=27226&amp;Year=2020&amp;Month=01&amp;Day=14&amp;timeframe=3'
</code></pre>
<p>Climate records are available in &lsquo;station data&rsquo; child:</p>
<p><img src="image4.png" alt="png"></p>
<p>We want to dowload monthly total precipitation for Climate station with ID=5415.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">id_stat <span style="color:#f92672">=</span> <span style="color:#ae81ff">5415</span>
df_monthly[df_monthly[<span style="color:#e6db74">&#39;Station ID&#39;</span>] <span style="color:#f92672">==</span> id_stat][<span style="color:#e6db74">&#39;MLY First Year&#39;</span>]
yi <span style="color:#f92672">=</span> int(df_monthly[df_monthly[<span style="color:#e6db74">&#39;Station ID&#39;</span>] <span style="color:#f92672">==</span> id_stat][<span style="color:#e6db74">&#39;MLY First Year&#39;</span>]<span style="color:#f92672">.</span>values)
yf <span style="color:#f92672">=</span> int(df_monthly[df_monthly[<span style="color:#e6db74">&#39;Station ID&#39;</span>] <span style="color:#f92672">==</span> id_stat][<span style="color:#e6db74">&#39;MLY Last Year&#39;</span>]<span style="color:#f92672">.</span>values)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataset <span style="color:#f92672">=</span> []

tmp_file <span style="color:#f92672">=</span> wget<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=&#39;</span><span style="color:#f92672">+</span>str(int(id_stat))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;Year=2020&amp;Month=1&amp;Day=14&amp;timeframe=3&#39;</span>)
tree<span style="color:#f92672">=</span>ET<span style="color:#f92672">.</span>parse(tmp_file)
os<span style="color:#f92672">.</span>remove(tmp_file)
root<span style="color:#f92672">=</span>tree<span style="color:#f92672">.</span>getroot()       
stationsdata <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#39;.//stationdata&#39;</span>)
totprecip <span style="color:#f92672">=</span> []  
date  <span style="color:#f92672">=</span> []
data  <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span>  stationdata <span style="color:#f92672">in</span> stationsdata: 
    date<span style="color:#f92672">.</span>append(stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;year&#39;</span>]<span style="color:#f92672">+</span>
                        <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">+</span>stationdata<span style="color:#f92672">.</span>attrib[<span style="color:#e6db74">&#39;month&#39;</span>])                  
    champs<span style="color:#f92672">=</span>stationdata<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#39;totprecip&#39;</span>)
    tmp <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(champs<span style="color:#f92672">.</span>text,<span style="color:#e6db74">&#34;float&#34;</span>)
    <span style="color:#66d9ef">if</span>  tmp <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;nan&#39;</span>:
        totprecip<span style="color:#f92672">.</span>append(np<span style="color:#f92672">.</span>nan)
    <span style="color:#66d9ef">else</span>:   
        totprecip<span style="color:#f92672">.</span>append(tmp)   <span style="color:#75715e">#  loop over days in one year</span>

    data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;date&#39;</span>:date, 
                <span style="color:#e6db74">&#39;totprecip&#39;</span>:totprecip} 
    data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(data)
    dataset<span style="color:#f92672">.</span>append(data)
dataset <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat(dataset)
dataset <span style="color:#f92672">=</span> dataset<span style="color:#f92672">.</span>drop_duplicates(<span style="color:#e6db74">&#39;date&#39;</span>,keep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;last&#39;</span>)
dataset[<span style="color:#e6db74">&#39;date&#39;</span>]  <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(dataset[<span style="color:#e6db74">&#39;date&#39;</span>], format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%Y-%m&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> plotly.graph_objects <span style="color:#f92672">as</span> go
fig <span style="color:#f92672">=</span> go<span style="color:#f92672">.</span>Figure(data<span style="color:#f92672">=</span>[
    go<span style="color:#f92672">.</span>Bar(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;totprecip1&#39;</span>, 
           x<span style="color:#f92672">=</span>dataset[dataset[<span style="color:#e6db74">&#39;date&#39;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>month <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>][<span style="color:#e6db74">&#39;date&#39;</span>], 
           y<span style="color:#f92672">=</span>dataset[dataset[<span style="color:#e6db74">&#39;date&#39;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>month <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>][<span style="color:#e6db74">&#39;totprecip&#39;</span>])    
])
fig<span style="color:#f92672">.</span>update_layout(
    title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;July monthly precipitation&#39;</span>,
    xaxis_tickfont_size<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>,
    yaxis<span style="color:#f92672">=</span>dict(
        title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Total precipitation (mm)&#39;</span>,
        titlefont_size<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>,
        tickfont_size<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>,
    ),
    barmode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;group&#39;</span>,
    bargap<span style="color:#f92672">=</span><span style="color:#ae81ff">0.15</span>, <span style="color:#75715e"># gap between bars of adjacent location coordinates.</span>
    bargroupgap<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span> <span style="color:#75715e"># gap between bars of the same location coordinate.</span>
)
</code></pre></div><p><img src="file3.png" alt="png">
Follow this <a href="http://www.guillaumedueymes.com/Plotly_plots/file3.html">link</a> for interactive plot.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataset[dataset[<span style="color:#e6db74">&#39;date&#39;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>month <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>]<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#34;./Monthly_dataset.csv&#34;</span>, index <span style="color:#f92672">=</span> False, header <span style="color:#f92672">=</span> True, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;,&#39;</span>)
<span style="color:#f92672">import</span> plotly.io <span style="color:#f92672">as</span> pio
pio<span style="color:#f92672">.</span>write_html(fig, file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;file2.html&#39;</span>, auto_open <span style="color:#f92672">=</span> True)
fig<span style="color:#f92672">.</span>write_image(<span style="color:#e6db74">&#34;file2.png&#34;</span>)
</code></pre></div>
    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/working_with_eccc_climate_data/&amp;text=ECCC%20climate%20data" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/working_with_eccc_climate_data/&amp;t=ECCC%20climate%20data" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=ECCC%20climate%20data&amp;body=/post/working_with_eccc_climate_data/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/working_with_eccc_climate_data/&amp;title=ECCC%20climate%20data" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=ECCC%20climate%20data%20/post/working_with_eccc_climate_data/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/working_with_eccc_climate_data/&amp;title=ECCC%20climate%20data" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hued2496a182fbb6fc8c711157078d29a6_5348924_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Guillaume Dueymes</a></h5>
      <h6 class="card-subtitle">Data Scientist and Research Assistant</h6>
      <p class="card-text">My research interests include data science, data management and climate science.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Guillaume_Dueymes" target="_blank" rel="noopener">
        <i class="fab fa-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/guimeto" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
