<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="﻿
- Extract hourly, daily and monthly climate data from ECCC datamart In this post, we will see how to automatically download all weather data for one station from environment and climate change canada using Python librairies.
Here&rsquo;s the URL to get historical data.
We will use a daily updated list of Climate stations in the National Archive available on this link.
As usual, we import our python librairies:">

  
  <link rel="alternate" hreflang="en-us" href="/post/working_with_eccc_climate_data/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/working_with_eccc_climate_data/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/post/working_with_eccc_climate_data/">
  <meta property="og:title" content="ECCC climate data | GDueymes">
  <meta property="og:description" content="﻿
- Extract hourly, daily and monthly climate data from ECCC datamart In this post, we will see how to automatically download all weather data for one station from environment and climate change canada using Python librairies.
Here&rsquo;s the URL to get historical data.
We will use a daily updated list of Climate stations in the National Archive available on this link.
As usual, we import our python librairies:"><meta property="og:image" content="/post/working_with_eccc_climate_data/featured.png">
  <meta property="twitter:image" content="/post/working_with_eccc_climate_data/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-03-10T09:38:17-07:00">
    
    <meta property="article:modified_time" content="2020-03-10T09:38:17-07:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/working_with_eccc_climate_data/"
  },
  "headline": "ECCC climate data",
  
  "image": [
    "/post/working_with_eccc_climate_data/featured.png"
  ],
  
  "datePublished": "2020-03-10T09:38:17-07:00",
  "dateModified": "2020-03-10T09:38:17-07:00",
  
  "author": {
    "@type": "Person",
    "name": "Guillaume Dueymes"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "GDueymes",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "﻿\n- Extract hourly, daily and monthly climate data from ECCC datamart In this post, we will see how to automatically download all weather data for one station from environment and climate change canada using Python librairies.\nHere\u0026rsquo;s the URL to get historical data.\nWe will use a daily updated list of Climate stations in the National Archive available on this link.\nAs usual, we import our python librairies:"
}
</script>

  

  


  


  





  <title>ECCC climate data | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>ECCC climate data</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Mar 10, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  

  
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 409px;">
  <div style="position: relative">
    <img src="/post/working_with_eccc_climate_data/featured_hu1f4d54d86a98cf04d0fe202ebeb47ccb_80822_720x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      

<p>﻿</p>

<h2 id="extract-hourly-daily-and-monthly-climate-data-from-eccc-datamart">- Extract hourly, daily and monthly climate data from ECCC datamart</h2>

<p>In this post, we will see how to automatically download all weather data for one station from environment and climate change canada using Python librairies.</p>

<p>Here&rsquo;s the  <a href="https://climate.weather.gc.ca/" target="_blank">URL</a> to get historical data.</p>

<p>We will use a daily updated list of Climate stations in the National Archive available on this <a href="https://drive.google.com/drive/folders/1WJCDEU34c60IfOnG4rv5EPZ4IhhW9vZH" target="_blank">link</a>.</p>

<p>As usual, we import our python librairies:</p>

<pre><code class="language-python">import os
import wget
import numpy as np
import shutil
import xml.etree.ElementTree as ET
import pandas as pd
</code></pre>

<p>First, we can open and read the list of Climate stations using Pandas:</p>

<pre><code class="language-python">df = pd.read_csv('J:/Donnees_Stations/Donnees_EC/Codes/Station_Inventory_EN.csv', sep=',', skiprows=3)
df.head()
</code></pre>

<pre><code>|    | Name                   | Province         |   Climate ID |   Station ID |   WMO ID |   TC ID |   Latitude (Decimal Degrees) |   Longitude (Decimal Degrees) |   Latitude |   Longitude |   Elevation (m) |   First Year |   Last Year |   HLY First Year |   HLY Last Year |   DLY First Year |   DLY Last Year |   MLY First Year |   MLY Last Year |
|---:|:-----------------------|:-----------------|-------------:|-------------:|---------:|--------:|-----------------------------:|------------------------------:|-----------:|------------:|----------------:|-------------:|------------:|-----------------:|----------------:|-----------------:|----------------:|-----------------:|----------------:|
|  0 | ACTIVE PASS            | BRITISH COLUMBIA |      1010066 |           14 |      nan |     nan |                        48.87 |                       -123.28 |  485200000 | -1231700000 |             4   |         1984 |        1996 |              nan |             nan |             1984 |            1996 |             1984 |            1996 |
|  1 | ALBERT HEAD            | BRITISH COLUMBIA |      1010235 |           15 |      nan |     nan |                        48.4  |                       -123.48 |  482400000 | -1232900000 |            17   |         1971 |        1995 |              nan |             nan |             1971 |            1995 |             1971 |            1995 |
|  2 | BAMBERTON OCEAN CEMENT | BRITISH COLUMBIA |      1010595 |           16 |      nan |     nan |                        48.58 |                       -123.52 |  483500000 | -1233100000 |            85.3 |         1961 |        1980 |              nan |             nan |             1961 |            1980 |             1961 |            1980 |
|  3 | BEAR CREEK             | BRITISH COLUMBIA |      1010720 |           17 |      nan |     nan |                        48.5  |                       -124    |  483000000 | -1240000000 |           350.5 |         1910 |        1971 |              nan |             nan |             1910 |            1971 |             1910 |            1971 |
|  4 | BEAVER LAKE            | BRITISH COLUMBIA |      1010774 |           18 |      nan |     nan |                        48.5  |                       -123.35 |  483000000 | -1232100000 |            61   |         1894 |        1952 |              nan |             nan |             1894 |            1952 |             1894 |            1952 |
</code></pre>

<p>In this Dataframe, we have all informations to select and work with climate stations:</p>

<ul>
<li>Name : name of the station</li>
<li>Province:  province of the station</li>
<li>Climate ID: Climate ID number</li>
<li>Station ID: Station ID number</li>
<li>Latitude: latitude of the station in decimal degrees</li>
<li>Longitude: longitude of the station in decimal degrees</li>
<li>First Year: first year of record</li>
<li>Last Year: last year of record</li>
<li>HLY First Year: first year of hourly record</li>
<li>HLY Last Year: last year of hourly record</li>
<li>DLY First Year: first year of daily record</li>
<li>DLY Last Year: last year of daily record</li>
<li>MLY First Year: first year of monthly record</li>
<li>MLY Last Year: last year of monthly record</li>
</ul>

<p>We can easily create 3 dataframes to distinguish hourly, daily and monthly datasets:</p>

<pre><code class="language-python">df_hourly = df[['Name', 'Province','Climate ID','Station ID','Latitude (Decimal Degrees)',
              'Longitude (Decimal Degrees)','HLY First Year','HLY Last Year']].dropna()

df_daily = df[['Name', 'Province','Climate ID','Station ID','Latitude (Decimal Degrees)',
              'Longitude (Decimal Degrees)','DLY First Year','DLY Last Year']].dropna()

df_monthly = df[['Name', 'Province','Climate ID','Station ID','Latitude (Decimal Degrees)',
              'Longitude (Decimal Degrees)','MLY First Year','MLY Last Year']].dropna()
</code></pre>

<p>We will use wget python command to download data using a specific path:</p>

<pre><code class="language-python">wget.download('http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=csv&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month=01&amp;Day=14&amp;timeframe=1')
</code></pre>

<p>With:</p>

<table>
<thead>
<tr>
<th align="right"></th>
<th align="right"></th>
</tr>
</thead>

<tbody>
<tr>
<td align="right">year</td>
<td align="right">year of the record</td>
</tr>

<tr>
<td align="right">month</td>
<td align="right">month of the record</td>
</tr>

<tr>
<td align="right">format</td>
<td align="right">[csv</td>
</tr>

<tr>
<td align="right">timeframe = 1</td>
<td align="right">for hourly data</td>
</tr>

<tr>
<td align="right">timeframe = 2</td>
<td align="right">for daily data</td>
</tr>

<tr>
<td align="right">timeframe = 3</td>
<td align="right">for monthly data</td>
</tr>
</tbody>
</table>

<pre><code>- Day: the value of the &quot;day&quot; variable is not used and can be an arbitrary value
- For another station, change the value of the variable stationID
- For the data in XML format, change the value of the variable format to xml in the URL.
</code></pre>

<h3 id="1-working-with-hourly-data">1- Working with hourly data:</h3>

<pre><code class="language-python">df_hourly.head()
</code></pre>

<pre><code>|    | Name              | Province         |   Climate ID |   Station ID |   Latitude (Decimal Degrees) |   Longitude (Decimal Degrees) |   HLY First Year |   HLY Last Year |
|---:|:------------------|:-----------------|-------------:|-------------:|-----------------------------:|------------------------------:|-----------------:|----------------:|
| 28 | DISCOVERY ISLAND  | BRITISH COLUMBIA |      1012475 |        27226 |                        48.42 |                       -123.23 |             1997 |            2020 |
| 39 | ESQUIMALT HARBOUR | BRITISH COLUMBIA |      1012710 |           52 |                        48.43 |                       -123.44 |             1994 |            2020 |
| 49 | KELP REEFS        | BRITISH COLUMBIA |      1013998 |        10853 |                        48.55 |                       -123.24 |             1997 |            2020 |
| 53 | MALAHAT           | BRITISH COLUMBIA |      1014818 |        10730 |                        48.58 |                       -123.58 |             1991 |            1992 |
| 54 | MALAHAT           | BRITISH COLUMBIA |      1014820 |           65 |                        48.57 |                       -123.53 |             1994 |            2020 |
</code></pre>

<p>We want to extract hourly observations from DISCOVERY ISLAND in 2019. So we will select id_stat = 27226, year = 2019 and timeframe = 1 .</p>

<h3 id="we-want-to-work-in-csv-format">- We want to work in csv format.</h3>

<pre><code class="language-python">id_stat = 27226
year = 2019
wget.download('http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=csv&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month=01&amp;Day=14&amp;timeframe=1')
</code></pre>

<pre><code>'en_climate_hourly_BC_1012475_001-2019_P1H.csv'
</code></pre>

<pre><code class="language-python">df = pd.read_csv('en_climate_hourly_BC_1012475_001-2019_P1H.csv', sep=',', skiprows=0)
df.head(2)
</code></pre>

<pre><code>|    |   Longitude (x) |   Latitude (y) | Station Name     |   Climate ID | Date/Time        |   Year |   Month |   Day | Time   |   Temp (°C) |   Temp Flag |   Dew Point Temp (°C) |   Dew Point Temp Flag |   Rel Hum (%) |   Rel Hum Flag |   Wind Dir (10s deg) |   Wind Dir Flag |   Wind Spd (km/h) |   Wind Spd Flag |   Visibility (km) |   Visibility Flag |   Stn Press (kPa) |   Stn Press Flag |   Hmdx |   Hmdx Flag |   Wind Chill |   Wind Chill Flag |   Weather |
|---:|----------------:|---------------:|:-----------------|-------------:|:-----------------|-------:|--------:|------:|:-------|------------:|------------:|----------------------:|----------------------:|--------------:|---------------:|---------------------:|----------------:|------------------:|----------------:|------------------:|------------------:|------------------:|-----------------:|-------:|------------:|-------------:|------------------:|----------:|
|  0 |         -123.23 |          48.42 | DISCOVERY ISLAND |      1012475 | 2019-01-01 00:00 |   2019 |       1 |     1 | 00:00  |         5.2 |         nan |                   0.7 |                   nan |            73 |            nan |                   17 |             nan |                 5 |             nan |               nan |               nan |            102.87 |              nan |    nan |         nan |          nan |               nan |       nan |
|  1 |         -123.23 |          48.42 | DISCOVERY ISLAND |      1012475 | 2019-01-01 01:00 |   2019 |       1 |     1 | 01:00  |         5.2 |         nan |                   0.7 |                   nan |            72 |            nan |                   17 |             nan |                 5 |             nan |               nan |               nan |            102.87 |              nan |    nan |         nan |          nan |               nan |       nan |
</code></pre>

<pre><code class="language-python">url_template = &quot;http://climate.weather.gc.ca/climateData/bulkdata_e.html?format=csv&amp;stationID=5415&amp;Year={year}&amp;Month={month}&amp;timeframe=1&amp;submit=Download+Data&quot;
url_template
</code></pre>

<pre><code>'http://climate.weather.gc.ca/climateData/bulkdata_e.html?format=csv&amp;stationID=5415&amp;Year={year}&amp;Month={month}&amp;timeframe=1&amp;submit=Download+Data'
</code></pre>

<h3 id="if-we-work-in-xml-format">- If we work in xml format:</h3>

<pre><code class="language-python">tmp_file = wget.download('http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month=01&amp;Day=14&amp;timeframe=1')
</code></pre>

<pre><code class="language-python">tree=ET.parse(tmp_file)
os.remove(tmp_file)
root=tree.getroot()
</code></pre>

<p>Here is the structure of xml file and informations we could find in &lsquo;stationinformation&rsquo; child:</p>

<p><img src="image1.png" alt="png" /></p>

<pre><code class="language-python">stationsinfo=root.find('stationinformation')

stationsinfo[0].text, 'latitude', stationsinfo[3].text, 'longitude', stationsinfo[4].text
###############################################################
######### stationsinfo[0].text : station name
######### stationsinfo[1].text : province
######### stationsinfo[2].text : provider
######### stationsinfo[3].text : latitude  
######### stationsinfo[4].text : longitude
</code></pre>

<pre><code>('DISCOVERY ISLAND', 'latitude', '48.42', 'longitude', '-123.23')
</code></pre>

<p>Climate records are available in &lsquo;station data&rsquo; child:</p>

<p><img src="image2.png" alt="png" />
Let&rsquo;s extract Temperature data for one year:</p>

<pre><code class="language-python">stationsdata = root.findall('.//stationdata')
result = []
for  stationdata in stationsdata    :# loop over hourly values or child 
    champs=stationdata.find('temp') 
    tmp=np.array(result,&quot;float&quot;)  
    result.append(champs.text)   
    tmp=np.array(result,&quot;float&quot;)   
</code></pre>

<p>To loop over years available for this station:</p>

<pre><code class="language-python">id_stat = 27226
yi = 2015
yf =2020
</code></pre>

<pre><code class="language-python">dataset = []
for year in range(yi,yf+1):    ### loop over years
    for month in range(1,13):
        tmp_file = wget.download('http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month='+str(month)+'&amp;Day=14&amp;timeframe=1')
        tree=ET.parse(tmp_file)
        os.remove(tmp_file)
        root=tree.getroot()       
        stationsdata = root.findall('.//stationdata')
        temperature = []  
        date  = []
        data  = []
        for  stationdata in stationsdata: 
            date.append(stationdata.attrib['year']+
                        '-'+stationdata.attrib['month']+
                        '-'+stationdata.attrib['day']+ 
                        ' '+stationdata.attrib['hour']+':00')                  
            champs=stationdata.find('temp')
            tmp = np.array(champs.text,&quot;float&quot;)
            if  tmp == 'nan':
                temperature.append(np.nan)
            else:   
                temperature.append(tmp)   #  loop over days in one year

        data = {'date':date, 
                'air_temperature':temperature} 
        data = pd.DataFrame(data)
        dataset.append(data)
dataset = pd.concat(dataset)
</code></pre>

<pre><code class="language-python">from tabulate import tabulate
print(tabulate(dataset.head(), headers='keys', tablefmt='pipe'))
</code></pre>

<pre><code>|    | date          |   air_temperature |
|---:|:--------------|------------------:|
|  0 | 2015-1-1 0:00 |               3   |
|  1 | 2015-1-1 1:00 |               2.9 |
|  2 | 2015-1-1 2:00 |               3   |
|  3 | 2015-1-1 3:00 |               3.1 |
|  4 | 2015-1-1 4:00 |               3.1 |
</code></pre>

<p>To save our dataframe into csv format:</p>

<pre><code class="language-python">dataset.to_csv(&quot;./Hourly_dataset.csv&quot;, index = False, header = True, sep = ',')
</code></pre>

<p>We Can make  quick plot using  plotly.express:</p>

<pre><code class="language-python">import plotly.express as px
import plotly
fig = px.line(dataset, x='date', y='air_temperature')
fig.update_layout(title_text='Hourly temperature record',
                  xaxis_rangeslider_visible=True)
</code></pre>

<p><img src="file1.png" alt="png" />
Follow this <a href="http://www.guillaumedueymes.com/Plotly_plots/file1.html" target="_blank">link</a> for interactive plot:</p>

<p>To save our file in html:</p>

<pre><code class="language-python">import plotly.io as pio
pio.write_html(fig, file = 'file1.html', auto_open = True)
</code></pre>

<p>To save our file in png:</p>

<pre><code class="language-python">fig.write_image(&quot;file1.png&quot;)
</code></pre>

<h3 id="2-working-with-daily-data">2- Working with daily data:</h3>

<p>We will do the same job with daily mean temperature for one Climate station:</p>

<pre><code class="language-python">df_daily.head()
</code></pre>

<pre><code>|    | Name                   | Province         |   Climate ID |   Station ID |   Latitude (Decimal Degrees) |   Longitude (Decimal Degrees) |   DLY First Year |   DLY Last Year |
|---:|:-----------------------|:-----------------|-------------:|-------------:|-----------------------------:|------------------------------:|-----------------:|----------------:|
|  0 | ACTIVE PASS            | BRITISH COLUMBIA |      1010066 |           14 |                        48.87 |                       -123.28 |             1984 |            1996 |
|  1 | ALBERT HEAD            | BRITISH COLUMBIA |      1010235 |           15 |                        48.4  |                       -123.48 |             1971 |            1995 |
|  2 | BAMBERTON OCEAN CEMENT | BRITISH COLUMBIA |      1010595 |           16 |                        48.58 |                       -123.52 |             1961 |            1980 |
|  3 | BEAR CREEK             | BRITISH COLUMBIA |      1010720 |           17 |                        48.5  |                       -124    |             1910 |            1971 |
|  4 | BEAVER LAKE            | BRITISH COLUMBIA |      1010774 |           18 |                        48.5  |                       -123.35 |             1894 |            1952 |
</code></pre>

<pre><code class="language-python">tmp_file = wget.download('http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month=01&amp;Day=14&amp;timeframe=2')
tree=ET.parse(tmp_file)
os.remove(tmp_file)
root=tree.getroot()
</code></pre>

<p>Here is the structure of xml file and informations we could find in &lsquo;stationinformation&rsquo; child:</p>

<p><img src="image1.png" alt="png" /></p>

<p>Climate records are available in &lsquo;station data&rsquo; child:</p>

<p><img src="image3.png" alt="png" /></p>

<pre><code class="language-python">url_template = 'http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month=01&amp;Day=14&amp;timeframe=2'
url_template
</code></pre>

<pre><code>'http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=5415&amp;Year=2020&amp;Month=01&amp;Day=14&amp;timeframe=2'
</code></pre>

<p>We want to extract 4 specific years for Climate station with ID=27226:</p>

<pre><code class="language-python">id_stat = 27226
df_daily[df_daily['Station ID'] == id_stat]['DLY First Year']
yi = 2015
yf = 2020
</code></pre>

<pre><code class="language-python">dataset = []
for year in range(yi,yf+1):    ### loop over years
        tmp_file = wget.download('http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month=1&amp;Day=14&amp;timeframe=2')
        tree=ET.parse(tmp_file)
        os.remove(tmp_file)
        root=tree.getroot()       
        stationsdata = root.findall('.//stationdata')
        temperature = []  
        date  = []
        data  = []
        for  stationdata in stationsdata: 
            date.append(stationdata.attrib['year']+
                        '-'+stationdata.attrib['month']+
                        '-'+stationdata.attrib['day'])                  
            champs=stationdata.find('meantemp')
            tmp = np.array(champs.text,&quot;float&quot;)
            if  tmp == 'nan':
                temperature.append(np.nan)
            else:   
                temperature.append(tmp)   #  loop over days in one year

        data = {'date':date, 
                'temperature':temperature} 
        data = pd.DataFrame(data)
        dataset.append(data)
dataset = pd.concat(dataset)
</code></pre>

<pre><code class="language-python">dataset.head()
</code></pre>

<pre><code>|    | date     |   temperature |
|---:|:---------|--------------:|
|  0 | 2015-1-1 |           nan |
|  1 | 2015-1-2 |           nan |
|  2 | 2015-1-3 |           nan |
|  3 | 2015-1-4 |           nan |
|  4 | 2015-1-5 |           nan |
</code></pre>

<p>We Can make  quick plot using  plotly.express:</p>

<pre><code class="language-python">import plotly.express as px
fig = px.line(dataset, x='date', y='temperature')
fig.update_layout(title_text='Time Series with Rangeslider',
                  xaxis_rangeslider_visible=True)
</code></pre>

<p><img src="file2.png" alt="png" />
Follow this <a href="http://www.guillaumedueymes.com/Plotly_plots/file2.html" target="_blank">link</a> for interactive plot:</p>

<pre><code class="language-python">dataset.to_csv(&quot;./Daily_dataset.csv&quot;, index = False, header = True, sep = ',')
</code></pre>

<pre><code class="language-python">import plotly.io as pio
pio.write_html(fig, file = 'file2.html', auto_open = True)
fig.write_image(&quot;file2.png&quot;)
</code></pre>

<h3 id="3-working-with-monthly-data">3- Working with monthly data:</h3>

<p>We will do the same job with monthly total precipitation for one Climate station:</p>

<pre><code class="language-python">df_monthly.head()
</code></pre>

<pre><code>|    | Name                   | Province         |   Climate ID |   Station ID |   Latitude (Decimal Degrees) |   Longitude (Decimal Degrees) |   MLY First Year |   MLY Last Year |
|---:|:-----------------------|:-----------------|-------------:|-------------:|-----------------------------:|------------------------------:|-----------------:|----------------:|
|  0 | ACTIVE PASS            | BRITISH COLUMBIA |      1010066 |           14 |                        48.87 |                       -123.28 |             1984 |            1996 |
|  1 | ALBERT HEAD            | BRITISH COLUMBIA |      1010235 |           15 |                        48.4  |                       -123.48 |             1971 |            1995 |
|  2 | BAMBERTON OCEAN CEMENT | BRITISH COLUMBIA |      1010595 |           16 |                        48.58 |                       -123.52 |             1961 |            1980 |
|  3 | BEAR CREEK             | BRITISH COLUMBIA |      1010720 |           17 |                        48.5  |                       -124    |             1910 |            1971 |
|  4 | BEAVER LAKE            | BRITISH COLUMBIA |      1010774 |           18 |                        48.5  |                       -123.35 |             1894 |            1952 |
</code></pre>

<pre><code class="language-python">tmp_file = wget.download('http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month=01&amp;Day=14&amp;timeframe=3')
url_template = 'http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID='+str(int(id_stat))+'&amp;Year='+str(year)+'&amp;Month=01&amp;Day=14&amp;timeframe=3'
url_template
tree=ET.parse(tmp_file)
os.remove(tmp_file)
root=tree.getroot()
url_template
</code></pre>

<pre><code>'http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID=27226&amp;Year=2020&amp;Month=01&amp;Day=14&amp;timeframe=3'
</code></pre>

<p>Climate records are available in &lsquo;station data&rsquo; child:</p>

<p><img src="image4.png" alt="png" /></p>

<p>We want to dowload monthly total precipitation for Climate station with ID=5415.</p>

<pre><code class="language-python">id_stat = 5415
df_monthly[df_monthly['Station ID'] == id_stat]['MLY First Year']
yi = int(df_monthly[df_monthly['Station ID'] == id_stat]['MLY First Year'].values)
yf = int(df_monthly[df_monthly['Station ID'] == id_stat]['MLY Last Year'].values)
</code></pre>

<pre><code class="language-python">dataset = []

tmp_file = wget.download('http://climate.weather.gc.ca/climate_data/bulk_data_e.html?format=xml&amp;stationID='+str(int(id_stat))+'&amp;Year=2020&amp;Month=1&amp;Day=14&amp;timeframe=3')
tree=ET.parse(tmp_file)
os.remove(tmp_file)
root=tree.getroot()       
stationsdata = root.findall('.//stationdata')
totprecip = []  
date  = []
data  = []
for  stationdata in stationsdata: 
    date.append(stationdata.attrib['year']+
                        '-'+stationdata.attrib['month'])                  
    champs=stationdata.find('totprecip')
    tmp = np.array(champs.text,&quot;float&quot;)
    if  tmp == 'nan':
        totprecip.append(np.nan)
    else:   
        totprecip.append(tmp)   #  loop over days in one year

    data = {'date':date, 
                'totprecip':totprecip} 
    data = pd.DataFrame(data)
    dataset.append(data)
dataset = pd.concat(dataset)
dataset = dataset.drop_duplicates('date',keep='last')
dataset['date']  = pd.to_datetime(dataset['date'], format='%Y-%m')
</code></pre>

<pre><code class="language-python">import plotly.graph_objects as go
fig = go.Figure(data=[
    go.Bar(name='totprecip1', 
           x=dataset[dataset['date'].dt.month == 7]['date'], 
           y=dataset[dataset['date'].dt.month == 7]['totprecip'])    
])
fig.update_layout(
    title='July monthly precipitation',
    xaxis_tickfont_size=14,
    yaxis=dict(
        title='Total precipitation (mm)',
        titlefont_size=16,
        tickfont_size=14,
    ),
    barmode='group',
    bargap=0.15, # gap between bars of adjacent location coordinates.
    bargroupgap=0.1 # gap between bars of the same location coordinate.
)
</code></pre>

<p><img src="file3.png" alt="png" />
Follow this <a href="http://www.guillaumedueymes.com/Plotly_plots/file3.html" target="_blank">link</a> for interactive plot.</p>

<pre><code class="language-python">dataset[dataset['date'].dt.month == 7].to_csv(&quot;./Monthly_dataset.csv&quot;, index = False, header = True, sep = ',')
import plotly.io as pio
pio.write_html(fig, file = 'file2.html', auto_open = True)
fig.write_image(&quot;file2.png&quot;)
</code></pre>

    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/working_with_eccc_climate_data/&amp;text=ECCC%20climate%20data" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/working_with_eccc_climate_data/&amp;t=ECCC%20climate%20data" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=ECCC%20climate%20data&amp;body=/post/working_with_eccc_climate_data/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/working_with_eccc_climate_data/&amp;title=ECCC%20climate%20data" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=ECCC%20climate%20data%20/post/working_with_eccc_climate_data/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/working_with_eccc_climate_data/&amp;title=ECCC%20climate%20data" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hued2496a182fbb6fc8c711157078d29a6_5348924_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Guillaume Dueymes</a></h5>
      <h6 class="card-subtitle">Data Scientist and Research Assistant</h6>
      <p class="card-text">My research interests include data science, data management and climate science.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Guillaume_Dueymes" target="_blank" rel="noopener">
        <i class="fab fa-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/guimeto" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
