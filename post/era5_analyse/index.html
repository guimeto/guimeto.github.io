<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="﻿
Exemples using ERA5 reanalysis In this post, we will work with ERA5 reanalysis and show how to extract a region using shapefile and compute standard deviation.
We first import our librairies:
from netCDF4 import Dataset, num2date import warnings warnings.filterwarnings(&quot;ignore&quot;) import datetime import xarray as xr import pandas as pd import cartopy.crs as ccrs import cartopy.feature as cfeature import xarray as xr import numpy as np import regionmask import geopandas as gpd import pandas as pd import matplotlib.">

  
  <link rel="alternate" hreflang="en-us" href="/post/era5_analyse/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/era5_analyse/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/post/era5_analyse/">
  <meta property="og:title" content="Working with ERA5 reanalysis | GDueymes">
  <meta property="og:description" content="﻿
Exemples using ERA5 reanalysis In this post, we will work with ERA5 reanalysis and show how to extract a region using shapefile and compute standard deviation.
We first import our librairies:
from netCDF4 import Dataset, num2date import warnings warnings.filterwarnings(&quot;ignore&quot;) import datetime import xarray as xr import pandas as pd import cartopy.crs as ccrs import cartopy.feature as cfeature import xarray as xr import numpy as np import regionmask import geopandas as gpd import pandas as pd import matplotlib."><meta property="og:image" content="/post/era5_analyse/featured.png">
  <meta property="twitter:image" content="/post/era5_analyse/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-04-05T12:49:01-07:00">
    
    <meta property="article:modified_time" content="2020-04-05T12:49:01-07:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/era5_analyse/"
  },
  "headline": "Working with ERA5 reanalysis",
  
  "image": [
    "/post/era5_analyse/featured.png"
  ],
  
  "datePublished": "2020-04-05T12:49:01-07:00",
  "dateModified": "2020-04-05T12:49:01-07:00",
  
  "author": {
    "@type": "Person",
    "name": "Guillaume Dueymes"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "GDueymes",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "﻿\nExemples using ERA5 reanalysis In this post, we will work with ERA5 reanalysis and show how to extract a region using shapefile and compute standard deviation.\nWe first import our librairies:\nfrom netCDF4 import Dataset, num2date import warnings warnings.filterwarnings(\u0026quot;ignore\u0026quot;) import datetime import xarray as xr import pandas as pd import cartopy.crs as ccrs import cartopy.feature as cfeature import xarray as xr import numpy as np import regionmask import geopandas as gpd import pandas as pd import matplotlib."
}
</script>

  

  


  


  





  <title>Working with ERA5 reanalysis | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Working with ERA5 reanalysis</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Apr 5, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  

  
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 447px;">
  <div style="position: relative">
    <img src="/post/era5_analyse/featured_hu246319494afe7b6f77080a328f69bf45_190045_720x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      

<p>﻿</p>

<h3 id="exemples-using-era5-reanalysis">Exemples using ERA5 reanalysis</h3>

<p>In this post, we will work with ERA5 reanalysis and show how to extract a region using shapefile and compute standard deviation.</p>

<p>We first import our librairies:</p>

<pre><code class="language-python">from netCDF4 import Dataset, num2date
import warnings
warnings.filterwarnings(&quot;ignore&quot;)
import datetime
import xarray as xr
import pandas as pd
import cartopy.crs as ccrs
import cartopy.feature as cfeature
import xarray as xr 
import numpy as np
import regionmask
import geopandas as gpd
import pandas as pd
import matplotlib.pyplot as plt
import warnings; warnings.filterwarnings(action='ignore')
%matplotlib inline
</code></pre>

<h3 id="working-over-canadian-provinces">Working over canadian provinces</h3>

<p>Canadian province shapefiles are available on this  <a href="https://www.arcgis.com/home/item.html?id=5cf4f223c4a642eb9aa7ae1216a04372" target="_blank">website</a>:</p>

<p>After downloaded the shapefiles, we must load it using geopandas library:</p>

<pre><code class="language-python">PATH_TO_SHAPEFILE = './Canadian_province/lpr_000b16a_e/lpr_000b16a_e.shp'
province = gpd.read_file(PATH_TO_SHAPEFILE)
province.iloc[:,:-1]
</code></pre>

<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">PRUID</th>
<th align="left">PRNAME</th>
<th align="left">PRENAME</th>
<th align="left">PRFNAME</th>
<th align="left">PREABBR</th>
<th align="left">PRFABBR</th>
</tr>
</thead>

<tbody>
<tr>
<td align="right">0</td>
<td align="right">10</td>
<td align="left">Newfoundland and Labrador / Terre-Neuve-et-Labrador</td>
<td align="left">Newfoundland and Labrador</td>
<td align="left">Terre-Neuve-et-Labrador</td>
<td align="left">N.L.</td>
<td align="left">T.-N.-L.</td>
</tr>

<tr>
<td align="right">1</td>
<td align="right">11</td>
<td align="left">Prince Edward Island / Île-du-Prince-Édouard</td>
<td align="left">Prince Edward Island</td>
<td align="left">Île-du-Prince-Édouard</td>
<td align="left">P.E.I.</td>
<td align="left">Î.-P.-É.</td>
</tr>

<tr>
<td align="right">2</td>
<td align="right">12</td>
<td align="left">Nova Scotia / Nouvelle-Écosse</td>
<td align="left">Nova Scotia</td>
<td align="left">Nouvelle-Écosse</td>
<td align="left">N.S.</td>
<td align="left">N.-É.</td>
</tr>

<tr>
<td align="right">3</td>
<td align="right">13</td>
<td align="left">New Brunswick / Nouveau-Brunswick</td>
<td align="left">New Brunswick</td>
<td align="left">Nouveau-Brunswick</td>
<td align="left">N.B.</td>
<td align="left">N.-B.</td>
</tr>

<tr>
<td align="right">4</td>
<td align="right">24</td>
<td align="left">Quebec / Québec</td>
<td align="left">Quebec</td>
<td align="left">Québec</td>
<td align="left">Que.</td>
<td align="left">Qc</td>
</tr>

<tr>
<td align="right">5</td>
<td align="right">35</td>
<td align="left">Ontario</td>
<td align="left">Ontario</td>
<td align="left">Ontario</td>
<td align="left">Ont.</td>
<td align="left">Ont.</td>
</tr>

<tr>
<td align="right">6</td>
<td align="right">46</td>
<td align="left">Manitoba</td>
<td align="left">Manitoba</td>
<td align="left">Manitoba</td>
<td align="left">Man.</td>
<td align="left">Man.</td>
</tr>

<tr>
<td align="right">7</td>
<td align="right">47</td>
<td align="left">Saskatchewan</td>
<td align="left">Saskatchewan</td>
<td align="left">Saskatchewan</td>
<td align="left">Sask.</td>
<td align="left">Sask.</td>
</tr>

<tr>
<td align="right">8</td>
<td align="right">48</td>
<td align="left">Alberta</td>
<td align="left">Alberta</td>
<td align="left">Alberta</td>
<td align="left">Alta.</td>
<td align="left">Alb.</td>
</tr>

<tr>
<td align="right">9</td>
<td align="right">59</td>
<td align="left">British Columbia / Colombie-Britannique</td>
<td align="left">British Columbia</td>
<td align="left">Colombie-Britannique</td>
<td align="left">B.C.</td>
<td align="left">C.-B.</td>
</tr>

<tr>
<td align="right">10</td>
<td align="right">60</td>
<td align="left">Yukon</td>
<td align="left">Yukon</td>
<td align="left">Yukon</td>
<td align="left">Y.T.</td>
<td align="left">Yn</td>
</tr>

<tr>
<td align="right">11</td>
<td align="right">61</td>
<td align="left">Northwest Territories / Territoires du Nord-Ouest</td>
<td align="left">Northwest Territories</td>
<td align="left">Territoires du Nord-Ouest</td>
<td align="left">N.W.T.</td>
<td align="left">T.N.-O.</td>
</tr>

<tr>
<td align="right">12</td>
<td align="right">62</td>
<td align="left">Nunavut</td>
<td align="left">Nunavut</td>
<td align="left">Nunavut</td>
<td align="left">Nvt.</td>
<td align="left">Nt</td>
</tr>
</tbody>
</table>

<pre><code class="language-python">tmpWGS84 = province.to_crs({'proj':'longlat', 'ellps':'WGS84', 'datum':'WGS84'})
</code></pre>

<pre><code class="language-python">tmpWGS84.plot()
</code></pre>

<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x436e8908&gt;
</code></pre>

<p><img src="output_5_1.png" alt="png" /></p>

<p>Shapes are here a GeoDataFrame containing all polygons illustrating the canadian province boundaries.</p>

<p>Now we can load the ERA5 gridded data. The parameter chunks is very important, it defines how big are the “pieces” of data moved from the disk to the memory. With this value the entire computation on a workstation with 32 GB takes a couple of minutes.</p>

<p>We will load all the temperature files for the year 2018 using Xarray library.</p>

<pre><code class="language-python">model='ERA5_T2m_1h'
t_in = 'J:/REANALYSES/ERA5/T2m_1h/'        
data = t_in + model + '_2018*_sfc.nc'
ds = xr.open_mfdataset(data, chunks = {'time': 10})
</code></pre>

<p>The next function <b>assign_coords</b> will convert the longitude from the 0-360 range to -180,180</p>

<pre><code class="language-python">ds = ds.assign_coords(longitude=(((ds.longitude + 180) % 360) - 180)).sortby('longitude')
</code></pre>

<p>Our xarray Dataset contains a single variable (t2m) which is stored as a dask.array. This is the result of loading files with open_mfdataset.</p>

<p>Now we will use  regionmask module to create a gridded mask with the function regions_cls documented <a href="https://regionmask.readthedocs.io/en/stable/generated/regionmask.Regions_cls.html#regionmask.Regions_cls" target="_blank">here</a>.</p>

<p>With this function we will create an object able to mask ERA5 gridded data.</p>

<pre><code class="language-python">province_mask_poly = regionmask.Regions_cls(name = 'PRENAME', numbers = list(range(0,13)), names = list(tmpWGS84.PRENAME), abbrevs = list(tmpWGS84.PRENAME), outlines = list(tmpWGS84.geometry.values[i] for i in range(0,13)))
province_mask_poly
</code></pre>

<pre><code>13 'PRENAME' Regions ()
Newfoundland and Labrador Prince Edward Island Nova Scotia New Brunswick Quebec Ontario Manitoba Saskatchewan Alberta British Columbia Yukon Northwest Territories Nunavut
</code></pre>

<p>Now we are ready to apply the mask on the gridded dataset xarray ERA5.</p>

<p>We select only the first timestep to speed up the process.</p>

<pre><code class="language-python">mask = province_mask_poly.mask(ds.isel(time = 0), lat_name='latitude', lon_name='longitude')
mask.to_netcdf('ERA5_mask_Canadian_provinces.nc')
</code></pre>

<pre><code class="language-python">masque = xr.open_mfdataset('ERA5_mask_Canadian_provinces.nc')
lat_bnd = [84, 40]
lon_bnd = [-148, -50]
masque = masque.sel(longitude=slice(*lon_bnd), latitude=slice(*lat_bnd),)
</code></pre>

<p>Here&rsquo;s a function to make maps in the future.</p>

<pre><code class="language-python">def make_figure():
    fig=plt.figure(figsize=(18,8), frameon=True) 
    ax = plt.axes(projection=ccrs.LambertConformal())
    ax.add_feature(cfeature.OCEAN.with_scale('50m'))      # couche ocean
    ax.add_feature(cfeature.LAND.with_scale('50m'))       # couche land
    ax.add_feature(cfeature.LAKES.with_scale('50m'))      # couche lac

    ax.add_feature(cfeature.BORDERS.with_scale('50m'), linestyle='dotted')    # couche frontieres
    ax.add_feature(cfeature.RIVERS.with_scale('50m'))     # couche rivières 
    coast = cfeature.NaturalEarthFeature(category='physical', scale='10m',     # ajout de la couche cotière 
                                facecolor='none', name='coastline')
    ax.add_feature(coast, edgecolor='black')   
    return fig, ax

</code></pre>

<p>We can make a quick visualisation of our netcdf mask:</p>

<pre><code class="language-python">_, ax = make_figure()
ax.set_extent([-140,-50,32,82])
masque.region.plot.contourf(ax = ax, transform=ccrs.PlateCarree())
</code></pre>

<pre><code>&lt;matplotlib.contour.QuadContourSet at 0x16563e48&gt;
</code></pre>

<p><img src="output_18_1.png" alt="png" /></p>

<h3 id="compute-daily-and-monthly-2-meters-temperature-mean">Compute daily and monthly 2 meters temperature  mean</h3>

<p>We will now compute daily and monthly 2 meters temperature mean using hourly ERA5 datasets. To speed up our calcul, we will cut a subset over Canada only.</p>

<p>Here&rsquo;s an example code just for one month and one year:</p>

<pre><code class="language-python">model='ERA5_T2m_1h'

yi = 1990
yf = 1990
#########################################################
t_in = 'J:/REANALYSES/ERA5/T2m_1h/'
daily_out = 'J:/REANALYSES/ERA5/T2m_daily/' 
monthly_out = 'J:/REANALYSES/ERA5/T2m_monthly/' 
for year in range(yi,yf+1):                    # loop over years
    for i in range (1,2,1):                   # loop over months
        
        data = t_in + model + '_'+str(year) +'{:02d}'.format(i)+'_sfc.nc'
        ds = xr.open_mfdataset(data)        
        ds = ds - 273.15  # convert from Kelvin to Celcius 
        ds = ds.assign_coords(longitude=(((ds.longitude + 180) % 360) - 180)).sortby('longitude')
        
        lat_bnd = [84, 40]
        lon_bnd = [-148, -50]
        ds = ds.sel(longitude=slice(*lon_bnd), latitude=slice(*lat_bnd),)
        
        daily_mean = ds.groupby('time.day').mean('time')
        daily_mean.to_netcdf(daily_out + 'Daily_Mean_T2m_CAN_'+str(year) +'{:02d}'.format(i)+'.nc')
        
        monthly_mean = daily_mean.mean('day')
        monthly_mean.to_netcdf(monthly_out + 'Monthly_Mean_T2m_CAN_'+str(year) +'{:02d}'.format(i)+'.nc')

</code></pre>

<h3 id="monthly-climatologies-and-standardized-anomalies">Monthly climatologies and standardized anomalies</h3>

<p>Once we have monthly mean values, we can now compute climatology and standard anomaly for monthly temperature from 1979 to 2019. Our reference climatology to compute standardized anomalies is 1990-2019 period.</p>

<p>We will first work with one month (ie january), we will make a loop over all months after.</p>

<p>First we open and load datasets:</p>

<pre><code class="language-python">import xarray as xr 

#### First we open and load datasets
#for month in range (1,2,1):
m = 1
file = 'J:/REANALYSES/ERA5/T2m_monthly/Monthly_Mean_T2m_CAN_'
month = '{:02d}'.format(m)
multi_file = [f'{file}{year}{month}.nc' for year in range(1990,2020,1)]
ds_all = xr.concat([xr.open_dataset(f) for f in multi_file], 'time')
ds_all.time
</code></pre>

<pre>&lt;xarray.DataArray &#x27;time&#x27; (time: 30)&gt;
array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17,
       18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29], dtype=int64)
Dimensions without coordinates: time</pre>

<p>Our time is without dimension, it&rsquo;s just an integer. To easly handle our fields, we can define a DatetimeIndex to change &lsquo;time&rsquo; dimension in our Xarray. For more <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases" target="_blank">information</a>.</p>

<pre><code class="language-python">ds_all['time'] = pd.date_range('1990-'+month+'-01', freq='YS', periods=ds_all.time.shape[0])
</code></pre>

<pre><code class="language-python">ds_all.time.head()
</code></pre>

<pre>&lt;xarray.DataArray &#x27;time&#x27; (time: 5)&gt;
array([&#x27;1990-01-01T00:00:00.000000000&#x27;, &#x27;1991-01-01T00:00:00.000000000&#x27;,
       &#x27;1992-01-01T00:00:00.000000000&#x27;, &#x27;1993-01-01T00:00:00.000000000&#x27;,
       &#x27;1994-01-01T00:00:00.000000000&#x27;], dtype=&#x27;datetime64[ns]&#x27;)
Coordinates:
  * time     (time) datetime64[ns] 1990-01-01 1991-01-01 ... 1994-01-01</pre>

<p>We can compute our climatology and standard deviation over 30 years: 1990-2019</p>

<pre><code class="language-python">clim_yi = 1990
clim_yf = 2019
ds_clim =  ds_all.sel(time=slice(str(clim_yi)+'-'+month+'-01', str(clim_yf)+'-'+month+'-01'))
data_clim = ds_clim.variables['t2m'][:].mean(&quot;time&quot;)
data_std  = ds_clim.variables['t2m'][:].std(&quot;time&quot;)

</code></pre>

<p>We can apply a function with .apply_unfunc and groupby methods to compute a standardized anomaly:</p>

<pre><code class="language-python">stand_anomalies = xr.apply_ufunc(
    lambda x, m, s: (x - m) / s,
    ds_all.groupby(&quot;time&quot;),
    data_clim,
    data_std,
)

stand_anomalies.to_netcdf('J:/REANALYSES/ERA5/T2m_Month_Anomaly/Std_Anomaly_Monthly_Mean_T2m_CAN_'+
                          str(yi)+'-'+str(yf)+'_vs_'+str(clim_yi)+'-'+str(clim_yf)+'_'+str(month)+'.nc')
</code></pre>

<p>We will mask all Canadian provinces with applying our mask region created at the begining of this post:</p>

<pre><code class="language-python">data_clim_can = data_clim.where(masque.region &gt;= 0)
</code></pre>

<p>We can now display january monthly mean temperature climatology:</p>

<pre><code class="language-python">_, ax = make_figure()
ax.set_extent([-140,-50,32,82])
import matplotlib as mpl
import datetime
monthstr = datetime.date(1900, int(month), 1).strftime('%B')
data_levels = np.arange(-35, 30, 5.1)
Y=np.array([[77,0,111],[115,14,181],[160,17,222],[195,14,240],\
               [0,0,93],[21,38,177],[33,95,227],[32,162,247],[59,224,248],[202,255,250],\
               [4,255,179],[37,181,139],[32,132,81],[72,162,60],[157,240,96],[213,255,166],\
               [241,247,132],[248,185,68],[255,124,4],[235,78,14],[215,32,24],[189,24,40],[162,16,56],[135,16,65],[107,15,73]])/255.

colbar=mpl.colors.ListedColormap(Y)
mm = ax.contourf(data_clim_can.longitude,\
                   data_clim_can.latitude,\
                   data_clim_can,\
                   vmin=-35,\
                   vmax= 30, \
                   transform=ccrs.PlateCarree(),\
                   levels=data_levels,\
                   cmap=colbar )

data_contour = ax.contour(data_clim_can.longitude, data_clim_can.latitude, data_clim_can, 
                          levels = data_levels, 
                          linewidths=2, 
                          colors='k',
                          transform = ccrs.PlateCarree())
#Plot contour labels for the heights, leaving a break in the contours for the text (inline=True)
plt.clabel(data_contour,  data_levels, inline=True, fmt='%1i', fontsize=12)
# Define gridline locations and draw the lines using cartopy's built-in gridliner:
xticks = np.arange(-150.0,-40.0,20)
yticks =np.arange(10,80,10)

cbar = plt.colorbar(mm,  shrink=0.75, drawedges='True', ticks=np.arange(-35, 30.1, 5.), extend='both') # 2018

cbar.ax.tick_params(labelsize=20) 

string_title=u'Climatology of monthly mean 2meters temperature: ' + monthstr
plt.title(string_title, size='xx-large')
</code></pre>

<pre><code>Text(0.5, 1.0, 'Climatology of monthly mean 2meters temperature: January')
</code></pre>

<p><img src="output_34_1.png" alt="png" /></p>

<p>If we just want to display over one province, we can adjust our mask.  Let&rsquo;s plot climatology over Quebec:</p>

<pre><code class="language-python">data_clim_qc = data_clim.where(masque.region == 4  )
</code></pre>

<pre><code class="language-python">_, ax = make_figure()
ax.set_extent([-80,-60,45,65])
monthstr = datetime.date(1900, int(month), 1).strftime('%B')
data_levels = np.arange(-35, 30, 5.1)
Y=np.array([[77,0,111],[115,14,181],[160,17,222],[195,14,240],\
               [0,0,93],[21,38,177],[33,95,227],[32,162,247],[59,224,248],[202,255,250],\
               [4,255,179],[37,181,139],[32,132,81],[72,162,60],[157,240,96],[213,255,166],\
               [241,247,132],[248,185,68],[255,124,4],[235,78,14],[215,32,24],[189,24,40],[162,16,56],[135,16,65],[107,15,73]])/255.

colbar=mpl.colors.ListedColormap(Y)

data_levels = np.arange(-35, 30, 5.1)

mm = ax.contourf(data_clim_qc.longitude,\
                   data_clim_qc.latitude,\
                   data_clim_qc,\
                   vmin=-35,\
                   vmax= 30, \
                   transform=ccrs.PlateCarree(),\
                   levels=data_levels,\
                   cmap=colbar )

data_contour = ax.contour(data_clim_qc.longitude, data_clim_qc.latitude, data_clim_qc, 
                          levels = data_levels, 
                          linewidths=2, 
                          colors='k',
                          transform = ccrs.PlateCarree())
#Plot contour labels for the heights, leaving a break in the contours for the text (inline=True)
plt.clabel(data_contour,  data_levels, inline=True, fmt='%1i', fontsize=12)
# Define gridline locations and draw the lines using cartopy's built-in gridliner:
xticks = np.arange(-150.0,-40.0,20)
yticks =np.arange(10,80,10)

cbar = plt.colorbar(mm,  shrink=0.75, drawedges='True', ticks=np.arange(-35, 30.1, 5.), extend='both') # 2018

cbar.ax.tick_params(labelsize=20) 

string_title=u'ERA5 T2m Climatology (1990-2019) over Quebec ' + monthstr
plt.title(string_title, size='xx-large')
</code></pre>

<pre><code>Text(0.5, 1.0, 'ERA5 T2m Climatology (1990-2019) over Quebec January')
</code></pre>

<p><img src="output_37_1.png" alt="png" /></p>

<h3 id="inter-annual-standardised-anomaly">Inter-annual standardised anomaly</h3>

<p>Let&rsquo;s compute and draw inter-annual standardised anomaly over Quebec:</p>

<pre><code class="language-python">stand_anomalies_qc  = stand_anomalies.where(masque.region == 4)
stand_anomalie_serie = stand_anomalies_qc.mean(['latitude','longitude'])
stand_anomalie_serie.time.values[-1]
</code></pre>

<pre><code>numpy.datetime64('2019-01-01T00:00:00.000000000')
</code></pre>

<pre><code class="language-python">color = ['black','blue', 'red']
fig = plt.figure(figsize=(18, 12)) 


plt.rcParams[&quot;figure.figsize&quot;]=[16,9]       #  
plt.plot(stand_anomalie_serie.time.values, stand_anomalie_serie.t2m.values, 
         label='ERA5 2m temperature', linewidth=2, c=color[2])
plt.legend(loc=&quot;upper left&quot;, markerscale=1., scatterpoints=1, fontsize=20)

plt.yticks( fontsize=14)

ax.grid(axis = &quot;x&quot;, linestyle = &quot;--&quot;, color='black', linewidth=0.25, alpha=0.5)
ax.grid(axis = &quot;y&quot;, linestyle = &quot;--&quot;, color='black', linewidth=0.25, alpha=0.5)

plt.setp(plt.gca().get_xticklabels(), rotation=45, ha=&quot;right&quot;)

plt.xlabel('Date', fontsize=20, color='black', weight='semibold')
plt.ylabel('°C', fontsize=20, color='black', weight='semibold')
plt.title('Inter annual standardised anomaly of monthly mean temperature over Quevec in January: (1990-2019) compared with normal (1990-2019)', fontsize=20, color='black', weight='semibold')
 
ax.set_facecolor('white')
plt.yticks( fontsize=14)
plt.show()  
</code></pre>

<p><img src="output_40_0.png" alt="png" /></p>

    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/era5_analyse/&amp;text=Working%20with%20ERA5%20reanalysis" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/era5_analyse/&amp;t=Working%20with%20ERA5%20reanalysis" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Working%20with%20ERA5%20reanalysis&amp;body=/post/era5_analyse/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/era5_analyse/&amp;title=Working%20with%20ERA5%20reanalysis" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Working%20with%20ERA5%20reanalysis%20/post/era5_analyse/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/era5_analyse/&amp;title=Working%20with%20ERA5%20reanalysis" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hued2496a182fbb6fc8c711157078d29a6_5348924_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Guillaume Dueymes</a></h5>
      <h6 class="card-subtitle">Data Scientist and Research Assistant</h6>
      <p class="card-text">My research interests include data science, data management and climate science.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Guillaume_Dueymes" target="_blank" rel="noopener">
        <i class="fab fa-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/guimeto" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
