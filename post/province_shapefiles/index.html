<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="﻿
From shapefiles to Netcdf Mask In this tutorial, we will use shapefiles to create masks over canadian provinces.
We will use gridded dataset ANUSPLIN meteorological data.
Agriculture and Agri-Food Canada have produced daily precipitation, minimum and maximum temperature across Canada (south of 60°N) for climate related application purpose using thin-plate smoothing splines, as implemented in the ANUSPLIN climate modeling software (Hutchinson et al., 2009; McKenney et al., 2011).">

  
  <link rel="alternate" hreflang="en-us" href="/post/province_shapefiles/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/province_shapefiles/">

  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/post/province_shapefiles/">
  <meta property="og:title" content="Canadian shapefile province | GDueymes">
  <meta property="og:description" content="﻿
From shapefiles to Netcdf Mask In this tutorial, we will use shapefiles to create masks over canadian provinces.
We will use gridded dataset ANUSPLIN meteorological data.
Agriculture and Agri-Food Canada have produced daily precipitation, minimum and maximum temperature across Canada (south of 60°N) for climate related application purpose using thin-plate smoothing splines, as implemented in the ANUSPLIN climate modeling software (Hutchinson et al., 2009; McKenney et al., 2011)."><meta property="og:image" content="/post/province_shapefiles/featured.png">
  <meta property="twitter:image" content="/post/province_shapefiles/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-02-14T09:14:48-08:00">
    
    <meta property="article:modified_time" content="2020-02-14T09:14:48-08:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/province_shapefiles/"
  },
  "headline": "Canadian shapefile province",
  
  "image": [
    "/post/province_shapefiles/featured.png"
  ],
  
  "datePublished": "2020-02-14T09:14:48-08:00",
  "dateModified": "2020-02-14T09:14:48-08:00",
  
  "author": {
    "@type": "Person",
    "name": "Guillaume Dueymes"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "GDueymes",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/icon-512.png"
    }
  },
  "description": "﻿\nFrom shapefiles to Netcdf Mask In this tutorial, we will use shapefiles to create masks over canadian provinces.\nWe will use gridded dataset ANUSPLIN meteorological data.\nAgriculture and Agri-Food Canada have produced daily precipitation, minimum and maximum temperature across Canada (south of 60°N) for climate related application purpose using thin-plate smoothing splines, as implemented in the ANUSPLIN climate modeling software (Hutchinson et al., 2009; McKenney et al., 2011)."
}
</script>

  

  


  


  





  <title>Canadian shapefile province | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  


<div class="article-container pt-3">
  <h1>Canadian shapefile province</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Feb 14, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  

  
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 321px; max-height: 265px;">
  <div style="position: relative">
    <img src="/post/province_shapefiles/featured.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      

<p>﻿</p>

<h3 id="from-shapefiles-to-netcdf-mask">From shapefiles to Netcdf Mask</h3>

<p>In this tutorial, we will use shapefiles to create masks over canadian provinces.</p>

<p>We will use gridded dataset ANUSPLIN meteorological data.</p>

<p>Agriculture and Agri-Food Canada have produced daily precipitation, minimum and maximum temperature across Canada (south of 60°N) for climate related application purpose using thin-plate smoothing splines, as implemented in the ANUSPLIN climate modeling software (Hutchinson et al., 2009; McKenney et al., 2011).</p>

<p>The so-called ANUSPLIN data uses ground-based observations and generates daily gridded data from 1951 to 2017 on a Lambert conformal conic projection with 5’ arc minutes spacing (equivalent to a resolution of about 10 km). The key strength of this spatial interpolation method is its global dependence on all data, permitting robust and stable determination of spatially varying dependences on elevation. Hutchinson et al. (2009) have shown that while ANUSPLIN fall month’s absolute errors were remarkably small, those of winter months were quite large due to rather difficult observation and measurement conditions.</p>

<p>Data are available on this <a href="ftp://ftp.nrcan.gc.ca/pub/outgoing/canada_daily_grids" target="_blank">link</a>.</p>

<p>I will present a  solution based on open-source Python modules:</p>

<pre><code>    - xarray: for manipulating &amp; reading gridded data, and – very important – operate out-of-memory thanks to its dask capabilities
    - numpy: for simple array manipulations
    - geopandas: to open shapefiles
    - osgeo: 
    - matplotlib: for plotting
</code></pre>

<h3 id="1-first-we-need-to-import-librairies-and-create-aliases">1- First we need to import librairies and create aliases.</h3>

<pre><code class="language-python">import xarray as xr 
import numpy as np
import regionmask
import geopandas as gpd
import pandas as pd
import matplotlib.pyplot as plt
from osgeo import ogr
import warnings; warnings.filterwarnings(action='ignore')
%matplotlib inline
</code></pre>

<h4 id="working-over-canadian-province">Working over canadian province</h4>

<p>In this example we will use canadian province shapefiles developped by statistics canada.</p>

<p>Shapefiles are available on this <a href="https://www12.statcan.gc.ca/census-recensement/2011/geo/bound-limit/bound-limit-2016-eng.cfm" target="_blank">website</a>.</p>

<p>After downloaded the shapefile, we must load it using geopandas library:</p>

<pre><code class="language-python">PATH_TO_SHAPEFILE = './Canadian_province/lpr_000b16a_e/lpr_000b16a_e.shp'
province = gpd.read_file(PATH_TO_SHAPEFILE)
province
</code></pre>

<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">PRUID</th>
<th align="left">PRNAME</th>
<th align="left">PRENAME</th>
<th align="left">PRFNAME</th>
<th align="left">PREABBR</th>
<th align="left">PRFABBR</th>
</tr>
</thead>

<tbody>
<tr>
<td align="right">0</td>
<td align="right">10</td>
<td align="left">Newfoundland and Labrador / Terre-Neuve-et-Labrador</td>
<td align="left">Newfoundland and Labrador</td>
<td align="left">Terre-Neuve-et-Labrador</td>
<td align="left">N.L.</td>
<td align="left">T.-N.-L.</td>
</tr>

<tr>
<td align="right">1</td>
<td align="right">11</td>
<td align="left">Prince Edward Island / Île-du-Prince-Édouard</td>
<td align="left">Prince Edward Island</td>
<td align="left">Île-du-Prince-Édouard</td>
<td align="left">P.E.I.</td>
<td align="left">Î.-P.-É.</td>
</tr>

<tr>
<td align="right">2</td>
<td align="right">12</td>
<td align="left">Nova Scotia / Nouvelle-Écosse</td>
<td align="left">Nova Scotia</td>
<td align="left">Nouvelle-Écosse</td>
<td align="left">N.S.</td>
<td align="left">N.-É.</td>
</tr>

<tr>
<td align="right">3</td>
<td align="right">13</td>
<td align="left">New Brunswick / Nouveau-Brunswick</td>
<td align="left">New Brunswick</td>
<td align="left">Nouveau-Brunswick</td>
<td align="left">N.B.</td>
<td align="left">N.-B.</td>
</tr>

<tr>
<td align="right">4</td>
<td align="right">24</td>
<td align="left">Quebec / Québec</td>
<td align="left">Quebec</td>
<td align="left">Québec</td>
<td align="left">Que.</td>
<td align="left">Qc</td>
</tr>

<tr>
<td align="right">5</td>
<td align="right">35</td>
<td align="left">Ontario</td>
<td align="left">Ontario</td>
<td align="left">Ontario</td>
<td align="left">Ont.</td>
<td align="left">Ont.</td>
</tr>

<tr>
<td align="right">6</td>
<td align="right">46</td>
<td align="left">Manitoba</td>
<td align="left">Manitoba</td>
<td align="left">Manitoba</td>
<td align="left">Man.</td>
<td align="left">Man.</td>
</tr>

<tr>
<td align="right">7</td>
<td align="right">47</td>
<td align="left">Saskatchewan</td>
<td align="left">Saskatchewan</td>
<td align="left">Saskatchewan</td>
<td align="left">Sask.</td>
<td align="left">Sask.</td>
</tr>

<tr>
<td align="right">8</td>
<td align="right">48</td>
<td align="left">Alberta</td>
<td align="left">Alberta</td>
<td align="left">Alberta</td>
<td align="left">Alta.</td>
<td align="left">Alb.</td>
</tr>

<tr>
<td align="right">9</td>
<td align="right">59</td>
<td align="left">British Columbia / Colombie-Britannique</td>
<td align="left">British Columbia</td>
<td align="left">Colombie-Britannique</td>
<td align="left">B.C.</td>
<td align="left">C.-B.</td>
</tr>

<tr>
<td align="right">10</td>
<td align="right">60</td>
<td align="left">Yukon</td>
<td align="left">Yukon</td>
<td align="left">Yukon</td>
<td align="left">Y.T.</td>
<td align="left">Yn</td>
</tr>

<tr>
<td align="right">11</td>
<td align="right">61</td>
<td align="left">Northwest Territories / Territoires du Nord-Ouest</td>
<td align="left">Northwest Territories</td>
<td align="left">Territoires du Nord-Ouest</td>
<td align="left">N.W.T.</td>
<td align="left">T.N.-O.</td>
</tr>

<tr>
<td align="right">12</td>
<td align="right">62</td>
<td align="left">Nunavut</td>
<td align="left">Nunavut</td>
<td align="left">Nunavut</td>
<td align="left">Nvt.</td>
<td align="left">Nt</td>
</tr>
</tbody>
</table>

<p>Shapes are here a GeoDataFrame containing all polygons illustrating the province boundaries.</p>

<pre><code class="language-python">ID_PROV = 5
print(province.PRNAME[ID_PROV])
</code></pre>

<pre><code>Ontario
</code></pre>

<pre><code class="language-python">province.loc[:, 'geometry'].plot()
</code></pre>

<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0xad67400&gt;
</code></pre>

<p><img src="./output_6_1.png" alt="png" /></p>

<pre><code class="language-python">tmpWGS84 = province.to_crs({'proj':'longlat', 'ellps':'WGS84', 'datum':'WGS84'})
</code></pre>

<pre><code class="language-python">tmpWGS84.plot()
</code></pre>

<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1327ac88&gt;
</code></pre>

<p><img src="./output_8_1.png" alt="png" /></p>

<p>Now we can load the ANUSPLIN_10km gridded data. The parameter chunks is very important, it defines how big are the “pieces” of data moved from the disk to the memory. With this value the entire computation on a workstation with 32 GB takes a couple of minutes.</p>

<p>We will load all the temperature files using Xarray library.</p>

<pre><code class="language-python">model='ANUSPLIN_10km_YEAR_Mean_tasmoy_1950-2017'
t_in = 'J:/DONNEES_AMERIQUE_DU_NORD/ANUSPLIN_10km/Netcdf/INDICES_ANNEES/Mean_tasmoy/'        
data = t_in + model + '.nc'
ds = xr.open_mfdataset(data, chunks = {'time': 10})
ds
</code></pre>

<pre><code>&lt;xarray.Dataset&gt;
Dimensions:      (time: 68, x: 510, y: 1068)
Coordinates:
    lon          (y, x) float32 dask.array&lt;shape=(1068, 510), chunksize=(1068, 510)&gt;
    lat          (y, x) float32 dask.array&lt;shape=(1068, 510), chunksize=(1068, 510)&gt;
  * time         (time) float64 1.0 2.0 3.0 4.0 5.0 ... 64.0 65.0 66.0 67.0 68.0
Dimensions without coordinates: x, y
Data variables:
    Mean_tasmoy  (time, y, x) float32 dask.array&lt;shape=(68, 1068, 510), chunksize=(10, 1068, 510)&gt;
</code></pre>

<p>Our xarray Dataset contains a single variable (Mean_tasmoy) which is stored as a dask.array. This is the result of loading files with open_mfdataset.</p>

<p>Now we will use  regionmask module to create a gridded mask with the function regions_cls documented <a href="https://regionmask.readthedocs.io/en/stable/generated/regionmask.Regions_cls.html#regionmask.Regions_cls" target="_blank">here</a>.</p>

<p>With this function we will create an object able to mask ANUSPLIN gridded data.</p>

<pre><code class="language-python">province_mask_poly = regionmask.Regions_cls(name = 'PRENAME', numbers = list(range(0,13)), names = list(tmpWGS84.PRENAME), abbrevs = list(tmpWGS84.PRENAME), outlines = list(tmpWGS84.geometry.values[i] for i in range(0,13)))
province_mask_poly
</code></pre>

<pre><code>13 'PRENAME' Regions ()
Newfoundland and Labrador Prince Edward Island Nova Scotia New Brunswick Quebec Ontario Manitoba Saskatchewan Alberta British Columbia Yukon Northwest Territories Nunavut
</code></pre>

<p>Now we are ready to apply the mask on the gridded dataset xarray ANUSPLIN.</p>

<p>We select only the first timestep to speed up the process.</p>

<pre><code class="language-python">mask = province_mask_poly.mask(ds.isel(time = 0), lat_name='lat', lon_name='lon')
mask
</code></pre>

<pre><code>&lt;xarray.DataArray (y: 1068, x: 510)&gt;
array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       ...,
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])
Coordinates:
  * y        (y) int64 0 1 2 3 4 5 6 7 ... 1061 1062 1063 1064 1065 1066 1067
  * x        (x) int64 0 1 2 3 4 5 6 7 8 ... 501 502 503 504 505 506 507 508 509
    lat      (y, x) float32 83.45833 83.375 83.291664 ... 41.125 41.041668
    lon      (y, x) float32 -140.95833 -140.95833 ... -52.04167 -52.04167
</code></pre>

<pre><code class="language-python">mask
</code></pre>

<pre><code>&lt;xarray.DataArray (y: 1068, x: 510)&gt;
array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       ...,
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])
Coordinates:
  * y        (y) int64 0 1 2 3 4 5 6 7 ... 1061 1062 1063 1064 1065 1066 1067
  * x        (x) int64 0 1 2 3 4 5 6 7 8 ... 501 502 503 504 505 506 507 508 509
    lat      (y, x) float32 83.45833 83.375 83.291664 ... 41.125 41.041668
    lon      (y, x) float32 -140.95833 -140.95833 ... -52.04167 -52.04167
</code></pre>

<p>Mask can be saved (for example as a NetCDF) for a later use.</p>

<pre><code class="language-python">mask.to_netcdf('./mask_all_province.nc') 
</code></pre>

<p>A quick visualisation:</p>

<pre><code class="language-python">plt.figure(figsize=(15,8))
ax = plt.axes()
mask.plot(ax = ax)
province.plot(ax = ax, alpha = 0.8, facecolor = 'none', lw = 1)
</code></pre>

<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1b989828&gt;
</code></pre>

<p><img src="./output_20_1.png" alt="png" /></p>

<h3 id="2-extract-one-province">2- Extract one province</h3>

<p>We will sho how to mask Ontario province.</p>

<pre><code class="language-python">ID_PROV = 5
print(province.PRNAME[ID_PROV])
</code></pre>

<pre><code>Ontario
</code></pre>

<pre><code class="language-python">mask
</code></pre>

<pre><code>&lt;xarray.DataArray (y: 1068, x: 510)&gt;
array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       ...,
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])
Coordinates:
  * y        (y) int64 0 1 2 3 4 5 6 7 ... 1061 1062 1063 1064 1065 1066 1067
  * x        (x) int64 0 1 2 3 4 5 6 7 8 ... 501 502 503 504 505 506 507 508 509
    lat      (y, x) float32 83.45833 83.375 83.291664 ... 41.125 41.041668
    lon      (y, x) float32 -140.95833 -140.95833 ... -52.04167 -52.04167
</code></pre>

<pre><code class="language-python">out_sel2 = ds.where(mask == ID_PROV)
</code></pre>

<pre><code class="language-python">out_sel2
</code></pre>

<pre><code>&lt;xarray.Dataset&gt;
Dimensions:      (time: 68, x: 510, y: 1068)
Coordinates:
  * y            (y) int64 0 1 2 3 4 5 6 ... 1061 1062 1063 1064 1065 1066 1067
  * x            (x) int64 0 1 2 3 4 5 6 7 8 ... 502 503 504 505 506 507 508 509
    lon          (y, x) float32 dask.array&lt;shape=(1068, 510), chunksize=(1068, 510)&gt;
    lat          (y, x) float32 dask.array&lt;shape=(1068, 510), chunksize=(1068, 510)&gt;
  * time         (time) float64 1.0 2.0 3.0 4.0 5.0 ... 64.0 65.0 66.0 67.0 68.0
Data variables:
    Mean_tasmoy  (time, y, x) float32 dask.array&lt;shape=(68, 1068, 510), chunksize=(10, 1068, 510)&gt;
</code></pre>

<p>Quick visualisation, we will display the first step of our DataArray masked.</p>

<p>For out_sel2 array :</p>

<pre><code class="language-python">plt.figure(figsize=(15,8))
ax = plt.axes()
out_sel2.Mean_tasmoy.isel(time = 0).plot(ax = ax)
province.plot(ax = ax, alpha = 0.8, facecolor = 'none')
</code></pre>

<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x18bc95f8&gt;
</code></pre>

<p><img src="./output_28_1.png" alt="png" /></p>

<pre><code class="language-python">out_sel2.to_netcdf('./Ontario.nc') 
</code></pre>

<pre><code class="language-python">import matplotlib.pylab as plt
import cartopy.crs as ccrs
import cartopy.feature as cfeature
import numpy as np
import matplotlib as mpl
from netCDF4 import Dataset, num2date
import warnings
warnings.filterwarnings(&quot;ignore&quot;)
import datetime
import xarray as xr
import pandas as pd

filename='./Ontario.nc'
nc_fid=Dataset(filename,'r')
data=nc_fid.variables['Mean_tasmoy'][:].squeeze()
lons=nc_fid.variables['lon'][:].squeeze()
lats=nc_fid.variables['lat'][:].squeeze()
</code></pre>

<pre><code class="language-python">data.shape
</code></pre>

<pre><code>(68, 1068, 510)
</code></pre>

<p>Let&rsquo;s use Xarray to compute climatology over 1988-2017.</p>

<pre><code class="language-python">data_m = data[-30:,:,:]
clim_89_2017=data_m.mean(axis=0)
clim_89_2017.shape
</code></pre>

<pre><code>(1068, 510)
</code></pre>

<pre><code class="language-python">fig=plt.figure(figsize=(28,16), frameon=True)  
ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-100,-75,40,58])
ax.add_feature(cfeature.OCEAN.with_scale('50m'))      # couche ocean
ax.add_feature(cfeature.LAND.with_scale('50m'))       # couche land
ax.add_feature(cfeature.LAKES.with_scale('50m'))      # couche lac
   
ax.add_feature(cfeature.BORDERS.with_scale('50m'))    # couche frontieres
ax.add_feature(cfeature.RIVERS.with_scale('50m'))     # couche rivières 
coast = cfeature.NaturalEarthFeature(category='physical', scale='10m',     # ajout de la couche cotière 
                            facecolor='none', name='coastline')
ax.add_feature(coast, edgecolor='black')    
states_provinces = cfeature.NaturalEarthFeature(
            category='cultural',
            name='admin_1_states_provinces_lines',
            scale='10m',
            facecolor='none')
    
ax.add_feature(states_provinces, edgecolor='gray') 

 
mm = ax.contourf(lons,\
                   lats,\
                   clim_89_2017,\
                   vmin=-10,\
                   vmax=10, \
                   transform=ccrs.PlateCarree(),\
                   levels=np.arange(-10, 10, 1.),\
                   cmap=plt.cm.jet )
ax.gridlines()

# Define gridline locations and draw the lines using cartopy's built-in gridliner:
xticks = np.arange(-150.0,-40.0,20)
yticks =np.arange(10,80,10)

cbar.set_label(u'\n Projection = Lambert Conformal Conic \nResolution: 5 Arcs-Minutes (10 km)\nData provided by Natural Resources Canada / Created by Guillaume Dueymes', size='medium') # Affichage de la légende de la barre de couleur

cbar = plt.colorbar(mm,  shrink=0.75, drawedges='True',extend='both')
cbar.ax.tick_params(labelsize=17) 
    
plt.xlabel(u'\n\n\nTemperature / Température (°C)',size='x-large')
string_title=u'Climate normals of mean annual temperature (°C)\n 1988 - 2017\n'
plt.title(string_title, size='xx-large')
plt.savefig('./ANUSPLIN_Ontario_10km_YEAR_CLIM_1988-2017.png', bbox_inches='tight', pad_inches=0.1)
plt.show() 

</code></pre>

<p><img src="./output_34_0.png" alt="png" /></p>

    </div>

    







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/province_shapefiles/&amp;text=Canadian%20shapefile%20province" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/province_shapefiles/&amp;t=Canadian%20shapefile%20province" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Canadian%20shapefile%20province&amp;body=/post/province_shapefiles/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/province_shapefiles/&amp;title=Canadian%20shapefile%20province" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Canadian%20shapefile%20province%20/post/province_shapefiles/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/province_shapefiles/&amp;title=Canadian%20shapefile%20province" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hued2496a182fbb6fc8c711157078d29a6_5348924_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Guillaume Dueymes</a></h5>
      <h6 class="card-subtitle">Data Scientist and Research Assistant</h6>
      <p class="card-text">My research interests include data science, data management and climate science.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Guillaume_Dueymes" target="_blank" rel="noopener">
        <i class="fab fa-researchgate"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/guimeto" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  



  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
