<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="SQL est un langage informatique normalisé servant à exploiter des bases de données relationnelles.
  La partie langage de manipulation des données de SQL permet de rechercher, d&rsquo;ajouter, de modifier ou de supprimer des données dans les bases de données relationnelles.
  12.1- Connexion en Python à une base de données avec Pandas On va travailler avec une base de données open-source de Kaggle. https://www.kaggle.com/dimarudov/data-analysis-using-sql
12.1.1- Connexion à la base de données locale import sqlite3 path = &#39;database.">

  
  <link rel="alternate" hreflang="en-us" href="/courses/formation_python/12-requeter-une-base-sql-cours/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/courses/formation_python/12-requeter-une-base-sql-cours/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/courses/formation_python/12-requeter-une-base-sql-cours/">
  <meta property="og:title" content="12- SQL et Python - Cours | GDueymes">
  <meta property="og:description" content="SQL est un langage informatique normalisé servant à exploiter des bases de données relationnelles.
  La partie langage de manipulation des données de SQL permet de rechercher, d&rsquo;ajouter, de modifier ou de supprimer des données dans les bases de données relationnelles.
  12.1- Connexion en Python à une base de données avec Pandas On va travailler avec une base de données open-source de Kaggle. https://www.kaggle.com/dimarudov/data-analysis-using-sql
12.1.1- Connexion à la base de données locale import sqlite3 path = &#39;database."><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-05-05T00:00:00&#43;01:00">
    
    <meta property="article:modified_time" content="2019-05-05T00:00:00&#43;01:00">
  

  



  


  


  





  <title>12- SQL et Python - Cours | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/formation_python/">Overview</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/formation_python/1-introduction/">Formation en Python</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/formation_python/1-introduction/">1- Introduction</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/2-les_bases/">2- Les bases du language Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/2-les_bases-exercice/">2- Les bases du language Python - Exercices</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/3-les_listes/">3- Les listes en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/3-les_listes-exercice/">3- Les listes en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/4-les_dictionnaires/">4- Les dictionnaires en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/4-les_dictionnaires-exercice/">4- Les dictionnaires en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/5-les_boucles/">5- Les boucles en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/5-les_boucles-exercice/">5- Les boucles en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/6-les_fonctions/">6- Les fonctions en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/6-les_fonctions-exercice/">6- Les fonctions en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/7-numpy/">7- La librairie Numpy - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/7-numpy-exercice/">7- La librairie Numpy - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/8-pandas/">8- La lirairie Pandas - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/8-pandas-exercice/">8- La librairie Pandas - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/9-visualisation/">9- La visualisation graphique avec Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/9-visualisation-exercice/">9- La visualisation graphique avec Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/project1-eccc_temperature/">9.1- Projet sur les données de températures ECCC</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/project2-eccc_precipitation/">9.2- Projet sur les données de précipitations ECCC</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/10-api-cours/">10- Travailler avec des API sous Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/10-api-exercices/">10- Travailler avec des API sous Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/11-web-scraping-cours/">11- Web Scrapping - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/11-web-scraping-exercices/">11- Web scrapping - Exercice</a>
      </li>
      
      <li class="active">
        <a href="/courses/formation_python/12-requeter-une-base-sql-cours/">12- SQL et Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/12-requeter-une-base-sql-exercices/">12- SQL et Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/13-regex-cours/">13- Regex et Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/14-statistique-descriptive-cours/">14- La statistique descriptive - Rappels</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/15.1-netcdf_tutorial/">15-1- Le format Netcdf sous Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/15.2-cartopy_library/">15-2- La librairie Cartopy - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/15.3-xarray_library/">15-3 La librairie Xarray- Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-1-niveau_facile/">16.1- Exercices Python - Niveau facile</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-2-niveau_intermediaire/">16.2- Exercices Python - Niveau intermédiaire</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-3-niveau-difficile/">16.3- Exercices Python - Niveau difficile</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#121--connexion-en-python-à-une-base-de-données-avec-pandas">12.1- Connexion en Python à une base de données avec Pandas</a></li>
    <li><a href="#1211--connexion-à-la-base-de-données-locale">12.1.1- Connexion à la base de données locale</a></li>
    <li><a href="#1212--faire-des-filtres-sur-une-base-de-données">12.1.2- Faire des filtres sur une base de données</a></li>
    <li><a href="#1213--faire-des-calculs-en-sql">12.1.3- Faire des calculs en SQL</a></li>
    <li><a href="#1214--grouper-des-données-group-by-et-les-alias">12.1.4- Grouper des données: Group by et les Alias</a></li>
    <li><a href="#1215--concept-de-clé-primaire-et-étrangère">12.1.5- Concept de clé primaire et étrangère</a></li>
    <li><a href="#1216--faire-des-jointures-en-sql">12.1.6- Faire des jointures en SQL</a></li>
    <li><a href="#122--créer-un-curseur-et-exécuter-une-requête-sql-sur-python">12.2- Créer un curseur et exécuter une requête SQL sur Python</a></li>
    <li><a href="#1221--chercher-un-certain-nombre-de-résultats">12.2.1- Chercher un certain nombre de résultats</a></li>
    <li><a href="#1222--stopper-la-connexion-à-la-base-de-données">12.2.2- Stopper la connexion à la base de données</a>
      <ul>
        <li><a href="#cas-pratique">Cas pratique:</a></li>
        <li><a href="#cas-pratique2">Cas pratique2:</a></li>
      </ul>
    </li>
    <li><a href="#1223--calcul-de-statistiques-en-sql">12.2.3- Calcul de statistiques en SQL</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#opérations-mathématiques-entre-colonnes--sql">Opérations mathématiques entre colonnes  SQL</a>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>12- SQL et Python - Cours</h1>

          <div class="article-style">
            <!-- raw HTML omitted -->
<ul>
<li>
<p>SQL  est un langage informatique normalisé servant à exploiter des bases de données relationnelles.</p>
</li>
<li>
<p>La partie langage de manipulation des données de SQL permet de rechercher, d&rsquo;ajouter, de modifier ou de supprimer des données dans les bases de données relationnelles.</p>
</li>
</ul>
<p><img src="/img/formation/Python-SQL-1.jpg" alt="image0"></p>
<h2 id="121--connexion-en-python-à-une-base-de-données-avec-pandas">12.1- Connexion en Python à une base de données avec Pandas</h2>
<p>On va travailler avec une base de données open-source de Kaggle.
<a href="https://www.kaggle.com/dimarudov/data-analysis-using-sql">https://www.kaggle.com/dimarudov/data-analysis-using-sql</a></p>
<h2 id="1211--connexion-à-la-base-de-données-locale">12.1.1- Connexion à la base de données locale</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;database.sqlite&#39;</span>
conn <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(path) <span style="color:#75715e"># on crée une connexion </span>
conn
</code></pre></div><pre><code>&lt;sqlite3.Connection at 0x5a61ab0&gt;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#importer une table complète</span>
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

teams <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM Team;&#34;&#34;&#34;</span>, conn)
teams<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Selectionner certaines colonnes d&#39;une table</span>
teams <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT team_long_name,team_short_name
</span><span style="color:#e6db74">                        FROM Team;&#34;&#34;&#34;</span>, conn)
teams<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Acceder à une autre table</span>
players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM Player_Attributes;&#34;&#34;&#34;</span>, conn)
players<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Si aucune documentation sur la base de données:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Afficher toutes les tables d&#39;une base de données</span>
tables <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM sqlite_master
</span><span style="color:#e6db74">                        WHERE type=&#39;table&#39;;&#34;&#34;&#34;</span>, conn)
tables<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="1212--faire-des-filtres-sur-une-base-de-données">12.1.2- Faire des filtres sur une base de données</h2>
<ul>
<li>Appliquer un filtre</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id,overall_rating
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        WHERE overall_rating &gt; 90;&#34;&#34;&#34;</span>, conn)
players<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Appliquer un filtre et mettre une limite sur le nombre de résultats</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id,overall_rating
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        WHERE overall_rating &gt; 90
</span><span style="color:#e6db74">                        LIMIT 5;&#34;&#34;&#34;</span>, conn)
players
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Appliquer un filtre avec conditions multiples</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id,overall_rating,preferred_foot
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        WHERE overall_rating &gt; 80 and preferred_foot==&#39;left&#39;
</span><span style="color:#e6db74">                        LIMIT 5;&#34;&#34;&#34;</span>, conn)
players
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Conditions multiples sans avoir besoin de selectionner les colonnes</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        WHERE overall_rating &gt; 80 and preferred_foot==&#39;left&#39;
</span><span style="color:#e6db74">                        LIMIT 5;&#34;&#34;&#34;</span>, conn)
players
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Gérer les priorités dans les conditions</li>
</ul>
<p>Comme en mathématique avec des parenthèses.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id,overall_rating,preferred_foot,attacking_work_rate
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        WHERE (preferred_foot==&#39;right&#39;) and (overall_rating &gt; 80 or attacking_work_rate==&#39;medium&#39;)
</span><span style="color:#e6db74">                        LIMIT 5;&#34;&#34;&#34;</span>, conn)
players
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Filtre sur une série de valeurs en appliquant une liste:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">countries <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM Country;&#34;&#34;&#34;</span>, conn)
countries
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">countries <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM Country
</span><span style="color:#e6db74">                        WHERE (name IN (&#39;Belgium&#39;,&#39;France&#39;,&#39;Portugal&#39;)) ;&#34;&#34;&#34;</span>, conn)
countries
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Trier les données : ASC DSC</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Changer le tri </span>
players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id,overall_rating,preferred_foot,attacking_work_rate
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        ORDER BY overall_rating ASC
</span><span style="color:#e6db74">                        LIMIT 5;&#34;&#34;&#34;</span>, conn)
players
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Ajout d&rsquo;un filtre sur les valeurs nulles pour les ignorer:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id,overall_rating,preferred_foot,attacking_work_rate
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        WHERE overall_rating IS NOT NULL
</span><span style="color:#e6db74">                        ORDER BY overall_rating ASC
</span><span style="color:#e6db74">                        LIMIT 5;&#34;&#34;&#34;</span>, conn)
players
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Changer le tri:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id,overall_rating,preferred_foot,attacking_work_rate
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        ORDER BY overall_rating DESC
</span><span style="color:#e6db74">                        LIMIT 5;&#34;&#34;&#34;</span>, conn)
players
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Faire des doubles tris</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">players <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT id,overall_rating,preferred_foot,attacking_work_rate,standing_tackle
</span><span style="color:#e6db74">                        FROM Player_Attributes
</span><span style="color:#e6db74">                        ORDER BY overall_rating DESC,standing_tackle ASC
</span><span style="color:#e6db74">                        LIMIT 10;&#34;&#34;&#34;</span>, conn)
players
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="1213--faire-des-calculs-en-sql">12.1.3- Faire des calculs en SQL</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM match;&#34;&#34;&#34;</span>, conn)
list(match<span style="color:#f92672">.</span>columns)
</code></pre></div><pre><code>['id',
 'country_id',
 'league_id',
 'season',
 'stage',
 'date',
 'match_api_id',
 'home_team_api_id',
 'away_team_api_id',
 'home_team_goal',
 'away_team_goal',
 'home_player_X1',
 'home_player_X2',
 'home_player_X3',
 'home_player_X4',
 'home_player_X5',
 'home_player_X6',
 'home_player_X7',
 'home_player_X8',
 'home_player_X9',
 'home_player_X10',
 'home_player_X11',
 'away_player_X1',
 'away_player_X2',
 'away_player_X3',
 'away_player_X4',
 'away_player_X5',
 'away_player_X6',
 'away_player_X7',
 'away_player_X8',
 'away_player_X9',
 'away_player_X10',
 'away_player_X11',
 'home_player_Y1',
 'home_player_Y2',
 'home_player_Y3',
 'home_player_Y4',
 'home_player_Y5',
 'home_player_Y6',
 'home_player_Y7',
 'home_player_Y8',
 'home_player_Y9',
 'home_player_Y10',
 'home_player_Y11',
 'away_player_Y1',
 'away_player_Y2',
 'away_player_Y3',
 'away_player_Y4',
 'away_player_Y5',
 'away_player_Y6',
 'away_player_Y7',
 'away_player_Y8',
 'away_player_Y9',
 'away_player_Y10',
 'away_player_Y11',
 'home_player_1',
 'home_player_2',
 'home_player_3',
 'home_player_4',
 'home_player_5',
 'home_player_6',
 'home_player_7',
 'home_player_8',
 'home_player_9',
 'home_player_10',
 'home_player_11',
 'away_player_1',
 'away_player_2',
 'away_player_3',
 'away_player_4',
 'away_player_5',
 'away_player_6',
 'away_player_7',
 'away_player_8',
 'away_player_9',
 'away_player_10',
 'away_player_11',
 'goal',
 'shoton',
 'shotoff',
 'foulcommit',
 'card',
 'cross',
 'corner',
 'possession',
 'B365H',
 'B365D',
 'B365A',
 'BWH',
 'BWD',
 'BWA',
 'IWH',
 'IWD',
 'IWA',
 'LBH',
 'LBD',
 'LBA',
 'PSH',
 'PSD',
 'PSA',
 'WHH',
 'WHD',
 'WHA',
 'SJH',
 'SJD',
 'SJA',
 'VCH',
 'VCD',
 'VCA',
 'GBH',
 'GBD',
 'GBA',
 'BSH',
 'BSD',
 'BSA']
</code></pre>
<ul>
<li>Faire une somme sur une colonne:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT SUM(home_team_goal),SUM(away_team_goal)
</span><span style="color:#e6db74">                        FROM match;&#34;&#34;&#34;</span>, conn)
match
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Compter le nombre de lignes</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT COUNT(*)
</span><span style="color:#e6db74">                        FROM match;&#34;&#34;&#34;</span>, conn)
match
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#compter nombre de lignes dans une colonne ou dans une table avec filtre</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT COUNT(*)
</span><span style="color:#e6db74">                        FROM match
</span><span style="color:#e6db74">                        WHERE home_team_goal &gt; 2;&#34;&#34;&#34;</span>, conn)
match
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Trouver le maximum d&#39;une colonne</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT MAX(home_team_goal),MAX(away_team_goal)
</span><span style="color:#e6db74">                        FROM match;&#34;&#34;&#34;</span>, conn)
match
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Faire une moyenne</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT AVG(home_team_goal),AVG(away_team_goal)
</span><span style="color:#e6db74">                        FROM match;&#34;&#34;&#34;</span>, conn)
match
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="1214--grouper-des-données-group-by-et-les-alias">12.1.4- Grouper des données: Group by et les Alias</h2>
<ul>
<li>Grouper les données via une dimension: par saison ici</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Grouper les données via une dimension</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT season, AVG(home_team_goal),AVG(away_team_goal)
</span><span style="color:#e6db74">                        FROM match
</span><span style="color:#e6db74">                        GROUP BY season;&#34;&#34;&#34;</span>, conn)
match
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Renommer les variables avec les alias</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT AVG(home_team_goal) AS Moyenne_buts_domicile,AVG(away_team_goal) AS Moyenne_buts_exterieur
</span><span style="color:#e6db74">                        FROM match
</span><span style="color:#e6db74">                        GROUP BY season;&#34;&#34;&#34;</span>, conn)
match
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>Faire des filtres sur des alias</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#match = pd.read_sql(&#34;&#34;&#34;SELECT season, SUM(home_team_goal) AS Total_buts_domicile,SUM(away_team_goal) AS Total_buts_exterieur</span>
<span style="color:#75715e">#                        FROM match</span>
<span style="color:#75715e">#                        GROUP BY season</span>
<span style="color:#75715e">#                        WHERE Total_buts_domicile &gt; 5000;&#34;&#34;&#34;, conn)</span>
<span style="color:#75715e">#match</span>
</code></pre></div><p>En cas de groupe by, on ne peut plus utiliser le filtre WHERE mais HAVING</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Faire des filtres sur des alias</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT season, SUM(home_team_goal) AS Total_buts_domicile,SUM(away_team_goal) AS Total_buts_exterieur
</span><span style="color:#e6db74">                        FROM match
</span><span style="color:#e6db74">                        GROUP BY season
</span><span style="color:#e6db74">                        HAVING Total_buts_domicile &gt; 5000;&#34;&#34;&#34;</span>, conn)
match
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="1215--concept-de-clé-primaire-et-étrangère">12.1.5- Concept de clé primaire et étrangère</h2>
<ul>
<li>Avoir des infos sur une table</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">infos <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;PRAGMA table_info(match);&#34;&#34;&#34;</span>, conn)
infos<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<ul>
<li>concept de clé primaire (primary key) et de clé étrangère (foreign key)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#concept de clé primaire (primary key) et de clé étrangère (foreign key)</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM match;&#34;&#34;&#34;</span>, conn)
match<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">infos <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;PRAGMA table_info(Country);&#34;&#34;&#34;</span>, conn)
infos
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">countries <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM Country ;&#34;&#34;&#34;</span>, conn)
countries
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p><img src="/img/formation/foreign.gif" alt="primay_key.PNG"></p>
<h2 id="1216--faire-des-jointures-en-sql">12.1.6- Faire des jointures en SQL</h2>
<pre><code>- utilisation des tables MATCH, COUNTRY et TEAM
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT country.*,* FROM MATCH
</span><span style="color:#e6db74">                        INNER JOIN country
</span><span style="color:#e6db74">                        ON match.country_id == country.id;&#34;&#34;&#34;</span>, conn)
match<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Selectionner uniquement certaines tables </span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT home_team_api_id,away_team_api_id,home_team_goal,away_team_goal, country.name FROM MATCH
</span><span style="color:#e6db74">                        INNER JOIN country
</span><span style="color:#e6db74">                        ON match.country_id == country.id;&#34;&#34;&#34;</span>, conn)
match<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">team <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM team;&#34;&#34;&#34;</span>, conn)
team<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Les jointures multiples</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT team.team_long_name,away_team_api_id,home_team_goal,away_team_goal, country.name FROM MATCH
</span><span style="color:#e6db74">                        INNER JOIN country ON match.country_id == country.id
</span><span style="color:#e6db74">                        INNER JOIN team ON match.home_team_api_id == team.team_api_id;&#34;&#34;&#34;</span>, conn)
match<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Les jointures multiples sur une même table</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT tHome.team_long_name,tAway.team_long_name,home_team_goal,away_team_goal, country.name FROM MATCH
</span><span style="color:#e6db74">                        INNER JOIN country ON match.country_id == country.id
</span><span style="color:#e6db74">                        INNER JOIN team tHome ON match.home_team_api_id == tHome.team_api_id
</span><span style="color:#e6db74">                        INNER JOIN team tAway ON match.away_team_api_id == tAway.team_api_id;&#34;&#34;&#34;</span>, conn)
match<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Les jointures multiples avec Alias</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT tHome.team_long_name AS equipe_domicile,tAway.team_long_name AS equipe_exterieur,home_team_goal,away_team_goal, country.name FROM MATCH
</span><span style="color:#e6db74">                        INNER JOIN country ON match.country_id == country.id
</span><span style="color:#e6db74">                        INNER JOIN team AS tHome ON match.home_team_api_id == tHome.team_api_id
</span><span style="color:#e6db74">                        INNER JOIN team AS tAway ON match.away_team_api_id == tAway.team_api_id;&#34;&#34;&#34;</span>, conn)
match<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Les jointures multiples avec filtres</span>
match <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT tHome.team_long_name AS equipe_domicile,tAway.team_long_name AS equipe_exterieur,home_team_goal,away_team_goal, country.name FROM MATCH
</span><span style="color:#e6db74">                        INNER JOIN country ON match.country_id == country.id
</span><span style="color:#e6db74">                        INNER JOIN team AS tHome ON match.home_team_api_id == tHome.team_api_id
</span><span style="color:#e6db74">                        INNER JOIN team AS tAway ON match.away_team_api_id == tAway.team_api_id
</span><span style="color:#e6db74">                        WHERE country.name == &#39;France&#39; AND home_team_goal &gt; 2;&#34;&#34;&#34;</span>, conn)
match<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Les autres types de jointures
<img src="/img/formation/join.png" alt="join.PNG"></p>
<h2 id="122--créer-un-curseur-et-exécuter-une-requête-sql-sur-python">12.2- Créer un curseur et exécuter une requête SQL sur Python</h2>
<ul>
<li>permet de se connecter à une base de données</li>
<li>permet d&rsquo;exécuter une requête auprès de la base de données</li>
<li>permet d&rsquo;analyser les résultats de la base de données</li>
<li>permet de convertir les résultats en objets python</li>
<li>permet de stocker les résultats en variables locales</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(path) <span style="color:#75715e"># connect() on crée une instance sqlite3 qu&#39;on assigne à une variable &#39;connexion&#39;</span>
connexion
</code></pre></div><pre><code>&lt;sqlite3.Connection at 0x94923b0&gt;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># on crée un curseur de la classe cursor()</span>
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># on crée une requête SQL qu&#39;on assigne à la variable query en tant que chaîne de caractères - string</span>
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select * from recent_grads;&#34;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># execution de la requête SQL située dans la variable query </span>
<span style="color:#75715e"># le curseur convertit le résultat en tuple() et les stocke dans une variable locale</span>
cursor<span style="color:#f92672">.</span>execute(query)
</code></pre></div><pre><code>&lt;sqlite3.Cursor at 0xdcf7810&gt;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># on va chercher maintenant les résultats de la variable locale sous forme de liste de tuples()</span>
results <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchall()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results[<span style="color:#ae81ff">0</span>]
</code></pre></div><pre><code>(0,
 1,
 2419,
 'PETROLEUM ENGINEERING',
 'Engineering',
 2339,
 36,
 2057,
 282,
 0.120564344,
 1976,
 1849,
 270,
 1207,
 37,
 0.018380527,
 110000,
 95000,
 125000,
 1534,
 364,
 193)
</code></pre>
<p><!-- raw HTML omitted -->Exercice:<!-- raw HTML omitted --></p>
<ul>
<li>Ecrire une requête qui retourne toutes les valeurs de la colonne Major depuis la table recent_grads</li>
<li>Stocker les résultats (list de tuples) et assigner les à la variable majors.</li>
<li>afficher les 5 premiers tuples résultats de la major</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(path)
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major from recent_grads;&#34;</span>
major <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>execute(query)<span style="color:#f92672">.</span>fetchall()
<span style="color:#66d9ef">print</span>(major[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">5</span>])
</code></pre></div><pre><code>[('PETROLEUM ENGINEERING',), ('MINING AND MINERAL ENGINEERING',), ('METALLURGICAL ENGINEERING',), ('NAVAL ARCHITECTURE AND MARINE ENGINEERING',), ('CHEMICAL ENGINEERING',)]
</code></pre>
<h2 id="1221--chercher-un-certain-nombre-de-résultats">12.2.1- Chercher un certain nombre de résultats</h2>
<ul>
<li>fetchone(): méthode pour aller chercher un résultat</li>
<li>fetchmany(n): méthode pour aller chercher &lsquo;n&rsquo; résultats</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(path)
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major, Major_category from recent_grads;&#34;</span>
cursor<span style="color:#f92672">.</span>execute(query)
</code></pre></div><pre><code>&lt;sqlite3.Cursor at 0xac60110&gt;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">major1 <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchone()
major2 <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchone()
<span style="color:#66d9ef">print</span>(major1)
<span style="color:#66d9ef">print</span>(major2)
</code></pre></div><pre><code>('PETROLEUM ENGINEERING', 'Engineering')
('MINING AND MINERAL ENGINEERING', 'Engineering')
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">major3 <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchmany(<span style="color:#ae81ff">5</span>)
<span style="color:#66d9ef">print</span>(major3)
</code></pre></div><pre><code>[('METALLURGICAL ENGINEERING', 'Engineering'), ('NAVAL ARCHITECTURE AND MARINE ENGINEERING', 'Engineering'), ('CHEMICAL ENGINEERING', 'Engineering'), ('NUCLEAR ENGINEERING', 'Engineering'), ('ACTUARIAL SCIENCE', 'Business')]
</code></pre>
<h2 id="1222--stopper-la-connexion-à-la-base-de-données">12.2.2- Stopper la connexion à la base de données</h2>
<ul>
<li>méthode close()</li>
</ul>
<h3 id="cas-pratique">Cas pratique:</h3>
<ul>
<li>connectez-vous à la base de données jobs2.db</li>
<li>Ecrire et exécuter une requête qui retourne toutes les majors dans l&rsquo;ordre alphabétique inverse</li>
<li>Assigner le résultat complet à la variable result</li>
<li>Enfin, fermer la connexion à la base de données</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>
cursor <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(path)<span style="color:#f92672">.</span>cursor()

query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major from recent_grads order by Major DESC;&#34;</span>

cursor<span style="color:#f92672">.</span>execute(query)
result <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchall()
connexion<span style="color:#f92672">.</span>close()
result
</code></pre></div><pre><code>[('ZOOLOGY',),
 ('VISUAL AND PERFORMING ARTS',),
 ('UNITED STATES HISTORY',),
 ('TREATMENT THERAPY PROFESSIONS',),
 ('TRANSPORTATION SCIENCES AND TECHNOLOGIES',),
 ('THEOLOGY AND RELIGIOUS VOCATIONS',),
 ('TEACHER EDUCATION: MULTIPLE LEVELS',),
 ('STUDIO ARTS',),
 ('STATISTICS AND DECISION SCIENCE',),
 ('SPECIAL NEEDS EDUCATION',),
 ('SOIL SCIENCE',),
 ('SOCIOLOGY',),
 ('SOCIAL WORK',),
 ('SOCIAL SCIENCE OR HISTORY TEACHER EDUCATION',),
 ('SOCIAL PSYCHOLOGY',),
 ('SECONDARY TEACHER EDUCATION',),
 ('SCIENCE AND COMPUTER TEACHER EDUCATION',),
 ('SCHOOL STUDENT COUNSELING',),
 ('PUBLIC POLICY',),
 ('PUBLIC ADMINISTRATION',),
 ('PSYCHOLOGY',),
 ('PRE-LAW AND LEGAL STUDIES',),
 ('POLITICAL SCIENCE AND GOVERNMENT',),
 ('PLANT SCIENCE AND AGRONOMY',),
 ('PHYSIOLOGY',),
 ('PHYSICS',),
 ('PHYSICAL SCIENCES',),
 ('PHYSICAL FITNESS PARKS RECREATION AND LEISURE',),
 ('PHYSICAL AND HEALTH EDUCATION TEACHING',),
 ('PHILOSOPHY AND RELIGIOUS STUDIES',),
 ('PHARMACY PHARMACEUTICAL SCIENCES AND ADMINISTRATION',),
 ('PHARMACOLOGY',),
 ('PETROLEUM ENGINEERING',),
 ('OTHER FOREIGN LANGUAGES',),
 ('OPERATIONS LOGISTICS AND E-COMMERCE',),
 ('OCEANOGRAPHY',),
 ('NUTRITION SCIENCES',),
 ('NURSING',),
 ('NUCLEAR, INDUSTRIAL RADIOLOGY, AND BIOLOGICAL TECHNOLOGIES',),
 ('NUCLEAR ENGINEERING',),
 ('NEUROSCIENCE',),
 ('NAVAL ARCHITECTURE AND MARINE ENGINEERING',),
 ('NATURAL RESOURCES MANAGEMENT',),
 ('MUSIC',),
 ('MULTI/INTERDISCIPLINARY STUDIES',),
 ('MULTI-DISCIPLINARY OR GENERAL SCIENCE',),
 ('MOLECULAR BIOLOGY',),
 ('MISCELLANEOUS SOCIAL SCIENCES',),
 ('MISCELLANEOUS PSYCHOLOGY',),
 ('MISCELLANEOUS HEALTH MEDICAL PROFESSIONS',),
 ('MISCELLANEOUS FINE ARTS',),
 ('MISCELLANEOUS ENGINEERING TECHNOLOGIES',),
 ('MISCELLANEOUS ENGINEERING',),
 ('MISCELLANEOUS EDUCATION',),
 ('MISCELLANEOUS BUSINESS &amp; MEDICAL ADMINISTRATION',),
 ('MISCELLANEOUS BIOLOGY',),
 ('MISCELLANEOUS AGRICULTURE',),
 ('MINING AND MINERAL ENGINEERING',),
 ('MILITARY TECHNOLOGIES',),
 ('MICROBIOLOGY',),
 ('METALLURGICAL ENGINEERING',),
 ('MEDICAL TECHNOLOGIES TECHNICIANS',),
 ('MEDICAL ASSISTING SERVICES',),
 ('MECHANICAL ENGINEERING RELATED TECHNOLOGIES',),
 ('MECHANICAL ENGINEERING',),
 ('MATHEMATICS TEACHER EDUCATION',),
 ('MATHEMATICS AND COMPUTER SCIENCE',),
 ('MATHEMATICS',),
 ('MATERIALS SCIENCE',),
 ('MATERIALS ENGINEERING AND MATERIALS SCIENCE',),
 ('MASS MEDIA',),
 ('MARKETING AND MARKETING RESEARCH',),
 ('MANAGEMENT INFORMATION SYSTEMS AND STATISTICS',),
 ('LINGUISTICS AND COMPARATIVE LANGUAGE AND LITERATURE',),
 ('LIBRARY SCIENCE',),
 ('LIBERAL ARTS',),
 ('LANGUAGE AND DRAMA EDUCATION',),
 ('JOURNALISM',),
 ('INTERNATIONAL RELATIONS',),
 ('INTERNATIONAL BUSINESS',),
 ('INTERDISCIPLINARY SOCIAL SCIENCES',),
 ('INTERCULTURAL AND INTERNATIONAL STUDIES',),
 ('INFORMATION SCIENCES',),
 ('INDUSTRIAL PRODUCTION TECHNOLOGIES',),
 ('INDUSTRIAL AND ORGANIZATIONAL PSYCHOLOGY',),
 ('INDUSTRIAL AND MANUFACTURING ENGINEERING',),
 ('HUMANITIES',),
 ('HUMAN SERVICES AND COMMUNITY ORGANIZATION',),
 ('HUMAN RESOURCES AND PERSONNEL MANAGEMENT',),
 ('HOSPITALITY MANAGEMENT',),
 ('HISTORY',),
 ('HEALTH AND MEDICAL PREPARATORY PROGRAMS',),
 ('HEALTH AND MEDICAL ADMINISTRATIVE SERVICES',),
 ('GEOSCIENCES',),
 ('GEOLOGY AND EARTH SCIENCE',),
 ('GEOLOGICAL AND GEOPHYSICAL ENGINEERING',),
 ('GEOGRAPHY',),
 ('GENETICS',),
 ('GENERAL SOCIAL SCIENCES',),
 ('GENERAL MEDICAL AND HEALTH SERVICES',),
 ('GENERAL ENGINEERING',),
 ('GENERAL EDUCATION',),
 ('GENERAL BUSINESS',),
 ('GENERAL AGRICULTURE',),
 ('FRENCH GERMAN LATIN AND OTHER COMMON FOREIGN LANGUAGE STUDIES',),
 ('FORESTRY',),
 ('FOOD SCIENCE',),
 ('FINE ARTS',),
 ('FINANCE',),
 ('FILM VIDEO AND PHOTOGRAPHIC ARTS',),
 ('FAMILY AND CONSUMER SCIENCES',),
 ('ENVIRONMENTAL SCIENCE',),
 ('ENVIRONMENTAL ENGINEERING',),
 ('ENGLISH LANGUAGE AND LITERATURE',),
 ('ENGINEERING TECHNOLOGIES',),
 ('ENGINEERING MECHANICS PHYSICS AND SCIENCE',),
 ('ENGINEERING AND INDUSTRIAL MANAGEMENT',),
 ('ELEMENTARY EDUCATION',),
 ('ELECTRICAL, MECHANICAL, AND PRECISION TECHNOLOGIES AND PRODUCTION',),
 ('ELECTRICAL ENGINEERING TECHNOLOGY',),
 ('ELECTRICAL ENGINEERING',),
 ('EDUCATIONAL PSYCHOLOGY',),
 ('EDUCATIONAL ADMINISTRATION AND SUPERVISION',),
 ('ECONOMICS',),
 ('ECOLOGY',),
 ('EARLY CHILDHOOD EDUCATION',),
 ('DRAMA AND THEATER ARTS',),
 ('CRIMINOLOGY',),
 ('CRIMINAL JUSTICE AND FIRE PROTECTION',),
 ('COURT REPORTING',),
 ('COUNSELING PSYCHOLOGY',),
 ('COSMETOLOGY SERVICES AND CULINARY ARTS',),
 ('CONSTRUCTION SERVICES',),
 ('COMPUTER SCIENCE',),
 ('COMPUTER PROGRAMMING AND DATA PROCESSING',),
 ('COMPUTER NETWORKING AND TELECOMMUNICATIONS',),
 ('COMPUTER ENGINEERING',),
 ('COMPUTER AND INFORMATION SYSTEMS',),
 ('COMPUTER ADMINISTRATION MANAGEMENT AND SECURITY',),
 ('COMPOSITION AND RHETORIC',),
 ('COMMUNITY AND PUBLIC HEALTH',),
 ('COMMUNICATIONS',),
 ('COMMUNICATION TECHNOLOGIES',),
 ('COMMUNICATION DISORDERS SCIENCES AND SERVICES',),
 ('COMMERCIAL ART AND GRAPHIC DESIGN',),
 ('COGNITIVE SCIENCE AND BIOPSYCHOLOGY',),
 ('CLINICAL PSYCHOLOGY',),
 ('CIVIL ENGINEERING',),
 ('CHEMISTRY',),
 ('CHEMICAL ENGINEERING',),
 ('BUSINESS MANAGEMENT AND ADMINISTRATION',),
 ('BUSINESS ECONOMICS',),
 ('BOTANY',),
 ('BIOMEDICAL ENGINEERING',),
 ('BIOLOGY',),
 ('BIOLOGICAL ENGINEERING',),
 ('BIOCHEMICAL SCIENCES',),
 ('ATMOSPHERIC SCIENCES AND METEOROLOGY',),
 ('ASTRONOMY AND ASTROPHYSICS',),
 ('ART HISTORY AND CRITICISM',),
 ('ART AND MUSIC EDUCATION',),
 ('AREA ETHNIC AND CIVILIZATION STUDIES',),
 ('ARCHITECTURE',),
 ('ARCHITECTURAL ENGINEERING',),
 ('APPLIED MATHEMATICS',),
 ('ANTHROPOLOGY AND ARCHEOLOGY',),
 ('ANIMAL SCIENCES',),
 ('AGRICULTURE PRODUCTION AND MANAGEMENT',),
 ('AGRICULTURAL ECONOMICS',),
 ('AEROSPACE ENGINEERING',),
 ('ADVERTISING AND PUBLIC RELATIONS',),
 ('ACTUARIAL SCIENCE',),
 ('ACCOUNTING',)]
</code></pre>
<h3 id="cas-pratique2">Cas pratique2:</h3>
<ul>
<li>base de données factbook.db</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd 
<span style="color:#f92672">import</span> sqlite3
<span style="color:#f92672">import</span> math
 
<span style="color:#75715e"># Connexion à la base de données factbook.db</span>
path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(path)

<span style="color:#75715e"># Lecture des données de la table facts dans un tableau pandas</span>
a <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql_query(<span style="color:#e6db74">&#39;SELECT * FROM facts;&#39;</span>, con <span style="color:#f92672">=</span> connexion)
 
<span style="color:#75715e"># Calcul théorique:</span>
<span style="color:#75715e"># N = N0*e**(rt)</span>
<span style="color:#75715e"># N = population finale</span>
<span style="color:#75715e"># N0 = population initiale</span>
<span style="color:#75715e"># e = constante</span>
<span style="color:#75715e"># r = taux de croissance annuelle</span>
<span style="color:#75715e"># t = nombre d&#39;années entre l&#39;estimation et l&#39;initiale</span>
<span style="color:#75715e"># 5000 habitants, taux de croissance t de 4% 2015 --&gt; 2050, donc t = 35</span>
<span style="color:#75715e"># N = 5000 * e ** (0.04 * 35)</span>
 
<span style="color:#75715e"># définition de la fonction qui calcule une estimation de la population en 2015 suivant le calcul ci-dessus:</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pop_growth</span>(x):
 <span style="color:#66d9ef">return</span> x[<span style="color:#e6db74">&#39;population&#39;</span>] <span style="color:#f92672">*</span> math<span style="color:#f92672">.</span>e <span style="color:#f92672">**</span> ((x[<span style="color:#e6db74">&#39;population_growth&#39;</span>]<span style="color:#f92672">/</span><span style="color:#ae81ff">100</span>)<span style="color:#f92672">*</span> <span style="color:#ae81ff">35</span>)
 
<span style="color:#75715e"># Application de la fonction pop_growth à chaque pays + création d&#39;une colonne pop_2050 contenant les résultats</span>
a[<span style="color:#e6db74">&#39;pop_2050&#39;</span>] <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> row: pop_growth(row), axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
 
<span style="color:#75715e"># Suppression des lignes contenant des valeurs manquantes</span>
a <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>dropna(axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
 
<span style="color:#75715e"># On filtre les pays qui ont une surface terrestre &gt; 0 et une population &gt; 0</span>
a <span style="color:#f92672">=</span> a[(a[<span style="color:#e6db74">&#39;area_land&#39;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">&amp;</span> (a[<span style="color:#e6db74">&#39;population&#39;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)]
 
<span style="color:#75715e"># On trie les pays par population décroissante</span>
b <span style="color:#f92672">=</span> a<span style="color:#f92672">.</span>sort_values([<span style="color:#e6db74">&#39;pop_2050&#39;</span>], ascending <span style="color:#f92672">=</span> [False])
 
<span style="color:#75715e"># On assigne à la variable b les noms des pays correspondants limités à 10 valeurs</span>
b <span style="color:#f92672">=</span> b[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">9</span>]
 
<span style="color:#75715e"># On affiche le résultat final</span>
b

</code></pre></div><pre><code>76                                 India
36                                 China
128                              Nigeria
185                        United States
77                             Indonesia
131                             Pakistan
13                            Bangladesh
23                                Brazil
39     Congo, Democratic Republic of the
Name: name, dtype: object
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">a
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
 
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
 
<span style="color:#75715e"># On affiche dans un tableau pandas les sommes des surfaces terrestres et surfaces de l&#39;eau pour chaque pays</span>
a <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql_query(<span style="color:#e6db74">&#39;SELECT SUM(area_land), SUM(area_water)FROM facts WHERE area_land != &#34;&#34;;&#39;</span>, con <span style="color:#f92672">=</span> connexion)
 
 
<span style="color:#75715e"># On affiche le ratio Terre / Mer</span>
<span style="color:#66d9ef">print</span>(a[<span style="color:#e6db74">&#39;SUM(area_land)&#39;</span>]<span style="color:#f92672">/</span>a[<span style="color:#e6db74">&#39;SUM(area_water)&#39;</span>])
</code></pre></div><pre><code>0    28.390657
dtype: float64
</code></pre>
<h2 id="1223--calcul-de-statistiques-en-sql">12.2.3- Calcul de statistiques en SQL</h2>
<ul>
<li>moyenne</li>
<li>somme</li>
<li>Min / Max</li>
<li>Valeur unique d&rsquo;une colonne</li>
</ul>
<h4 id="compter-le-nombre-de-lignes-en-sql">Compter le nombre de lignes en SQL</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># calcul du nombre de valeurs non nulles</span>
<span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
birth_rate_tuple <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;SELECT COUNT(birth_rate)FROM facts;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
birth_rate_tuple
</code></pre></div><pre><code>[(228,)]
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">birth_rate_count <span style="color:#f92672">=</span> birth_rate_tuple[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#75715e"># première valeur du premier tuple</span>
birth_rate_count
</code></pre></div><pre><code>228
</code></pre>
<h4 id="trouver-les-valeurs-minimales-et-maximales-dune-colonne-en-sql">Trouver les valeurs minimales et maximales d&rsquo;une colonne en SQL</h4>
<ul>
<li>fonctions MIN() et MAX()</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># calcul des valeurs minimales et maximales</span>
<span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
population_grouwth_tuple <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select min(population_growth) from facts;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
population_grouwth_min <span style="color:#f92672">=</span> population_grouwth_tuple[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
population_grouwth_min
</code></pre></div><pre><code>0.0
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">population_death_tuple <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select max(death_rate) from facts;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
population_death_max <span style="color:#f92672">=</span> population_death_tuple[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
population_death_max
</code></pre></div><pre><code>14.89
</code></pre>
<h4 id="calculer-des-sommes-et-des-moyennes-en-sql">Calculer des sommes et des moyennes en SQL</h4>
<ul>
<li>fonctions SUM() et AVG()</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
area_land_sum_tuple <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select sum(area_land) from facts;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
area_land_sum <span style="color:#f92672">=</span> area_land_sum_tuple[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
area_land_sum
</code></pre></div><pre><code>128584834
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
area_water_avg_tuple <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select avg(area_water) from facts;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
area_water_avg <span style="color:#f92672">=</span> area_water_avg_tuple[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
area_water_avg
</code></pre></div><pre><code>19067.59259259259
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">connexion<span style="color:#f92672">.</span>close()
</code></pre></div><h4 id="combiner-des-fonctions-sur-une-seule-requête-en-sql">Combiner des fonctions sur une seule requête en SQL</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
facts_stats <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select avg(population), sum(population), max(birth_rate) from facts;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
facts_stats
</code></pre></div><pre><code>[(62094928.32231405, 15026972654, 45.45)]
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mean_pop <span style="color:#f92672">=</span> facts_stats[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
sum_pop <span style="color:#f92672">=</span> facts_stats[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>]
max_birth_rate <span style="color:#f92672">=</span>  facts_stats[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">2</span>]
<span style="color:#66d9ef">print</span>(mean_pop)
<span style="color:#66d9ef">print</span>(sum_pop)
<span style="color:#66d9ef">print</span>(max_birth_rate)
</code></pre></div><pre><code>62094928.32231405
15026972654
45.45
</code></pre>
<h4 id="associer-les-fonctions-de-calcul-avec-la-condition--where-">Associer les fonctions de calcul avec la condition &quot; where &quot;</h4>
<ul>
<li>WHERE</li>
<li>Écrire une requête SQL qui calcule la moyenne de la colonne population_growth pour les pays ayant une population supérieure à 100000000 habitants</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
pop_query <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select avg(population_growth) from facts where (population &gt; 10000000);&#39;</span>)<span style="color:#f92672">.</span>fetchall()
population_growth <span style="color:#f92672">=</span> pop_query[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
population_growth
</code></pre></div><pre><code>1.4572222222222226
</code></pre>
<h4 id="sélectionner-des-éléments-ou-des-données-uniques">Sélectionner des éléments ou des données uniques</h4>
<ul>
<li>DISTINCT</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
unique_birth_rates <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select distinct birth_rate from facts ;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
</code></pre></div><h4 id="associer-des-fonctions-de-calcul-avec-la-fonction-distinct">Associer des fonctions de calcul avec la fonction DISTINCT</h4>
<ul>
<li>Trouver la moyenne des valeurs distinctes de la colonne birth_rate pour lesquelles population est plus grand que 20 00 000</li>
<li>Trouver la somme de toutes les valeurs distinctes de la colonne population pour lesquelles area_land est plus grand que 1000000</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
mean_birth_rate <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select avg(distinct birth_rate) from facts where population &gt; 20000000 ;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
mean_birth_rate[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
</code></pre></div><pre><code>20.43473684210527
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
cournt_population <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select sum(distinct population) from facts where area_land &gt; 1000000 ;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
cournt_population[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
</code></pre></div><pre><code>4233873015
</code></pre>
<h4 id="opérations-mathématiques-en-sql">Opérations mathématiques en SQL</h4>
<ul>
<li>Afficher les valeurs de la colonne population_growth en millions (décimales)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
population_million <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select  population_growth / 100000000.0 from facts ;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
population_million[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
</code></pre></div><pre><code>2.32e-08
</code></pre>
<h2 id="opérations-mathématiques-entre-colonnes--sql">Opérations mathématiques entre colonnes  SQL</h2>
<ul>
<li>Ecrire une requête SQL qui calcule pour chaque pays le nombre d&rsquo;habitants qu&rsquo;il y aura l&rsquo;année suivante</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sqlite3
connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/factbook.db&#39;</span>)
population_next_year <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;select name, ((population_growth + 1) * population) from facts ;&#39;</span>)<span style="color:#f92672">.</span>fetchall()
<span style="color:#75715e">#population_next_year</span>
</code></pre></div><h4 id="statistiques-sur-des-groupes-de-données">Statistiques sur des groupes de données</h4>
<p>-group by: permet de faire des statistiques sur des groupes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>)
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major_category, sum(Employed) from recent_grads group by major_category;&#34;</span>
major <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>execute(query)<span style="color:#f92672">.</span>fetchall()
<span style="color:#66d9ef">print</span>(major[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">5</span>])
</code></pre></div><pre><code>[('Agriculture &amp; Natural Resources', 66943), ('Arts', 288114), ('Biology &amp; Life Science', 302797), ('Business', 1088742), ('Communications &amp; Journalism', 330660)]
</code></pre>
<ul>
<li>Trouver le pourcentage moyenne de femmes pour chaque catégorie de majors</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>)
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major_category, avg(ShareWomen)*100 from recent_grads group by major_category;&#34;</span>
femme_pourcentage <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>execute(query)<span style="color:#f92672">.</span>fetchall()
<span style="color:#66d9ef">print</span>(femme_pourcentage[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">5</span>])
</code></pre></div><pre><code>[('Agriculture &amp; Natural Resources', 61.79384232), ('Arts', 56.185119574999995), ('Biology &amp; Life Science', 58.4518475857143), ('Business', 40.50631853076923), ('Communications &amp; Journalism', 64.383484025)]
</code></pre>
<h4 id="renommer-les-colonnes-avec-la-commande-as">Renommer les colonnes avec la commande AS</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>)
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major_category, avg(Employed) / avg(Total) as share_employed from recent_grads group by major_category;&#34;</span>
new_pourcentage <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>execute(query)<span style="color:#f92672">.</span>fetchall()
new_pourcentage
</code></pre></div><pre><code>[('Agriculture &amp; Natural Resources', 0.8369862842425075),
 ('Arts', 0.8067482429367457),
 ('Biology &amp; Life Science', 0.6671565365683841),
 ('Business', 0.8359659576036412),
 ('Communications &amp; Journalism', 0.8422291333949735),
 ('Computers &amp; Mathematics', 0.7956108197773972),
 ('Education', 0.858190149321534),
 ('Engineering', 0.7819666916550562),
 ('Health', 0.8033741337996244),
 ('Humanities &amp; Liberal Arts', 0.7626382682895378),
 ('Industrial Arts &amp; Consumer Services', 0.8226700668430581),
 ('Interdisciplinary', 0.7987150292778139),
 ('Law &amp; Public Policy', 0.8083994483744353),
 ('Physical Sciences', 0.7506564085422069),
 ('Psychology &amp; Social Work', 0.790724459311403),
 ('Social Science', 0.7575825619001975)]
</code></pre>
<h4 id="colonnes-virtuelles-et-having">Colonnes virtuelles et HAVING</h4>
<ul>
<li>si colonne générée par group by et renommée par as , elle n&rsquo;existe pas et on ne peut pas faire un tri avec where dessus</li>
<li>pour cela on peut utiliser la commande HAVING: filtrer sur des commandes virtuelles</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>)
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major_category, avg(Employed) / avg(Total) as share_employed from recent_grads group by major_category HAVING share_employed &gt; 0.8;&#34;</span>
new_pourcentage <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>execute(query)<span style="color:#f92672">.</span>fetchall() 
new_pourcentage
</code></pre></div><pre><code>[('Agriculture &amp; Natural Resources', 0.8369862842425075),
 ('Arts', 0.8067482429367457),
 ('Business', 0.8359659576036412),
 ('Communications &amp; Journalism', 0.8422291333949735),
 ('Education', 0.858190149321534),
 ('Health', 0.8033741337996244),
 ('Industrial Arts &amp; Consumer Services', 0.8226700668430581),
 ('Law &amp; Public Policy', 0.8083994483744353)]
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>)
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major_category, avg(Low_wage_jobs) / avg(Total) as share_low_wage from recent_grads group by major_category HAVING share_low_wage &gt; 0.1;&#34;</span>
new_pourcentage <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>execute(query)<span style="color:#f92672">.</span>fetchall() 
new_pourcentage
</code></pre></div><pre><code>[('Arts', 0.16833085991095678),
 ('Communications &amp; Journalism', 0.1263241815481876),
 ('Humanities &amp; Liberal Arts', 0.13208721344194835),
 ('Industrial Arts &amp; Consumer Services', 0.11571334076033978),
 ('Law &amp; Public Policy', 0.11568503743572278),
 ('Psychology &amp; Social Work', 0.11693384919554187),
 ('Social Science', 0.10223297343603174)]
</code></pre>
<h4 id="fonction-round">Fonction ROUND</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">connexion <span style="color:#f92672">=</span> sqlite3<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&#39;./SQL/jobs.db/jobs.db&#39;</span>)
cursor <span style="color:#f92672">=</span> connexion<span style="color:#f92672">.</span>cursor()
query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select Major_category, round( avg( Low_wage_jobs) / avg(Total), 2 ) as share_low_wage from recent_grads group by major_category HAVING share_low_wage &gt; 0.1;&#34;</span>
new_pourcentage <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>execute(query)<span style="color:#f92672">.</span>fetchall() 
new_pourcentage
connexion<span style="color:#f92672">.</span>close()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

teams <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql(<span style="color:#e6db74">&#34;&#34;&#34;SELECT *
</span><span style="color:#e6db74">                        FROM Team;&#34;&#34;&#34;</span>, conn)
teams<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
</code></pre></div>
          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/formation_python/11-web-scraping-exercices/" rel="next">11- Web scrapping - Exercice</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/formation_python/12-requeter-une-base-sql-exercices/" rel="prev">12- SQL et Python - Exercice</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on May 5, 2019</p>

          





  
  

<p class="edit-page">
  <a href="https://github.com/gcushen/hugo-academic/edit/master/content/courses%5cFormation_Python%5c12%20-%20Requ%c3%aater%20une%20base%20SQL%20-%20cours.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
