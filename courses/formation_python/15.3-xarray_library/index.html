<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="Dans ce tutoriel, nous utiliserons les fonctionnalités de la bibliothèque Xarray pour traiter et analyser des produits au format Netcdf.
Xarray possède deux structures de données de base, qui s&rsquo;appuient sur et étendent les forces de base de NumPy et Pandas. Les deux structures de données sont fondamentalement N-dimensionnelles:
1- DataArray xarray.DataArray est l&rsquo;implémentation par xarray d&rsquo;un tableau multidimensionnel étiqueté. Il possède plusieurs propriétés clés:
2- DataSet xarray.Dataset est l&rsquo;équivalent multidimensionnel d&rsquo;un DataFrame.">

  
  <link rel="alternate" hreflang="en-us" href="/courses/formation_python/15.3-xarray_library/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/courses/formation_python/15.3-xarray_library/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/courses/formation_python/15.3-xarray_library/">
  <meta property="og:title" content="15-3 La librairie Xarray- Cours | GDueymes">
  <meta property="og:description" content="Dans ce tutoriel, nous utiliserons les fonctionnalités de la bibliothèque Xarray pour traiter et analyser des produits au format Netcdf.
Xarray possède deux structures de données de base, qui s&rsquo;appuient sur et étendent les forces de base de NumPy et Pandas. Les deux structures de données sont fondamentalement N-dimensionnelles:
1- DataArray xarray.DataArray est l&rsquo;implémentation par xarray d&rsquo;un tableau multidimensionnel étiqueté. Il possède plusieurs propriétés clés:
2- DataSet xarray.Dataset est l&rsquo;équivalent multidimensionnel d&rsquo;un DataFrame."><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-05-05T00:00:00&#43;01:00">
    
    <meta property="article:modified_time" content="2019-05-05T00:00:00&#43;01:00">
  

  



  


  


  





  <title>15-3 La librairie Xarray- Cours | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/formation_python/">Overview</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/formation_python/1-introduction/">Formation en Python</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/formation_python/1-introduction/">1- Introduction</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/2-les_bases/">2- Les bases du language Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/2-les_bases-exercice/">2- Les bases du language Python - Exercices</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/3-les_listes/">3- Les listes en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/3-les_listes-exercice/">3- Les listes en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/4-les_dictionnaires/">4- Les dictionnaires en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/4-les_dictionnaires-exercice/">4- Les dictionnaires en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/5-les_boucles/">5- Les boucles en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/5-les_boucles-exercice/">5- Les boucles en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/6-les_fonctions/">6- Les fonctions en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/6-les_fonctions-exercice/">6- Les fonctions en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/7-numpy/">7- La librairie Numpy - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/7-numpy-exercice/">7- La librairie Numpy - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/8-pandas/">8- La lirairie Pandas - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/8-pandas-exercice/">8- La librairie Pandas - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/9-visualisation/">9- La visualisation graphique avec Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/9-visualisation-exercice/">9- La visualisation graphique avec Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/project1-eccc_temperature/">9.1- Projet sur les données de températures ECCC</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/project2-eccc_precipitation/">9.2- Projet sur les données de précipitations ECCC</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/10-api-cours/">10- Travailler avec des API sous Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/10-api-exercices/">10- Travailler avec des API sous Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/11-web-scraping-cours/">11- Web Scrapping - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/11-web-scraping-exercices/">11- Web scrapping - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/12-requeter-une-base-sql-cours/">12- SQL et Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/12-requeter-une-base-sql-exercices/">12- SQL et Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/13-regex-cours/">13- Regex et Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/14-statistique-descriptive-cours/">14- La statistique descriptive - Rappels</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/15.1-netcdf_tutorial/">15-1- Le format Netcdf sous Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/15.2-cartopy_library/">15-2- La librairie Cartopy - Cours</a>
      </li>
      
      <li class="active">
        <a href="/courses/formation_python/15.3-xarray_library/">15-3 La librairie Xarray- Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-1-niveau_facile/">16.1- Exercices Python - Niveau facile</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-2-niveau_intermediaire/">16.2- Exercices Python - Niveau intermédiaire</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-3-niveau-difficile/">16.3- Exercices Python - Niveau difficile</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#151---ouvrir-un-fichier-netcdf">15.1 - Ouvrir un fichier Netcdf</a></li>
    <li><a href="#152---explorer-un-jeu-de-données-netcdf">15.2 - Explorer un jeu de données Netcdf</a></li>
    <li><a href="#153---opérations-de-base-avec-xarray">15.3 - Opérations de base avec Xarray</a></li>
    <li><a href="#1531---sélectionner-une-date">15.3.1 - Sélectionner une date:</a></li>
    <li><a href="#1532---sélectionner-une-période-de-temps">15.3.2 - Sélectionner une période de temps:</a></li>
    <li><a href="#1533---exporter-un-dataset-en-dataframe">15.3.3 - Exporter un dataset en dataframe:</a></li>
    <li><a href="#1534---opérations-de-base-avec-xarray">15.3.4 - Opérations de base avec Xarray:</a></li>
    <li><a href="#1535--select-grid-points-from-netcdf-file-using-xarray">15.3.5- Select grid points from Netcdf file using Xarray</a></li>
    <li><a href="#gridpoint--to-extract-the-closest-grid-point-of-a-latitude--longitude">Gridpoint:  to extract the closest grid point of a latitude / longitude:</a></li>
    <li><a href="#gridpoints--to-extract-a-list-of-points">Gridpoints:  to extract a list of points</a></li>
    <li><a href="#to-extract-an-area-or-subdomain-delimited-by-latitude-and-longitude-values-slicing">To extract an area or subdomain delimited by latitude and longitude values: .slicing()</a></li>
    <li><a href="#to-mask-an-area-delimited-by-a-shapefile">To mask an area delimited by a Shapefile:</a></li>
    <li><a href="#1536--last-example-using-xarray">15.3.6- Last example using Xarray:</a></li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>15-3 La librairie Xarray- Cours</h1>

          <div class="article-style">
            <p>Dans ce tutoriel, nous utiliserons les fonctionnalités de la bibliothèque  Xarray pour traiter et analyser des produits au format Netcdf.</p>
<p><img src="/img/formation/xarray.png" alt="image0"></p>
<p>Xarray possède deux structures de données de base, qui s&rsquo;appuient sur et étendent les forces de base de NumPy et  Pandas. Les deux structures de données sont fondamentalement N-dimensionnelles:</p>
<p><!-- raw HTML omitted -->1-  DataArray <!-- raw HTML omitted --></p>
<p>xarray.DataArray est l&rsquo;implémentation par xarray d&rsquo;un tableau multidimensionnel étiqueté. Il possède plusieurs propriétés clés:</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->2- DataSet <!-- raw HTML omitted --></p>
<p>xarray.Dataset est l&rsquo;équivalent multidimensionnel d&rsquo;un DataFrame. Il s&rsquo;agit d&rsquo;un conteneur de type dict de tableaux étiquetés (objets DataArray) avec des dimensions alignées. Il est conçu comme une représentation en mémoire du modèle de données du format de fichier netCDF.</p>
<p>xarray.DataSet est une collection de DataArrays. Chaque fichier NEtcdf contient un Dataset.</p>
<h2 id="151---ouvrir-un-fichier-netcdf">15.1 - Ouvrir un fichier Netcdf</h2>
<p>Nous allons ouvrir et stocker les données d&rsquo;un fichier Netcdf dans un ensemble de données.</p>
<p>Nous devons d&rsquo;abord importer des bibliothèques et créer des alias.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> xarray <span style="color:#f92672">as</span> xr
<span style="color:#f92672">import</span> warnings; warnings<span style="color:#f92672">.</span>filterwarnings(action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ignore&#39;</span>)
<span style="color:#f92672">from</span> matplotlib <span style="color:#f92672">import</span> pyplot <span style="color:#66d9ef">as</span> plt
<span style="color:#f92672">%</span>matplotlib inline
plt<span style="color:#f92672">.</span>rcParams[<span style="color:#e6db74">&#39;figure.figsize&#39;</span>] <span style="color:#f92672">=</span> (<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">5</span>)
</code></pre></div><ul>
<li>Pour importer et stocker en tant que Dataset un seul fichier Netcdf:</li>
</ul>
<p>Nous allons travailler ici avec les champs de température issus de la réanalyse globale de CERA20C.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">unique_dataDIR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./DATA/CERA20C/cera20c_member0_TAS_197101_day.nc&#39;</span>
TAS <span style="color:#f92672">=</span> xr<span style="color:#f92672">.</span>open_dataset(unique_dataDIR)
TAS
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li>Pour importer plusieurs fichier Netcdf:</li>
</ul>
<p>Ici, nous voulons stocker tous les noms de fichiers commençant par «cera20c_member0_TAS_» et situés dans le chemin «./data/cera20c/».</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">multi_dataDIR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./DATA/CERA20C/cera20c_member0_TAS_*.nc&#39;</span>
TAS2 <span style="color:#f92672">=</span> xr<span style="color:#f92672">.</span>open_mfdataset(multi_dataDIR)
TAS2
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li>Combiner des fichiers Netcdf:</li>
</ul>
<p>Pour combiner des variables et des coordonnées entre plusieurs objets DataArray et/ou Dataset, on utilise la méthode <!-- raw HTML omitted -->.merge()<!-- raw HTML omitted -->. Il peut fusionner une liste de Dataset, DataArray ou des dictionnaires d&rsquo;objets convertibles en objets DataArray:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">multi_dataDIR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./DATA/CERA20C/cera20c_member0_TAS_*.nc&#39;</span>
TAS2 <span style="color:#f92672">=</span> xr<span style="color:#f92672">.</span>open_mfdataset(multi_dataDIR)
multi_dataDIR2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./DATA/CERA20C/cera20c_member0_SIC_*.nc&#39;</span>
SIC2 <span style="color:#f92672">=</span> xr<span style="color:#f92672">.</span>open_mfdataset(multi_dataDIR2)

DS_new <span style="color:#f92672">=</span> xr<span style="color:#f92672">.</span>merge([TAS2,SIC2])
DS_new
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="152---explorer-un-jeu-de-données-netcdf">15.2 - Explorer un jeu de données Netcdf</h2>
<p>Nous pouvons rapidement explorer nos ensembles de données en utilisant certaines méthodes de la bibliothèque xarray:</p>
<pre><code>- DS.var
- DS.dims
- DS.coords
- DS.attrs
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_new<span style="color:#f92672">.</span>var
</code></pre></div><pre><code>&lt;bound method ImplementsDatasetReduce._reduce_method.&lt;locals&gt;.wrapped_func of &lt;xarray.Dataset&gt;
Dimensions:    (bnds: 2, latitude: 145, longitude: 288, time: 365)
Coordinates:
  * latitude   (latitude) float32 90.0 88.75 87.5 86.25 ... -87.5 -88.75 -90.0
  * longitude  (longitude) float32 0.0 1.25 2.5 3.75 ... 356.25 357.5 358.75
  * time       (time) datetime64[ns] 1971-01-01T10:30:00 ... 1971-12-31T10:30:00
Dimensions without coordinates: bnds
Data variables:
    time_bnds  (time, bnds) datetime64[ns] dask.array&lt;chunksize=(31, 2), meta=np.ndarray&gt;
    t2m        (time, latitude, longitude) float32 dask.array&lt;chunksize=(31, 145, 288), meta=np.ndarray&gt;
    siconc     (time, latitude, longitude) float32 dask.array&lt;chunksize=(31, 145, 288), meta=np.ndarray&gt;&gt;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_new<span style="color:#f92672">.</span>dims
</code></pre></div><pre><code>Frozen(SortedKeysDict({'latitude': 145, 'longitude': 288, 'time': 365, 'bnds': 2}))
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_new<span style="color:#f92672">.</span>coords
</code></pre></div><pre><code>Coordinates:
  * latitude   (latitude) float32 90.0 88.75 87.5 86.25 ... -87.5 -88.75 -90.0
  * longitude  (longitude) float32 0.0 1.25 2.5 3.75 ... 356.25 357.5 358.75
  * time       (time) datetime64[ns] 1971-01-01T10:30:00 ... 1971-12-31T10:30:00
</code></pre>
<h2 id="153---opérations-de-base-avec-xarray">15.3 - Opérations de base avec Xarray</h2>
<h2 id="1531---sélectionner-une-date">15.3.1 - Sélectionner une date:</h2>
<p>Nous pouvons utiliser la méthode .sel() pour sélectionner un pas de temps de notre Dataset.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_date <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>sel(time<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1971-01-01&#39;</span>)
DS_date
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="1532---sélectionner-une-période-de-temps">15.3.2 - Sélectionner une période de temps:</h2>
<p>On peut sélectionner une période de temps avec le &ldquo;slicing&rdquo;:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_date_range <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>sel(time<span style="color:#f92672">=</span>slice(<span style="color:#e6db74">&#39;1971-06-01&#39;</span>, <span style="color:#e6db74">&#39;1971-08-31&#39;</span>))
DS_date_range
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="1533---exporter-un-dataset-en-dataframe">15.3.3 - Exporter un dataset en dataframe:</h2>
<p>Nous pouvons exporter notre ensemble de données dans un DataFrame de Pandas, puis utiliser la bibliothèque Pandas pour effectuer une analyse.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> DS_date_range<span style="color:#f92672">.</span>to_dataframe()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df<span style="color:#f92672">.</span>describe()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h2 id="1534---opérations-de-base-avec-xarray">15.3.4 - Opérations de base avec Xarray:</h2>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Mean_array <span style="color:#f92672">=</span> DS_date_range<span style="color:#f92672">.</span>mean(dim<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;time&#39;</span>)
Mean_array<span style="color:#f92672">.</span>values
</code></pre></div><pre><code>&lt;bound method Mapping.values of &lt;xarray.Dataset&gt;
Dimensions:    (latitude: 145, longitude: 288)
Coordinates:
  * latitude   (latitude) float32 90.0 88.75 87.5 86.25 ... -87.5 -88.75 -90.0
  * longitude  (longitude) float32 0.0 1.25 2.5 3.75 ... 356.25 357.5 358.75
Data variables:
    t2m        (latitude, longitude) float32 dask.array&lt;chunksize=(145, 288), meta=np.ndarray&gt;
    siconc     (latitude, longitude) float32 dask.array&lt;chunksize=(145, 288), meta=np.ndarray&gt;&gt;
</code></pre>
<ul>
<li>Pour sauvegarder nos résultats en csv:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Mean_array<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>to_dataframe()<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#39;./DATA/CERA20C_T2m_mean.csv&#39;</span>)
</code></pre></div><!-- raw HTML omitted -->
<p>Moyenne suivant toutes les latitudes et longitudes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_date_range<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>mean(dim<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;latitude&#39;</span>, <span style="color:#e6db74">&#39;longitude&#39;</span>))
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_date_range<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>mean(dim<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;latitude&#39;</span>, <span style="color:#e6db74">&#39;longitude&#39;</span>))<span style="color:#f92672">.</span>plot()
</code></pre></div><pre><code>[&lt;matplotlib.lines.Line2D at 0xbbb52e8&gt;]
</code></pre>
<p><img src="/img/formation/netcdf3/output_26_1.png" alt="png"></p>
<ul>
<li>Pour sauvegarder nos résultats en csv:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_date_range<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>mean(dim<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;time&#39;</span>, <span style="color:#e6db74">&#39;longitude&#39;</span>))<span style="color:#f92672">.</span>to_dataframe()<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#39;./DATA/CERA20C_T2m_2Dmean.csv&#39;</span>)
</code></pre></div><ul>
<li>Quick plot with Xarray</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> cartopy.crs <span style="color:#f92672">as</span> ccrs
fig<span style="color:#f92672">=</span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">10</span>), frameon<span style="color:#f92672">=</span>True) 

ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>axes(projection<span style="color:#f92672">=</span>ccrs<span style="color:#f92672">.</span>Orthographic(<span style="color:#f92672">-</span><span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">35</span>))
Mean_array<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>contourf(ax<span style="color:#f92672">=</span>ax, transform<span style="color:#f92672">=</span>ccrs<span style="color:#f92672">.</span>PlateCarree());
ax<span style="color:#f92672">.</span>set_global(); ax<span style="color:#f92672">.</span>coastlines();
</code></pre></div><p><img src="/img/formation/netcdf3/output_30_0.png" alt="png"></p>
<!-- raw HTML omitted -->
<p>Dans cette exemple, nous allons moyenne le Dataset DS_date_range et appliquer une simple opération arythmétique pour changer les unités.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">centigrade <span style="color:#f92672">=</span> DS_date_range<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>mean(dim<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;time&#39;</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">273.16</span>
centigrade<span style="color:#f92672">.</span>values
</code></pre></div><pre><code>array([[ -1.2229004,  -1.2229004,  -1.2229004, ...,  -1.2229004,
         -1.2229004,  -1.2229004],
       [ -1.3348389,  -1.3311157,  -1.3274231, ...,  -1.3488159,
         -1.3442383,  -1.3395386],
       [ -1.6027222,  -1.5914001,  -1.5804138, ...,  -1.6451721,
         -1.631012 ,  -1.6168518],
       ...,
       [-58.547928 , -58.5663   , -58.58455  , ..., -58.314026 ,
        -58.391983 , -58.46997  ],
       [-59.556473 , -59.577957 , -59.59955  , ..., -59.478424 ,
        -59.50441  , -59.53041  ],
       [-60.739105 , -60.739105 , -60.739105 , ..., -60.739105 ,
        -60.739105 , -60.739105 ]], dtype=float32)
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig<span style="color:#f92672">=</span>plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">10</span>), frameon<span style="color:#f92672">=</span>True)
ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>axes(projection<span style="color:#f92672">=</span>ccrs<span style="color:#f92672">.</span>Orthographic(<span style="color:#f92672">-</span><span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">35</span>))
centigrade<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>contourf(ax<span style="color:#f92672">=</span>ax, transform<span style="color:#f92672">=</span>ccrs<span style="color:#f92672">.</span>PlateCarree());
ax<span style="color:#f92672">.</span>set_global(); ax<span style="color:#f92672">.</span>coastlines();
</code></pre></div><p><img src="/img/formation/netcdf3/output_34_0.png" alt="png"></p>
<!-- raw HTML omitted -->
<p>Tout comme une manipulation de jeux de données sous Pandas, la méthode groupdby() avec Xarray est très utile pour regrouper nos Dataset par mois, saison, année &hellip; puis y appliquer des fonctions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">TAS2
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li>Calcul des moyennes mensuelles:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_month <span style="color:#f92672">=</span> TAS2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.month&#39;</span>)<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#39;time&#39;</span>)
DS_month
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>On peut ainsi s&rsquo;appuyer sur une méthode groupby() pour calculer des climatologies et des anomalies associées.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">climatology <span style="color:#f92672">=</span> TAS2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.month&#39;</span>)<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#39;time&#39;</span>)
anomalies <span style="color:#f92672">=</span> TAS2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.month&#39;</span>) <span style="color:#f92672">-</span> climatology
</code></pre></div><p>Autre exemple, on va calculer les anomalies standardisées mensuelles de la température</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data_clim <span style="color:#f92672">=</span> TAS2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.month&#39;</span>)<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#34;time&#34;</span>)
data_std <span style="color:#f92672">=</span> TAS2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.month&#39;</span>)<span style="color:#f92672">.</span>std(<span style="color:#e6db74">&#34;time&#34;</span>)
data_std
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># seaon mean:</span>
DS_season <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.season&#39;</span>)<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#39;time&#39;</span>)
DS_season
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># year mean:</span>
DS_year <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.year&#39;</span>)<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#39;time&#39;</span>)
DS_year
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li>to select a specific season:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_winter <span style="color:#f92672">=</span> DS_season<span style="color:#f92672">.</span>sel(season<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;DJF&#39;</span>)
DS_winter
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>In the example below, we will group the xarray.DataArray data by season, calculate the average, apply a simple arrhythmic operation and plot the resulting fields for each season.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_Season <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.season&#39;</span>)<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#39;time&#39;</span>)<span style="color:#f92672">-</span> <span style="color:#ae81ff">273.15</span>
fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, ncols<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">5</span>))
j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> i, season <span style="color:#f92672">in</span> enumerate((<span style="color:#e6db74">&#39;DJF&#39;</span>, <span style="color:#e6db74">&#39;MAM&#39;</span>, <span style="color:#e6db74">&#39;JJA&#39;</span>, <span style="color:#e6db74">&#39;SON&#39;</span>)):
    <span style="color:#66d9ef">if</span> season <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;JJA&#39;</span>:
        j <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">elif</span> season <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;SON&#39;</span>:
        i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        
    DS_Season<span style="color:#f92672">.</span>sel(season<span style="color:#f92672">=</span>season)<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>pcolormesh(
        ax<span style="color:#f92672">=</span>axes[i, j], vmin<span style="color:#f92672">=-</span><span style="color:#ae81ff">30</span>, vmax<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Spectral_r&#39;</span>,
        add_colorbar<span style="color:#f92672">=</span>True, extend<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;both&#39;</span>)

<span style="color:#66d9ef">for</span> ax <span style="color:#f92672">in</span> axes<span style="color:#f92672">.</span>flat:
    ax<span style="color:#f92672">.</span>axes<span style="color:#f92672">.</span>get_xaxis()<span style="color:#f92672">.</span>set_ticklabels([])
    ax<span style="color:#f92672">.</span>axes<span style="color:#f92672">.</span>get_yaxis()<span style="color:#f92672">.</span>set_ticklabels([])
    ax<span style="color:#f92672">.</span>axes<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;tight&#39;</span>)
   
plt<span style="color:#f92672">.</span>tight_layout()
fig<span style="color:#f92672">.</span>suptitle(<span style="color:#e6db74">&#39;Seasonal Surface Air Temperature&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>, y<span style="color:#f92672">=</span><span style="color:#ae81ff">1.02</span>)
</code></pre></div><pre><code>Text(0.5, 1.02, 'Seasonal Surface Air Temperature')
</code></pre>
<p><img src="/img/formation/netcdf3/output_49_1.png" alt="png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
lat_bnd <span style="color:#f92672">=</span> [<span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">50</span>]
lon_bnd <span style="color:#f92672">=</span> [<span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">310</span>]
DS_Season <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>sel(longitude<span style="color:#f92672">=</span>slice(<span style="color:#f92672">*</span>lon_bnd), latitude<span style="color:#f92672">=</span>slice(<span style="color:#f92672">*</span>lat_bnd),)<span style="color:#f92672">.</span>siconc<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.season&#39;</span>)<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#39;time&#39;</span>) <span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>

fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(nrows<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, ncols<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">10</span>))
j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> i, season <span style="color:#f92672">in</span> enumerate((<span style="color:#e6db74">&#39;DJF&#39;</span>, <span style="color:#e6db74">&#39;MAM&#39;</span>, <span style="color:#e6db74">&#39;JJA&#39;</span>, <span style="color:#e6db74">&#39;SON&#39;</span>)):
    <span style="color:#66d9ef">if</span> season <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;JJA&#39;</span>:
        j <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">elif</span> season <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;SON&#39;</span>:
        i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        
    DS_Season<span style="color:#f92672">.</span>sel(season<span style="color:#f92672">=</span>season)<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>pcolormesh(
        ax<span style="color:#f92672">=</span>axes[i, j], vmin<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, vmax<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Spectral_r&#39;</span>,
        add_colorbar<span style="color:#f92672">=</span>True, extend<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;both&#39;</span>)
<span style="color:#66d9ef">for</span> ax <span style="color:#f92672">in</span> axes<span style="color:#f92672">.</span>flat:
    ax<span style="color:#f92672">.</span>axes<span style="color:#f92672">.</span>get_xaxis()<span style="color:#f92672">.</span>set_ticklabels([])
    ax<span style="color:#f92672">.</span>axes<span style="color:#f92672">.</span>get_yaxis()<span style="color:#f92672">.</span>set_ticklabels([])
    ax<span style="color:#f92672">.</span>axes<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;tight&#39;</span>)
   
plt<span style="color:#f92672">.</span>tight_layout()
fig<span style="color:#f92672">.</span>suptitle(<span style="color:#e6db74">&#39;Seasonal Sea Ice Concentration&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>, y<span style="color:#f92672">=</span><span style="color:#ae81ff">1.02</span>)
</code></pre></div><pre><code>Text(0.5, 1.02, 'Seasonal Sea Ice Concentration')
</code></pre>
<p><img src="/img/formation/netcdf3/output_50_1.png" alt="png"></p>
<p>To save our result into Netcdf:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">DS_season <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.season&#39;</span>)<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#39;time&#39;</span>)
dataDIR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./DATA/CERA20C_season.nc&#39;</span>
DS_Season<span style="color:#f92672">.</span>to_netcdf(dataDIR)

</code></pre></div><h2 id="1535--select-grid-points-from-netcdf-file-using-xarray">15.3.5- Select grid points from Netcdf file using Xarray</h2>
<p>In the previous section we applied the .sel () method to work on the time dimension. This method can be used on spatial dimensions to extract points or study areas from our netcdf file.</p>
<h2 id="gridpoint--to-extract-the-closest-grid-point-of-a-latitude--longitude">Gridpoint:  to extract the closest grid point of a latitude / longitude:</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">lati <span style="color:#f92672">=</span> <span style="color:#ae81ff">45.5</span>
loni <span style="color:#f92672">=</span> <span style="color:#ae81ff">269.2</span>
data  <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>sel(longitude<span style="color:#f92672">=</span>loni  , latitude<span style="color:#f92672">=</span>lati  , method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;nearest&#39;</span>) 
data
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data[<span style="color:#e6db74">&#39;t2m&#39;</span>] <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;t2m&#39;</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">273.15</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data<span style="color:#f92672">.</span>t2m
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>We can convert our selection into a DataFrame and then use Pandas to analyse our results.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>to_dataframe()
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">8</span>))
df[<span style="color:#e6db74">&#39;t2m&#39;</span>]<span style="color:#f92672">.</span>plot()
</code></pre></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x10446e48&gt;
</code></pre>
<p><img src="/img/formation/netcdf3/output_59_1.png" alt="png"></p>
<h2 id="gridpoints--to-extract-a-list-of-points">Gridpoints:  to extract a list of points</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">lats <span style="color:#f92672">=</span>  [<span style="color:#ae81ff">20.0</span>,<span style="color:#ae81ff">50.0</span>,<span style="color:#ae81ff">90.0</span>]
lons <span style="color:#f92672">=</span>  [<span style="color:#ae81ff">60.0</span>,<span style="color:#ae81ff">80.0</span>,<span style="color:#ae81ff">120.0</span>]

data  <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>sel(longitude<span style="color:#f92672">=</span>lons  , latitude<span style="color:#f92672">=</span>lats  , method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;nearest&#39;</span>)
data[<span style="color:#e6db74">&#39;t2m&#39;</span>] <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#39;t2m&#39;</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">273.15</span>
data
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">8</span>))
data<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>sel(longitude<span style="color:#f92672">=</span><span style="color:#ae81ff">60.0</span>, latitude<span style="color:#f92672">=</span>[<span style="color:#ae81ff">20.0</span>,<span style="color:#ae81ff">50.0</span>,<span style="color:#ae81ff">90.0</span>])<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>line(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;time&#39;</span>)
</code></pre></div><pre><code>[&lt;matplotlib.lines.Line2D at 0x10ded080&gt;,
 &lt;matplotlib.lines.Line2D at 0x112c9588&gt;,
 &lt;matplotlib.lines.Line2D at 0x112c97f0&gt;]
</code></pre>
<p><img src="/img/formation/netcdf3/output_62_1.png" alt="png"></p>
<h2 id="to-extract-an-area-or-subdomain-delimited-by-latitude-and-longitude-values-slicing">To extract an area or subdomain delimited by latitude and longitude values: .slicing()</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">lat_bnd <span style="color:#f92672">=</span> [<span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">50</span>]
lon_bnd <span style="color:#f92672">=</span> [<span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">310</span>]
area <span style="color:#f92672">=</span> DS_new<span style="color:#f92672">.</span>sel(longitude<span style="color:#f92672">=</span>slice(<span style="color:#f92672">*</span>lon_bnd), latitude<span style="color:#f92672">=</span>slice(<span style="color:#f92672">*</span>lat_bnd),)
area
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">area<span style="color:#f92672">.</span>longitude<span style="color:#f92672">.</span>values
</code></pre></div><pre><code>array([250.  , 251.25, 252.5 , 253.75, 255.  , 256.25, 257.5 , 258.75,
       260.  , 261.25, 262.5 , 263.75, 265.  , 266.25, 267.5 , 268.75,
       270.  , 271.25, 272.5 , 273.75, 275.  , 276.25, 277.5 , 278.75,
       280.  , 281.25, 282.5 , 283.75, 285.  , 286.25, 287.5 , 288.75,
       290.  , 291.25, 292.5 , 293.75, 295.  , 296.25, 297.5 , 298.75,
       300.  , 301.25, 302.5 , 303.75, 305.  , 306.25, 307.5 , 308.75,
       310.  ], dtype=float32)
</code></pre>
<p>To visualize our area::</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> cartopy.crs <span style="color:#f92672">as</span> ccrs
<span style="color:#f92672">import</span> cartopy.feature <span style="color:#f92672">as</span> cfeat
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_figure</span>():
    fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">12</span>))
    ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, projection<span style="color:#f92672">=</span>ccrs<span style="color:#f92672">.</span>PlateCarree())

    <span style="color:#75715e"># generate a basemap with country borders, oceans and coastlines</span>
    ax<span style="color:#f92672">.</span>add_feature(cfeat<span style="color:#f92672">.</span>LAND)
    ax<span style="color:#f92672">.</span>add_feature(cfeat<span style="color:#f92672">.</span>OCEAN)
    ax<span style="color:#f92672">.</span>add_feature(cfeat<span style="color:#f92672">.</span>COASTLINE)
    ax<span style="color:#f92672">.</span>add_feature(cfeat<span style="color:#f92672">.</span>BORDERS, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dotted&#39;</span>)
    <span style="color:#66d9ef">return</span> fig, ax

make_figure();
</code></pre></div><p><img src="/img/formation/netcdf3/output_67_0.png" alt="png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">_, ax <span style="color:#f92672">=</span> make_figure()
<span style="color:#75715e"># plot the temperature field</span>
area<span style="color:#f92672">.</span>t2m[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>plot()
</code></pre></div><pre><code>&lt;matplotlib.collections.QuadMesh at 0xec83630&gt;
</code></pre>
<p><img src="/img/formation/netcdf3/output_68_1.png" alt="png"></p>
<h2 id="to-mask-an-area-delimited-by-a-shapefile">To mask an area delimited by a Shapefile:</h2>
<p>To do this, we need to import two more librairies:</p>
<ul>
<li>Geopandas: conda install -c conda-forge geopandas</li>
<li>osgeo: conda install -c conda-forge gdal</li>
</ul>
<p>The next function will open a shapefile, read the polygons and make a mask from each grid points of our Netcdf inside the polygons.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> osgeo <span style="color:#f92672">import</span> ogr
<span style="color:#f92672">import</span> geopandas <span style="color:#f92672">as</span> gpd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_mask</span>(lons2d, lats2d, shp_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>, polygon_name<span style="color:#f92672">=</span>None):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Assumes that the shape file contains polygons in lat lon coordinates
</span><span style="color:#e6db74">    :param lons2d:
</span><span style="color:#e6db74">    :param lats2d:
</span><span style="color:#e6db74">    :param shp_path:
</span><span style="color:#e6db74">    :rtype : np.ndarray
</span><span style="color:#e6db74">    The mask is 1 for the points inside of the polygons
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    ds <span style="color:#f92672">=</span> ogr<span style="color:#f92672">.</span>Open(shp_path)
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    :type : ogr.DataSource
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    xx <span style="color:#f92672">=</span> lons2d<span style="color:#f92672">.</span>copy()
    yy <span style="color:#f92672">=</span> lats2d

    <span style="color:#75715e"># set longitudes to be from -180 to 180</span>
    xx[xx <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">180</span>] <span style="color:#f92672">-=</span> <span style="color:#ae81ff">360</span>

    mask <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(lons2d<span style="color:#f92672">.</span>shape, dtype<span style="color:#f92672">=</span>int)
    nx, ny <span style="color:#f92672">=</span> mask<span style="color:#f92672">.</span>shape

    pt <span style="color:#f92672">=</span> ogr<span style="color:#f92672">.</span>Geometry(ogr<span style="color:#f92672">.</span>wkbPoint)

    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(ds<span style="color:#f92672">.</span>GetLayerCount()):
        layer <span style="color:#f92672">=</span> ds<span style="color:#f92672">.</span>GetLayer(i)
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        :type : ogr.Layer
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>

        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(layer<span style="color:#f92672">.</span>GetFeatureCount()):
            feat <span style="color:#f92672">=</span> layer<span style="color:#f92672">.</span>GetFeature(j)
            <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">            :type : ogr.Feature
</span><span style="color:#e6db74">            &#34;&#34;&#34;</span>

            <span style="color:#75715e"># Select polygons by the name property</span>
            <span style="color:#66d9ef">if</span> polygon_name <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> feat<span style="color:#f92672">.</span>GetFieldAsString(<span style="color:#e6db74">&#34;NAME&#34;</span>) <span style="color:#f92672">==</span> polygon_name:
                    <span style="color:#66d9ef">continue</span>

            g <span style="color:#f92672">=</span> feat<span style="color:#f92672">.</span>GetGeometryRef()
            <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">            :type : ogr.Geometry
</span><span style="color:#e6db74">            &#34;&#34;&#34;</span>

            <span style="color:#66d9ef">assert</span> isinstance(g, ogr<span style="color:#f92672">.</span>Geometry)

            <span style="color:#66d9ef">for</span> pi <span style="color:#f92672">in</span> range(nx):
                <span style="color:#66d9ef">for</span> pj <span style="color:#f92672">in</span> range(ny):
                    pt<span style="color:#f92672">.</span>SetPoint_2D(<span style="color:#ae81ff">0</span>, float(xx[pi, pj]), float(yy[pi, pj]))

                    mask[pi, pj] <span style="color:#f92672">+=</span> int(g<span style="color:#f92672">.</span>Contains(pt))

    <span style="color:#66d9ef">return</span> mask

</code></pre></div><p>We first read the Netcdf file and store informations in a Xarray.dataset.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ds <span style="color:#f92672">=</span> xr<span style="color:#f92672">.</span>open_dataset(<span style="color:#e6db74">&#39;./DATA/CERA20C/cera20c_member0_TAS_197101_day.nc&#39;</span>)
</code></pre></div><p>We then need to extract latitudes and longitudes values and compute a 2D matrix.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Imp_Lats <span style="color:#f92672">=</span>  ds[<span style="color:#e6db74">&#39;latitude&#39;</span>]<span style="color:#f92672">.</span>values
Imp_Lons <span style="color:#f92672">=</span>  ds[<span style="color:#e6db74">&#39;longitude&#39;</span>]<span style="color:#f92672">.</span>values
lon2d, lat2d <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(Imp_Lons, Imp_Lats)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ds_mean <span style="color:#f92672">=</span> ds<span style="color:#f92672">.</span>mean(<span style="color:#e6db74">&#39;time&#39;</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">273.15</span>
ds_mean
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>We open the shape file with Geopandas library.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">shapes <span style="color:#f92672">=</span> gpd<span style="color:#f92672">.</span>read_file(<span style="color:#e6db74">&#34;./DATA/Shapefiles/Countries_Final-polygon.shp&#34;</span>)
list(shapes<span style="color:#f92672">.</span>columns<span style="color:#f92672">.</span>values)
</code></pre></div><pre><code>['FIPS',
 'ISO2',
 'ISO3',
 'UN',
 'NAME',
 'AREA',
 'POP2005',
 'REGION',
 'SUBREGION',
 'LON',
 'LAT',
 'layer',
 'path',
 'geometry']
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">shapes<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">shapes<span style="color:#f92672">.</span>loc[<span style="color:#ae81ff">27</span>, <span style="color:#e6db74">&#39;geometry&#39;</span>]
shapes<span style="color:#f92672">.</span>plot()
</code></pre></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0xee1c668&gt;
</code></pre>
<p><img src="/img/formation/netcdf3/output_80_1.png" alt="png"></p>
<p>We want in our study to extract information inside Mexico shapefile.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mask<span style="color:#f92672">=</span>get_mask(lon2d,lat2d,shp_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./DATA/Shapefiles/Countries_Final-polygon.shp&#34;</span>, polygon_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Mexico&#39;</span>) 
np<span style="color:#f92672">.</span>max(mask)
</code></pre></div><pre><code>1
</code></pre>
<p>We will convert our mask into numpy 2D array. We&rsquo;ll be later able to apply this matrix to mask our Netcdf file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">np<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#39;DATA/Mexico.npy&#39;</span>,mask) <span style="color:#75715e"># saving our mask in numpy.array</span>
</code></pre></div><p>We will mask our area using .where() method.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ds_mask <span style="color:#f92672">=</span> ds_mean<span style="color:#f92672">.</span>where(mask <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) 
ds_mask<span style="color:#f92672">.</span>to_netcdf(<span style="color:#e6db74">&#39;DATA/Mexico.nc&#39;</span>)  <span style="color:#75715e"># we want to save our shapefile mask in Netcdf format</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ds_mask
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">np<span style="color:#f92672">.</span>max(ds_mask<span style="color:#f92672">.</span>t2m)
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">_, ax <span style="color:#f92672">=</span> make_figure()
<span style="color:#75715e"># plot the temperature field</span>
lat_bnd <span style="color:#f92672">=</span> [<span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">0</span>]
lon_bnd <span style="color:#f92672">=</span> [<span style="color:#ae81ff">200</span>, <span style="color:#ae81ff">320</span>]
ds_mask<span style="color:#f92672">.</span>t2m<span style="color:#f92672">.</span>sel(longitude<span style="color:#f92672">=</span>slice(<span style="color:#f92672">*</span>lon_bnd), latitude<span style="color:#f92672">=</span>slice(<span style="color:#f92672">*</span>lat_bnd),)<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>pcolormesh(vmin<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, vmax<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Spectral&#39;</span>,add_colorbar<span style="color:#f92672">=</span>True, extend<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;both&#39;</span>)
</code></pre></div><pre><code>&lt;matplotlib.collections.QuadMesh at 0x14beada0&gt;
</code></pre>
<p><img src="/img/formation/netcdf3/output_89_1.png" alt="png"></p>
<h2 id="1536--last-example-using-xarray">15.3.6- Last example using Xarray:</h2>
<p>In this section, We will calculate the seasonal accumulation of the precipitation, extract a region, plot the domain and record our result in Netcdf:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Let&#39;s open cera20c_enda_ep_PR_*.nc netcdf files </span>
multi_dataDIR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./DATA/CERA20C/cera20c_enda_ep_PR_*.nc&#39;</span>
array <span style="color:#f92672">=</span> xr<span style="color:#f92672">.</span>open_mfdataset(multi_dataDIR)
array<span style="color:#f92672">.</span>tp
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>All Netcdf files are stored in DataArray container, we can now group our Datasets by season, apply a simple sum() method over time and then change units from meters to mm.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">array_season <span style="color:#f92672">=</span> array<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;time.season&#39;</span>)<span style="color:#f92672">.</span>sum(<span style="color:#e6db74">&#39;time&#39;</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>
array_season
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>We want to extract a specific domain delimited: 
- latitude boundaries: 50N to 70N
- longitude boudaries: 250E to 310E</p>
<p>We finally want to extract winter season.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">lat_bnd <span style="color:#f92672">=</span> [<span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">50</span>]
lon_bnd <span style="color:#f92672">=</span> [<span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">310</span>]
subset_season_DJF <span style="color:#f92672">=</span> array_season<span style="color:#f92672">.</span>sel(season <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;DJF&#39;</span>, longitude<span style="color:#f92672">=</span>slice(<span style="color:#f92672">*</span>lon_bnd), latitude<span style="color:#f92672">=</span>slice(<span style="color:#f92672">*</span>lat_bnd),)
subset_season_DJF
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Let&rsquo;s save the Dataset to Netcdf.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataDIR <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;./DATA/subset_season.nc&#39;</span>
subset_season_DJF<span style="color:#f92672">.</span>to_netcdf(dataDIR)
</code></pre></div><p>We can call our make_figure() function to quick plot our Dataset.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">_, ax <span style="color:#f92672">=</span> make_figure()
<span style="color:#75715e"># plot the temperature field</span>
subset_season_DJF<span style="color:#f92672">.</span>tp<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>pcolormesh(vmin<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, vmax<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Spectral&#39;</span>,add_colorbar<span style="color:#f92672">=</span>True, extend<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;both&#39;</span>)
</code></pre></div><pre><code>&lt;matplotlib.collections.QuadMesh at 0x150a4240&gt;
</code></pre>
<p><img src="/img/formation/netcdf3/output_99_1.png" alt="png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
</code></pre></div>
          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/formation_python/15.2-cartopy_library/" rel="next">15-2- La librairie Cartopy - Cours</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/formation_python/16-1-niveau_facile/" rel="prev">16.1- Exercices Python - Niveau facile</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on May 5, 2019</p>

          





  
  

<p class="edit-page">
  <a href="https://github.com/gcushen/hugo-academic/edit/master/content/courses%5cFormation_Python%5c15.3-Xarray_Library.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
