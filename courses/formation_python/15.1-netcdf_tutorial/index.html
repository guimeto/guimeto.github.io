<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="Le format Netcdf (de l&rsquo;anglais Network Common Data Form) est un moyen de créer, d&rsquo;accéder et de partager des données scientifiques dans un format auto-documenté et transparent pour de nombreux types de machines.
  Le fichier Netcdf lui-même contient des informations décrivant les données qu&rsquo;il contient.
Un fichier NetCDF a des dimensions, des variables et des attributs. Voici un petit exemple de fichier NetCDF, pour illustrer ces concepts de dimensions, variables et attributs.">

  
  <link rel="alternate" hreflang="en-us" href="/courses/formation_python/15.1-netcdf_tutorial/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/courses/formation_python/15.1-netcdf_tutorial/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/courses/formation_python/15.1-netcdf_tutorial/">
  <meta property="og:title" content="15-1- Le format Netcdf sous Python - Cours | GDueymes">
  <meta property="og:description" content="Le format Netcdf (de l&rsquo;anglais Network Common Data Form) est un moyen de créer, d&rsquo;accéder et de partager des données scientifiques dans un format auto-documenté et transparent pour de nombreux types de machines.
  Le fichier Netcdf lui-même contient des informations décrivant les données qu&rsquo;il contient.
Un fichier NetCDF a des dimensions, des variables et des attributs. Voici un petit exemple de fichier NetCDF, pour illustrer ces concepts de dimensions, variables et attributs."><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-05-05T00:00:00&#43;01:00">
    
    <meta property="article:modified_time" content="2019-05-05T00:00:00&#43;01:00">
  

  



  


  


  





  <title>15-1- Le format Netcdf sous Python - Cours | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/formation_python/">Overview</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/formation_python/1-introduction/">Formation en Python</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/formation_python/1-introduction/">1- Introduction</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/2-les_bases/">2- Les bases du language Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/2-les_bases-exercice/">2- Les bases du language Python - Exercices</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/3-les_listes/">3- Les listes en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/3-les_listes-exercice/">3- Les listes en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/4-les_dictionnaires/">4- Les dictionnaires en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/4-les_dictionnaires-exercice/">4- Les dictionnaires en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/5-les_boucles/">5- Les boucles en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/5-les_boucles-exercice/">5- Les boucles en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/6-les_fonctions/">6- Les fonctions en Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/6-les_fonctions-exercice/">6- Les fonctions en Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/7-numpy/">7- La librairie Numpy - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/7-numpy-exercice/">7- La librairie Numpy - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/8-pandas/">8- La lirairie Pandas - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/8-pandas-exercice/">8- La librairie Pandas - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/9-visualisation/">9- La visualisation graphique avec Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/9-visualisation-exercice/">9- La visualisation graphique avec Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/project1-eccc_temperature/">9.1- Projet sur les données de températures ECCC</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/project2-eccc_precipitation/">9.2- Projet sur les données de précipitations ECCC</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/10-api-cours/">10- Travailler avec des API sous Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/10-api-exercices/">10- Travailler avec des API sous Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/11-web-scraping-cours/">11- Web Scrapping - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/11-web-scraping-exercices/">11- Web scrapping - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/12-requeter-une-base-sql-cours/">12- SQL et Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/12-requeter-une-base-sql-exercices/">12- SQL et Python - Exercice</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/13-regex-cours/">13- Regex et Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/14-statistique-descriptive-cours/">14- La statistique descriptive - Rappels</a>
      </li>
      
      <li class="active">
        <a href="/courses/formation_python/15.1-netcdf_tutorial/">15-1- Le format Netcdf sous Python - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/15.2-cartopy_library/">15-2- La librairie Cartopy - Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/15.3-xarray_library/">15-3 La librairie Xarray- Cours</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-1-niveau_facile/">16.1- Exercices Python - Niveau facile</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-2-niveau_intermediaire/">16.2- Exercices Python - Niveau intermédiaire</a>
      </li>
      
      <li >
        <a href="/courses/formation_python/16-3-niveau-difficile/">16.3- Exercices Python - Niveau difficile</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#image0imgformationxarraypng"><img src="/img/formation/xarray.png" alt="image0"></a></li>
    <li><a href="#151--créer-un-fichier-netcdf">15.1- Créer un fichier Netcdf:</a></li>
    <li><a href="#152--lire-un-fichier-netcdf">15.2- Lire un fichier Netcdf:</a></li>
    <li><a href="#153--manipuler-un-fichier-netcdf">15.3- Manipuler un fichier Netcdf:</a></li>
    <li><a href="#154--extraire-un-point-de-grille">15.4- Extraire un point de grille:</a></li>
    <li><a href="#155--extraire-un-domaine-délimité-par-une-boite-2d">15.5- Extraire un domaine délimité par une boite 2D:</a></li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>15-1- Le format Netcdf sous Python - Cours</h1>

          <div class="article-style">
            <p>Le format Netcdf (de l&rsquo;anglais Network Common Data Form) est un moyen de créer, d&rsquo;accéder et de partager des données scientifiques dans un format auto-documenté et transparent pour de nombreux types de machines.</p>
<hr>
<h2 id="image0imgformationxarraypng"><img src="/img/formation/xarray.png" alt="image0"></h2>
<p>Le fichier Netcdf lui-même contient des informations décrivant les données qu&rsquo;il contient.</p>
<p>Un fichier NetCDF a des dimensions, des variables et des attributs. Voici un petit exemple de fichier NetCDF, pour illustrer ces concepts de dimensions, variables et attributs.</p>
<p>La notation utilisée pour décrire ce fichier NetCDF est appelée Network Common Data Language (CDL). Il donne une version &ldquo;texte&rdquo; qui permet de comprendre facilement la structure et le contenu d&rsquo;un fichier binaire NetCDF:</p>
<pre><code>netcdf ./data/NARR_tasmax_201701.nc {
  dimensions:
x = 349;
y = 277;
time = 31;
  variables:
float lon(y=277, x=349);
  :units = &quot;degrees_east&quot;;
  :long_name = &quot;Longitude&quot;;
  :CoordinateAxisType = &quot;Lon&quot;;

float lat(y=277, x=349);
  :units = &quot;degrees_north&quot;;
  :long_name = &quot;Latitude&quot;;
  :CoordinateAxisType = &quot;Lat&quot;;

double time(time=31);
  :long_name = &quot;Time&quot;;
  :delta_t = &quot;&quot;;

float tasmax(time=31, y=277, x=349);
  :long_name = &quot;Daily maximum temperature&quot;;
  :units = &quot;Celcius&quot;;
  :missing_value = -999.0; // double
  :coordinates = &quot;lon lat&quot;;
</code></pre>
<p>}</p>
<ul>
<li>
<p><!-- raw HTML omitted -->Panoply<!-- raw HTML omitted --> est un logiciel open source utilisé pour lire rapidement et visualiser un fichier Netcdf:</p>
</li>
<li>
<p>Le module python que nous utiliserons dans cette section est <!-- raw HTML omitted -->netCDF4<!-- raw HTML omitted -->.</p>
</li>
</ul>
<p>Pour installer le module sous Anaconda: <!-- raw HTML omitted -->conda install -c anaconda netcdf4<!-- raw HTML omitted --></p>
<p><img src="/img/formation/CanESM2_rcp85_r1i1p1_global_tos.jpg" alt="image0"></p>
<h2 id="151--créer-un-fichier-netcdf">15.1- Créer un fichier Netcdf:</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> netCDF4 <span style="color:#f92672">import</span> Dataset
<span style="color:#f92672">import</span> os 
<span style="color:#f92672">import</span> warnings
warnings<span style="color:#f92672">.</span>filterwarnings(<span style="color:#e6db74">&#34;ignore&#34;</span>)

file_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./DATA/2D_Temperature.nc&#34;</span>
<span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isfile(file_name):
    os<span style="color:#f92672">.</span>remove(file_name)
    
<span style="color:#75715e"># Ouverture du fichier pour écriture, on peut spécifier le format=&#34;NETCDF4_CLASSIC&#34; ou &#34;NETCDF3_CLASSIC&#34;</span>
<span style="color:#75715e"># par défault on aura NETCDF4</span>

ds <span style="color:#f92672">=</span> Dataset(file_name, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;w&#34;</span>)
</code></pre></div><ul>
<li>Netcdf4-python: <!-- raw HTML omitted -->createDimension<!-- raw HTML omitted --></li>
</ul>
<p>Nous allons créer un champs 2D: (20,20)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ds<span style="color:#f92672">.</span>createDimension(<span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#ae81ff">20</span>)
ds<span style="color:#f92672">.</span>createDimension(<span style="color:#e6db74">&#34;y&#34;</span>, <span style="color:#ae81ff">20</span>)
ds<span style="color:#f92672">.</span>createDimension(<span style="color:#e6db74">&#34;time&#34;</span>, None)
</code></pre></div><pre><code>&lt;class 'netCDF4._netCDF4.Dimension'&gt; (unlimited): name = 'time', size = 0
</code></pre>
<ul>
<li>Netcdf4-python: <!-- raw HTML omitted -->createVariable<!-- raw HTML omitted --></li>
</ul>
<p>Nous allons créer deux variables : var1 et var2 et définir leurs dimensions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">var1 <span style="color:#f92672">=</span> ds<span style="color:#f92672">.</span>createVariable(<span style="color:#e6db74">&#34;field1&#34;</span>, <span style="color:#e6db74">&#34;f4&#34;</span>, (<span style="color:#e6db74">&#34;time&#34;</span>, <span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#e6db74">&#34;y&#34;</span>))
var2 <span style="color:#f92672">=</span> ds<span style="color:#f92672">.</span>createVariable(<span style="color:#e6db74">&#34;field2&#34;</span>, <span style="color:#e6db74">&#34;f4&#34;</span>, (<span style="color:#e6db74">&#34;time&#34;</span>, <span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#e6db74">&#34;y&#34;</span>))

<span style="color:#75715e">#add netcdf attributes</span>
var1<span style="color:#f92672">.</span>units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Celcius&#34;</span>
var1<span style="color:#f92672">.</span>long_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Surface air temperature&#34;</span>

var2<span style="color:#f92672">.</span>units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Kelvin&#34;</span>
var2<span style="color:#f92672">.</span>long_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Surface air temperature&#34;</span>

</code></pre></div><p>Nous pouvons maintenant assigner notre champs ou variable. 
Dans notre exemple on va générer des données aléatoires et indiquer au programme où il doit les assigner.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randn(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>)
var1[:] <span style="color:#f92672">=</span> data
var2[:] <span style="color:#f92672">=</span>  data <span style="color:#f92672">+</span> <span style="color:#ae81ff">273.15</span>
ds<span style="color:#f92672">.</span>close();
</code></pre></div><p>Voilà, notre fichier est écrit sur notre disque.</p>
<h2 id="152--lire-un-fichier-netcdf">15.2- Lire un fichier Netcdf:</h2>
<p>Nous allons lire le fichier Netcdf4 que nous avons créer dans la section précédente.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> netCDF4 <span style="color:#f92672">import</span> Dataset
ds <span style="color:#f92672">=</span> Dataset(<span style="color:#e6db74">&#34;./DATA/2D_Temperature.nc&#34;</span>)
</code></pre></div><p>Nous allons sélectionner les variables d&rsquo;intérêt: aucune donnée n&rsquo;est chargée à ce stade.</p>
<p>Pour connaitre quelles sont les variables présentes dans notre fichier Netcdf:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(ds<span style="color:#f92672">.</span>variables<span style="color:#f92672">.</span>keys())

<span style="color:#66d9ef">print</span>(ds<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#34;field1&#34;</span>]<span style="color:#f92672">.</span>dimensions, ds<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#34;field1&#34;</span>]<span style="color:#f92672">.</span>shape)
</code></pre></div><pre><code>odict_keys(['field1', 'field2'])
('time', 'x', 'y') (10, 20, 20)
</code></pre>
<p>Nous allons lire les données, à ce stade, les données sont chargées en mémoire.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data1_var <span style="color:#f92672">=</span> ds<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#34;field1&#34;</span>]
all_data <span style="color:#f92672">=</span> data1_var[:]
<span style="color:#66d9ef">print</span>(all_data<span style="color:#f92672">.</span>shape)
</code></pre></div><pre><code>(10, 20, 20)
</code></pre>
<p>On va par exemple aller chercher le premier pas de temps:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data_step1 <span style="color:#f92672">=</span> data1_var[<span style="color:#ae81ff">1</span>,:,:]
<span style="color:#66d9ef">print</span>(data_step1<span style="color:#f92672">.</span>shape, data_step1<span style="color:#f92672">.</span>shape, data_step1<span style="color:#f92672">.</span>mean())
</code></pre></div><pre><code>(20, 20) (20, 20) -0.022204468
</code></pre>
<h2 id="153--manipuler-un-fichier-netcdf">15.3- Manipuler un fichier Netcdf:</h2>
<p>Dans cet exemple, nous travaillerons avec des données de températures maximales quotidiennes pour tous les mois de janvier de 1971 à 2000 à partir du modèle régional CRCM5 développé au centre ESCER.</p>
<p>Nous allons importer notre propre module de calcul des indices de température, ce module est appelé Indices_Température.</p>
<p>Dans un premier temps, nous importons les bibliothèques nécessaires.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> netCDF4 <span style="color:#f92672">import</span> Dataset
<span style="color:#f92672">import</span> Indices_Temperature
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
</code></pre></div><ul>
<li>Ouvrons le premier fichier Netcdf &lsquo;CRCM5-v1_NAM-44_ll_CCCma-CanESM2_historical_tasmax_197101.nc&rsquo;:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nc_Modc<span style="color:#f92672">=</span>Dataset(<span style="color:#e6db74">&#39;./DATA/CRCM5/CRCM5-v1_NAM-44_ll_CCCma-CanESM2_historical_tasmax_197101.nc&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>)
lats<span style="color:#f92672">=</span>nc_Modc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lat&#39;</span>][:]
lons<span style="color:#f92672">=</span>nc_Modc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lon&#39;</span>][:]
varc<span style="color:#f92672">=</span>nc_Modc<span style="color:#f92672">.</span>variables[variable][:]
</code></pre></div><ul>
<li>Rapide vue d&rsquo;ensemble de notre fichier:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nc_Modc<span style="color:#f92672">.</span>variables





    OrderedDict([(<span style="color:#e6db74">&#39;lon&#39;</span>, <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">netCDF4</span><span style="color:#f92672">.</span>_netCDF4<span style="color:#f92672">.</span>Variable<span style="color:#e6db74">&#39;&gt;</span>
                  float32 lon(y, x)
                      standard_name: longitude
                      long_name: Longitude
                      units: degrees_east
                      _CoordinateAxisType: Lon
                  unlimited dimensions: 
                  current shape <span style="color:#f92672">=</span> (<span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">155</span>)
                  filling on, default _FillValue of <span style="color:#ae81ff">9.969209968386869e+36</span> used),
                 (<span style="color:#e6db74">&#39;lat&#39;</span>, <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">netCDF4</span><span style="color:#f92672">.</span>_netCDF4<span style="color:#f92672">.</span>Variable<span style="color:#e6db74">&#39;&gt;</span>
                  float32 lat(y, x)
                      standard_name: latitude
                      long_name: Latitude
                      units: degrees_north
                      _CoordinateAxisType: Lat
                  unlimited dimensions: 
                  current shape <span style="color:#f92672">=</span> (<span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">155</span>)
                  filling on, default _FillValue of <span style="color:#ae81ff">9.969209968386869e+36</span> used),
                 (<span style="color:#e6db74">&#39;time&#39;</span>, <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">netCDF4</span><span style="color:#f92672">.</span>_netCDF4<span style="color:#f92672">.</span>Variable<span style="color:#e6db74">&#39;&gt;</span>
                  float64 time(time)
                      standard_name: time
                      long_name: time
                      bounds: time_bnds
                      units: days since <span style="color:#ae81ff">1949</span><span style="color:#f92672">-</span><span style="color:#ae81ff">12</span><span style="color:#f92672">-</span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">00</span>
                      calendar: proleptic_gregorian
                  unlimited dimensions: time
                  current shape <span style="color:#f92672">=</span> (<span style="color:#ae81ff">31</span>,)
                  filling on, default _FillValue of <span style="color:#ae81ff">9.969209968386869e+36</span> used),
                 (<span style="color:#e6db74">&#39;time_bnds&#39;</span>, <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">netCDF4</span><span style="color:#f92672">.</span>_netCDF4<span style="color:#f92672">.</span>Variable<span style="color:#e6db74">&#39;&gt;</span>
                  float64 time_bnds(time, nb2)
                  unlimited dimensions: time
                  current shape <span style="color:#f92672">=</span> (<span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">2</span>)
                  filling on, default _FillValue of <span style="color:#ae81ff">9.969209968386869e+36</span> used),
                 (<span style="color:#e6db74">&#39;tasmax&#39;</span>, <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">netCDF4</span><span style="color:#f92672">.</span>_netCDF4<span style="color:#f92672">.</span>Variable<span style="color:#e6db74">&#39;&gt;</span>
                  float32 tasmax(time, y, x)
                      standard_name: air_temperature
                      long_name: Daily Maximum Near<span style="color:#f92672">-</span>Surface Air Temperature
                      units: Celcius
                      coordinates: lon lat
                      _FillValue: <span style="color:#ae81ff">1e+20</span>
                      missing_value: <span style="color:#ae81ff">1e+20</span>
                      actual_range: [<span style="color:#ae81ff">206.04226685</span> <span style="color:#ae81ff">321.55471802</span>]
                      grid_desc: rotated_pole
                      cell_methods: time: maximum
                  unlimited dimensions: time
                  current shape <span style="color:#f92672">=</span> (<span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">155</span>)
                  filling on)])
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;-----------------------------------------&#39;</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Temperature dimension = &#39;</span>,varc<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Minimum of temperature = &#39;</span>, np<span style="color:#f92672">.</span>nanmin(varc))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Maximum of temperature = &#39;</span>, np<span style="color:#f92672">.</span>nanmax(varc))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;-----------------------------------------&#39;</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;-----------------------------------------&#39;</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Latitude dimension= &#39;</span>,lats<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Minimum of latitude = &#39;</span>, np<span style="color:#f92672">.</span>min(lats))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Maximum of latitude = &#39;</span>, np<span style="color:#f92672">.</span>max(lats))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;-----------------------------------------&#39;</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;-----------------------------------------&#39;</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Longitude dimesion = &#39;</span>,lons<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Minimum of longitude = &#39;</span>, np<span style="color:#f92672">.</span>min(lons))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Maximum of longitude = &#39;</span>, np<span style="color:#f92672">.</span>max(lons))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;-----------------------------------------&#39;</span>)


    <span style="color:#f92672">-----------------------------------------</span>
    Temperature dimension <span style="color:#f92672">=</span>  (<span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">155</span>)
    Minimum of temperature <span style="color:#f92672">=</span>  <span style="color:#f92672">-</span><span style="color:#ae81ff">57.66677</span>
    Maximum of temperature <span style="color:#f92672">=</span>  <span style="color:#ae81ff">30.657953</span>
    <span style="color:#f92672">-----------------------------------------</span>
    <span style="color:#f92672">-----------------------------------------</span>
    Latitude dimension<span style="color:#f92672">=</span>  (<span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">155</span>)
    Minimum of latitude <span style="color:#f92672">=</span>  <span style="color:#ae81ff">12.538727</span>
    Maximum of latitude <span style="color:#f92672">=</span>  <span style="color:#ae81ff">75.86</span>
    <span style="color:#f92672">-----------------------------------------</span>
    <span style="color:#f92672">-----------------------------------------</span>
    Longitude dimesion <span style="color:#f92672">=</span>  (<span style="color:#ae81ff">130</span>, <span style="color:#ae81ff">155</span>)
    Minimum of longitude <span style="color:#f92672">=</span>  <span style="color:#f92672">-</span><span style="color:#ae81ff">170.71053</span>
    Maximum of longitude <span style="color:#f92672">=</span>  <span style="color:#f92672">-</span><span style="color:#ae81ff">23.28948</span>
    <span style="color:#f92672">-----------------------------------------</span>
</code></pre></div><p>Nous allons appliquer la fonction Tmax90p() du module Indices_Temperature que nous avons importer.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">help(Indices_Temperature)
</code></pre></div><pre><code>Help on module Indices_Temperature:

NAME
    Indices_Temperature - Created on Mon Feb  5 13:56:30 2018

DESCRIPTION
    @author: guillaume

FUNCTIONS
    MOY(S)
    
    Tmax90p(S)
    
    Tmin10p(S)

FILE
    d:\utilisateurs\guillaume\documents\github\formation_python\15_netcdf\indices_temperature.py
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">varc<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>:]
</code></pre></div><pre><code>(130, 155)
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">###### boucle sur tous les points de grille et calcul de l&#39;indice</span>
<span style="color:#75715e">###### Nous allons stocker le résultat dans la matrice IND de tailler </span>

IND <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(varc<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>:],dtype<span style="color:#f92672">=</span>float)

<span style="color:#66d9ef">for</span> ni <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, varc<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>:][<span style="color:#ae81ff">0</span>]):
    <span style="color:#66d9ef">for</span> nj <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, varc<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>:][<span style="color:#ae81ff">1</span>]):
        IND[ni,nj]<span style="color:#f92672">=</span>Indices_Temperature<span style="color:#f92672">.</span>Tmax90p(varc[:,ni,nj])
        description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Monthly Mean of Tmax90p&#39;</span> 
        unite<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;°Celcius&#39;</span> 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">IND
<span style="color:#66d9ef">print</span>(IND<span style="color:#f92672">.</span>shape)
</code></pre></div><pre><code>(130, 155)
</code></pre>
<p>Nous pouvons faire maintenant le même exercice mais sur l&rsquo;ensemble des années de 1971 à 2000 pour le mois de Janvier.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Mois<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;01&#39;</span>
indice <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Tmax90p&#39;</span>
path_model<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;CRCM5-v1_CCCma-CanESM2_historical&#39;</span>
variable<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tasmax&#39;</span>
rep_data<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./DATA/CRCM5/&#39;</span>
model<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;CRCM5-v1_NAM-44_ll_CCCma-CanESM2&#39;</span>
yi <span style="color:#f92672">=</span> <span style="color:#ae81ff">1971</span>
yf <span style="color:#f92672">=</span> <span style="color:#ae81ff">2000</span>
tot<span style="color:#f92672">=</span>(yf<span style="color:#f92672">-</span>yi)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> 
</code></pre></div><p>Notre matrice finale IND aura ainsi 3 dimensions: (time, lat, lon) telle que:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">IND <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros((tot,varc<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>:][<span style="color:#ae81ff">0</span>],varc<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>:][<span style="color:#ae81ff">1</span>]),dtype<span style="color:#f92672">=</span>float)
IND<span style="color:#f92672">.</span>shape
</code></pre></div><pre><code>(30, 130, 155)
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nt<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> year <span style="color:#f92672">in</span> range(yi,yf<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
    <span style="color:#75715e">###### ouverture et lecture des fichiers Netcdf</span>
    hist<span style="color:#f92672">=</span>model<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;_historical_&#39;</span><span style="color:#f92672">+</span>variable<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">+</span>str(year)<span style="color:#f92672">+</span>Mois<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;.nc&#39;</span>     
    modelc<span style="color:#f92672">=</span>rep_data<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;/&#39;</span><span style="color:#f92672">+</span>hist
    nc_Modc<span style="color:#f92672">=</span>Dataset(modelc,<span style="color:#e6db74">&#39;r&#39;</span>)
    lats<span style="color:#f92672">=</span>nc_Modc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lat&#39;</span>][:]
    lons<span style="color:#f92672">=</span>nc_Modc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lon&#39;</span>][:]
    varc<span style="color:#f92672">=</span>nc_Modc<span style="color:#f92672">.</span>variables[variable][:]
    
    <span style="color:#75715e">###### boucle sur tous les points de grille et calcul de l&#39;indice</span>
    <span style="color:#66d9ef">for</span> ni <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, varc<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>:][<span style="color:#ae81ff">0</span>]):
        <span style="color:#66d9ef">for</span> nj <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, varc<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>:][<span style="color:#ae81ff">1</span>]):
            IND[nt,ni,nj]<span style="color:#f92672">=</span>Indices_Temperature<span style="color:#f92672">.</span>Tmax90p(varc[:,ni,nj])
            description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Monthly Mean of Tmax90p&#39;</span> 
            unite<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;°Celcius&#39;</span>      
            
    nt<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span> <span style="color:#75715e"># incrément sur les années</span>
    
    <span style="color:#75715e">###### Écriture du fichier Netcdf en sortie</span>
C <span style="color:#f92672">=</span> Dataset(rep_out<span style="color:#f92672">+</span>model<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;_historical_&#39;</span><span style="color:#f92672">+</span>indice<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">+</span>str(yi)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">+</span>str(yf)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">+</span>Mois<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;.nc&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>)
C<span style="color:#f92672">.</span>description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Indice temperature&#39;</span>
C<span style="color:#f92672">.</span>conventions <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CF-1.0&#39;</span>  
C<span style="color:#f92672">.</span>model_id <span style="color:#f92672">=</span> model
C<span style="color:#f92672">.</span>grid<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;latlon&#39;</span>
C<span style="color:#f92672">.</span>CDO <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Climate Data Operators version 1.6.2 (http://code.zmaw.de/projects/cdo)&#39;</span>
C<span style="color:#f92672">.</span>institution <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UQAM - ESCER Center, University of Quebec in Montreal&#39;</span>
C<span style="color:#f92672">.</span>contact <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Guillaume Dueymes&#39;</span>
<span style="color:#75715e">########################################</span>
<span style="color:#75715e"># Dimensions</span>
C<span style="color:#f92672">.</span>createDimension(<span style="color:#e6db74">&#39;x&#39;</span>, len(varc[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]))
C<span style="color:#f92672">.</span>createDimension(<span style="color:#e6db74">&#39;y&#39;</span>, len(varc[<span style="color:#ae81ff">0</span>]))
C<span style="color:#f92672">.</span>createDimension(<span style="color:#e6db74">&#39;time&#39;</span>, tot)

var<span style="color:#f92672">=</span>C<span style="color:#f92672">.</span>createVariable(str(indice), np<span style="color:#f92672">.</span>float32, (<span style="color:#e6db74">&#39;time&#39;</span>,<span style="color:#e6db74">&#39;y&#39;</span>,<span style="color:#e6db74">&#39;x&#39;</span>)) 
var<span style="color:#f92672">.</span>long_name <span style="color:#f92672">=</span> str(description)
var<span style="color:#f92672">.</span>unit <span style="color:#f92672">=</span> str(unite)
lat<span style="color:#f92672">=</span>C<span style="color:#f92672">.</span>createVariable(<span style="color:#e6db74">&#39;lat&#39;</span>, np<span style="color:#f92672">.</span>float32, (<span style="color:#e6db74">&#39;y&#39;</span>,<span style="color:#e6db74">&#39;x&#39;</span>))
lon<span style="color:#f92672">=</span>C<span style="color:#f92672">.</span>createVariable(<span style="color:#e6db74">&#39;lon&#39;</span>, np<span style="color:#f92672">.</span>float32, (<span style="color:#e6db74">&#39;y&#39;</span>,<span style="color:#e6db74">&#39;x&#39;</span>)) 

time <span style="color:#f92672">=</span> C<span style="color:#f92672">.</span>createVariable(<span style="color:#e6db74">&#39;time&#39;</span>, np<span style="color:#f92672">.</span>float64, (<span style="color:#e6db74">&#39;time&#39;</span>,))
time<span style="color:#f92672">.</span>long_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;time&#39;</span>

<span style="color:#66d9ef">for</span> var <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;lon&#39;</span>,<span style="color:#e6db74">&#39;lat&#39;</span>,<span style="color:#e6db74">&#39;time&#39;</span>]:
    <span style="color:#66d9ef">for</span> att <span style="color:#f92672">in</span> nc_Modc<span style="color:#f92672">.</span>variables[var]<span style="color:#f92672">.</span>ncattrs():
        setattr(C<span style="color:#f92672">.</span>variables[var],att,getattr(nc_Modc<span style="color:#f92672">.</span>variables[var],att))

time[:]<span style="color:#f92672">=</span>range(<span style="color:#ae81ff">1</span>,nt<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
lat[:,:] <span style="color:#f92672">=</span> lats
lon[:,:] <span style="color:#f92672">=</span> lons
C<span style="color:#f92672">.</span>variables[str(indice)][:,:,:] <span style="color:#f92672">=</span> IND[::]
C<span style="color:#f92672">.</span>close()
    
</code></pre></div><h2 id="154--extraire-un-point-de-grille">15.4- Extraire un point de grille:</h2>
<p><img src="/img/formation/positions_points_de_grille.png" alt="image0"></p>
<p>Dans cet exemple, nous travaillerons avec les données de température quotidienne maximale de la réanalyse régionale (NARR). Pour plus d&rsquo;informations sur ce produit:</p>
<p><a href="http://www.emc.ncep.noaa.gov/mmb/rreanl">www.emc.ncep.noaa.gov/mmb/rreanl</a></p>
<p>Les fichiers Netcdf que nous ouvrirons sont des valeurs quotidiennes du 1er janvier 2017 au 31 décembre 2017. Les fichiers sont archivés par mois.</p>
<p>Le point de grille NARR le plus proche de la station météorologique ECCC Montréal / McTavish (45,5 N, -73,8 W) sera extrait ici.</p>
<p>Importons d&rsquo;abord les bibliothèques nécessaires.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> netCDF4
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> datetime
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> date, timedelta
<span style="color:#f92672">from</span> dateutil.relativedelta <span style="color:#f92672">import</span> relativedelta
</code></pre></div><p>On définit nos paramètres d&rsquo;entrée.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">rep1<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./DATA/NARR/&#39;</span>
model<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;NARR&#39;</span>
variable<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tasmax&#39;</span>
variable_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Temperature maximale&#39;</span>
yeari<span style="color:#f92672">=</span><span style="color:#ae81ff">2017</span>
monthi<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
yearf <span style="color:#f92672">=</span> <span style="color:#ae81ff">2017</span>
monthf <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
station<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Montreal&#39;</span> 
lati <span style="color:#f92672">=</span> <span style="color:#ae81ff">45.5</span>
loni <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">73.8</span>
</code></pre></div><p>Nous allons travailler sur une série temporelle quotidienne entre le 1er janvier 2017 et le 31 décembre 2017. On peut définir les dimensions de notre résultat:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">day_start<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
day_end <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>date_range(<span style="color:#e6db74">&#39;{}-{}&#39;</span><span style="color:#f92672">.</span>format(yearf, monthf), periods<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;M&#39;</span>)<span style="color:#f92672">.</span>day<span style="color:#f92672">.</span>tolist()[<span style="color:#ae81ff">0</span>]
start<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>datetime(yeari,monthi,day_start)
end<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>datetime(yearf,monthf,day_end)
d0 <span style="color:#f92672">=</span> date(yeari, monthi, day_start)
d1 <span style="color:#f92672">=</span> date(yearf, monthf, day_end)
delta <span style="color:#f92672">=</span> d1 <span style="color:#f92672">-</span> d0
nb_days <span style="color:#f92672">=</span> delta<span style="color:#f92672">.</span>days<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
var_data<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>zeros(nb_days)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">var_data<span style="color:#f92672">.</span>shape
</code></pre></div><pre><code>(365,)
</code></pre>
<p>Nous définissons une fonction qui calculera la distance entre chaque point de grille du fichier Netcdf et notre latitude / longitude de référence. On déduit alors la distance minimale.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getclosest_ij</span>(lats,lons,latpt,lonpt):
     <span style="color:#75715e"># find squared distance of every point on grid</span>
     dist_sq <span style="color:#f92672">=</span> (lats<span style="color:#f92672">-</span>latpt)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> (lons<span style="color:#f92672">-</span>lonpt)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> 
     <span style="color:#75715e"># 1D index of minimum dist_sq element</span>
     minindex_flattened <span style="color:#f92672">=</span> dist_sq<span style="color:#f92672">.</span>argmin()
     <span style="color:#75715e"># Get 2D index for latvals and lonvals arrays from 1D index</span>
     <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>unravel_index(minindex_flattened, lats<span style="color:#f92672">.</span>shape)
</code></pre></div><p>La fonction suivante nous permet d&rsquo;incrémenter nos mois lors de la lecture des fichiers Netcdf.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_month</span>(now):
    <span style="color:#66d9ef">try</span>:
        then <span style="color:#f92672">=</span> (now <span style="color:#f92672">+</span> relativedelta(months<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))<span style="color:#f92672">.</span>replace(day<span style="color:#f92672">=</span>now<span style="color:#f92672">.</span>day)
    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span>:
        then <span style="color:#f92672">=</span> (now <span style="color:#f92672">+</span> relativedelta(months<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>))<span style="color:#f92672">.</span>replace(day<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
    <span style="color:#66d9ef">return</span> then
</code></pre></div><p>Nous pouvons  appliquer notre fonction sur chaque point de la grille, mois par mois et enregistrer la valeur du point de grille sélectionner dans un DataFrame.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
<span style="color:#75715e"># Début de notre boucle temporelle</span>
incr<span style="color:#f92672">=</span>start
IND<span style="color:#f92672">=</span>[]
<span style="color:#66d9ef">while</span> incr <span style="color:#f92672">&lt;=</span> end:
    filename<span style="color:#f92672">=</span> rep1 <span style="color:#f92672">+</span> model <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> variable <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> str(incr<span style="color:#f92672">.</span>year) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;{:02d}&#39;</span><span style="color:#f92672">.</span>format(incr<span style="color:#f92672">.</span>month) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.nc&#39;</span>   
    f <span style="color:#f92672">=</span> netCDF4<span style="color:#f92672">.</span>Dataset(filename)
    var <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>variables[variable] 
    lat, lon <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lat&#39;</span>], f<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lon&#39;</span>]
    <span style="color:#75715e"># extract lat/lon values (in degrees) to numpy arrays</span>
    latvals <span style="color:#f92672">=</span> lat[:]; lonvals <span style="color:#f92672">=</span> lon[:] 
    <span style="color:#75715e"># a function to find the index of the point closest pt</span>
    <span style="color:#75715e"># (in squared distance) to give lat/lon value.    </span>
    iy_min, ix_min <span style="color:#f92672">=</span> getclosest_ij(latvals, lonvals, lati, loni)
    IND<span style="color:#f92672">.</span>append(var[:,iy_min,ix_min])
    incr<span style="color:#f92672">=</span>add_month(incr)
    
flattened_list <span style="color:#f92672">=</span> [y <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> IND <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> x]
start<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>datetime(yeari,monthi,day_start)
TIME<span style="color:#f92672">=</span>[]
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,nb_days,<span style="color:#ae81ff">1</span>): 
    TIME<span style="color:#f92672">.</span>append((start<span style="color:#f92672">+</span>timedelta(days<span style="color:#f92672">=</span>i)))
    
dataFrame_NARR <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;Date&#39;</span>: TIME, variable_name: flattened_list}, columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;Date&#39;</span>,variable_name]) 
dataFrame_NARR <span style="color:#f92672">=</span> dataFrame_NARR<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;Date&#39;</span>)   
dataFrame_NARR<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Nous pouvons sauvegarder notre résultat au format csv.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataFrame_NARR<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#39;./DATA/NARR/NARR_&#39;</span><span style="color:#f92672">+</span>station<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;_1pt_&#39;</span><span style="color:#f92672">+</span>str(variable)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;{:02d}&#39;</span><span style="color:#f92672">.</span>format(monthi) <span style="color:#f92672">+</span> str(yeari)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;{:02d}&#39;</span><span style="color:#f92672">.</span>format(monthf) <span style="color:#f92672">+</span> str(yearf)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;.csv&#39;</span>)    
</code></pre></div><ul>
<li>Observation vs NARR</li>
</ul>
<p>Maintenant que nous avons extrait notre grille près de Montréal, nous pouvons comparer ces valeurs avec des observations.</p>
<p>Nous allons extraire les données de la station de Montréal McTavish et les inclure dans le DataFrame précédent. On pourra ainsi aisément comparer nos séries.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataframe_station <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;./DATA/station/MONTREAL_TAVISH_tasmax_1948_2017.csv&#39;</span>, header<span style="color:#f92672">=</span>None, names<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Maximum temperature: OBS&#39;</span>])
start <span style="color:#f92672">=</span> date(<span style="color:#ae81ff">1948</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
end <span style="color:#f92672">=</span> date(<span style="color:#ae81ff">2017</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">31</span>)
delta<span style="color:#f92672">=</span>(end<span style="color:#f92672">-</span>start) 
nb_days <span style="color:#f92672">=</span> delta<span style="color:#f92672">.</span>days <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> 
rng <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>date_range(start, periods<span style="color:#f92672">=</span>nb_days, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D&#39;</span>)

dataframe_station[<span style="color:#e6db74">&#39;datetime&#39;</span>] <span style="color:#f92672">=</span> rng
dataframe_station<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> dataframe_station[<span style="color:#e6db74">&#39;datetime&#39;</span>] 
dataframe_station <span style="color:#f92672">=</span> dataframe_station<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#34;datetime&#34;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataframe_station<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dataFrame_NARR <span style="color:#f92672">=</span> dataFrame_NARR<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;Temperature maximale&#34;</span>: <span style="color:#e6db74">&#34;Maximum temperature: NARR&#34;</span>})
df_NARR_Station <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([dataframe_station,dataFrame_NARR],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_NARR_Station<span style="color:#f92672">.</span>tail()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Traçons les années 2016 et 2017 en appliquant la librairie Matplotlib sur le DataFrame .</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
df<span style="color:#f92672">=</span>df_NARR_Station<span style="color:#f92672">.</span>loc[<span style="color:#e6db74">&#39;2016&#39;</span> : <span style="color:#e6db74">&#39;2017&#39;</span>]
color <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;black&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>]
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">8</span>))
plt<span style="color:#f92672">.</span>plot(df<span style="color:#f92672">.</span>index, df[<span style="color:#e6db74">&#39;Maximum temperature: NARR&#39;</span>][:],  label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;NARR Temperature&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, c<span style="color:#f92672">=</span>color[<span style="color:#ae81ff">0</span>])
plt<span style="color:#f92672">.</span>plot(df<span style="color:#f92672">.</span>index, df[<span style="color:#e6db74">&#39;Maximum temperature: OBS&#39;</span>][:],  label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Observation Temperature&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, c<span style="color:#f92672">=</span>color[<span style="color:#ae81ff">1</span>])

<span style="color:#75715e"># Autre méthode pour tracer avec Pandas</span>
<span style="color:#75715e">#df_NARR_Station[&#39;2017&#39;].plot(figsize=(10,5))</span>

plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Time&#34;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Temperature&#34;</span>, {<span style="color:#e6db74">&#39;color&#39;</span>: <span style="color:#e6db74">&#39;black&#39;</span>, <span style="color:#e6db74">&#39;fontsize&#39;</span>: <span style="color:#ae81ff">10</span>})
plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Time serie: Station MTL vs NARR&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#ae81ff">1.05</span>)
plt<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;upper left&#39;</span>, ncol<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, bbox_to_anchor<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>),fontsize <span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#34;figures/NARR_time_Serie_temperature.png&#34;</span>, dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>, bbox_inches<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tight&#39;</span>)   <span style="color:#75715e"># bbox_inches= : option qui permet de propostionner le graphique lors de l&#39;enregistrement</span>
plt<span style="color:#f92672">.</span>show()

</code></pre></div><p><img src="/img/formation/netcdf1/output_59_0.png" alt="png"></p>
<ul>
<li>appliquons la fonction <!-- raw HTML omitted --> .rolling () <!-- raw HTML omitted --> pour calculer une moyenne mobile sur notre signal</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
df_NARR_Station[<span style="color:#e6db74">&#39;rollingmean5 Station&#39;</span>]<span style="color:#f92672">=</span>  df_NARR_Station[<span style="color:#e6db74">&#39;Maximum temperature: OBS&#39;</span>]<span style="color:#f92672">.</span>rolling(window<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)<span style="color:#f92672">.</span>mean()
df_NARR_Station[<span style="color:#e6db74">&#39;rollingmean5 NARR&#39;</span>]<span style="color:#f92672">=</span>  df_NARR_Station[<span style="color:#e6db74">&#39;Maximum temperature: NARR&#39;</span>]<span style="color:#f92672">.</span>rolling(window<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)<span style="color:#f92672">.</span>mean()
df_NARR_Station<span style="color:#f92672">.</span>tail()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_NARR_Station[<span style="color:#e6db74">&#39;2017-01&#39;</span>:<span style="color:#e6db74">&#39;2017-12&#39;</span>]<span style="color:#f92672">.</span>plot(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">8</span>))
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#34;Temps&#34;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#34;Température&#34;</span>)
plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Maximum temperature time serie: Station MTL vs NARR&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#ae81ff">1.05</span>)
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#34;figures/NARR_time_Serie_temperature2.png&#34;</span>, dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>, bbox_inches<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tight&#39;</span>)   <span style="color:#75715e"># bbox_inches= : option qui permet de propostionner le graphique lors de l&#39;enregistrement</span>
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/img/formation/netcdf1/output_63_0.png" alt="png"></p>
<h2 id="155--extraire-un-domaine-délimité-par-une-boite-2d">15.5- Extraire un domaine délimité par une boite 2D:</h2>
<p><img src="/img/formation/CORDEX_domaine.png" alt="png"></p>
<p>Au lieu d&rsquo;extraire un point de grille, on peut vouloir extraire un domaine / box délimité par des latitudes et des longitudes.</p>
<p>Dans cet exemple, nous travaillerons avec la moyenne annuelle des données de températures maximales quotidiennes de plusieurs modèles régionaux de CORDEX-NAM44.</p>
<p>Nous allons extraire tous les points de grille de la région entre</p>
<pre><code>- 47degN et 51degN de latitude 
- -72degW et -64degW de longitude.
</code></pre>
<p>Nous tracerons ensuite la variabilité interannuelle des anomalies moyennes annuelles de température.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#f92672">import</span> netCDF4
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
<span style="color:#f92672">import</span> matplotlib.pylab <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> warnings; warnings<span style="color:#f92672">.</span>filterwarnings(action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ignore&#39;</span>)
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">from</span> matplotlib <span style="color:#f92672">import</span> gridspec
<span style="color:#f92672">import</span> matplotlib <span style="color:#f92672">as</span> mpl

rep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./DATA/Inter_annual_anomaly/&#39;</span>

<span style="color:#75715e"># Region à extraire </span>
latbounds <span style="color:#f92672">=</span> [ <span style="color:#ae81ff">47</span> , <span style="color:#ae81ff">51</span> ]
lonbounds <span style="color:#f92672">=</span> [ <span style="color:#f92672">-</span><span style="color:#ae81ff">72</span> , <span style="color:#f92672">-</span><span style="color:#ae81ff">64</span> ] 

<span style="color:#75715e"># Lecture du fichier Netcdf</span>
filename<span style="color:#f92672">=</span> rep <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;anomalie_CRCM5-v1_NAM-44_ll_CCCma-CanESM2_rcp45_Mean_tasmax_2011-2040_1971-2000.nc&#39;</span>   
nc <span style="color:#f92672">=</span> netCDF4<span style="color:#f92672">.</span>Dataset(filename)

<span style="color:#75715e"># Lecture des variables</span>
var <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;Mean_tasmax&#39;</span>][:]  
lats <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lat&#39;</span>][:]; lons <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lon&#39;</span>][:]

<span style="color:#75715e"># Extraction du sous-domaine </span>
subset <span style="color:#f92672">=</span> ((lats <span style="color:#f92672">&gt;</span> latbounds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&amp;</span> (lats <span style="color:#f92672">&lt;</span> latbounds[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">&amp;</span> 
        (lons <span style="color:#f92672">&gt;</span> lonbounds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&amp;</span> (lons <span style="color:#f92672">&lt;</span> lonbounds[<span style="color:#ae81ff">1</span>]))

data<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(var[:,subset], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;float&#39;</span>) 
        
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">data<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>On va effectuer le même exercice mais en bouclant sur deux simulations RCP45 et deux périodes de temps. 
Pour chaque année et chaque simulation, nous allons calculer la moyenne spatiale sur l&rsquo;ensemble du domaine .</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># path and variable name</span>
rep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./DATA/Inter_annual_anomaly/&#39;</span>
variable_in <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Mean_tasmax&#39;</span>

<span style="color:#75715e"># list of periods we want to use</span>
list_period <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;2011-2040&#39;</span>,<span style="color:#e6db74">&#39;2041-2070&#39;</span>,<span style="color:#e6db74">&#39;2071-2100&#39;</span>]

<span style="color:#75715e"># list of models</span>
list_rcp45 <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;CRCM5-v1_NAM-44_ll_CCCma-CanESM2_rcp45&#39;</span>, <span style="color:#e6db74">&#39;CRCM5-v1_NAM-44_ll_MPI-M-MPI-ESM-LR_rcp45&#39;</span> ]

<span style="color:#75715e"># Area to extract</span>
latbounds <span style="color:#f92672">=</span> [ <span style="color:#ae81ff">47</span> , <span style="color:#ae81ff">51</span> ]
lonbounds <span style="color:#f92672">=</span> [ <span style="color:#f92672">-</span><span style="color:#ae81ff">72</span> , <span style="color:#f92672">-</span><span style="color:#ae81ff">64</span> ] 

<span style="color:#75715e"># </span>
df_rcp45 <span style="color:#f92672">=</span> []
matrix_45 <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> period <span style="color:#f92672">in</span> list_period: 
    globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period] <span style="color:#f92672">=</span> []  <span style="color:#75715e"># we define a global variable </span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,len(list_rcp45)):
        filename<span style="color:#f92672">=</span> rep <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;anomalie_&#39;</span> <span style="color:#f92672">+</span>  list_rcp45[i] <span style="color:#f92672">+</span>  <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> variable_in <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> period  <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_1971-2000.nc&#39;</span>   
        nc <span style="color:#f92672">=</span> netCDF4<span style="color:#f92672">.</span>Dataset(filename)
        <span style="color:#75715e"># we here read netcdf values</span>
        var <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[variable_in][:]  
        lats <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lat&#39;</span>][:]; lons <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lon&#39;</span>][:]
        <span style="color:#75715e"># in this part, we extract our domain </span>
        subset <span style="color:#f92672">=</span> ((lats <span style="color:#f92672">&gt;</span> latbounds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&amp;</span> (lats <span style="color:#f92672">&lt;</span> latbounds[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">&amp;</span> 
             (lons <span style="color:#f92672">&gt;</span> lonbounds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&amp;</span> (lons <span style="color:#f92672">&lt;</span> lonbounds[<span style="color:#ae81ff">1</span>]))
        data<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(var[:,subset], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;float&#39;</span>) 
        globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period]<span style="color:#f92672">.</span>append(data<span style="color:#f92672">.</span>mean(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))
        
    df_rcp45<span style="color:#f92672">.</span>append(pd<span style="color:#f92672">.</span>DataFrame(globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period])<span style="color:#f92672">.</span>T) 
    
df_rcp45 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat(df_rcp45)
df_rcp45<span style="color:#f92672">.</span>head()

</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>On peut ajouter un index de type datetime:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">TIME<span style="color:#f92672">=</span>[]
<span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(int(list_period[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;-&#39;</span>)[<span style="color:#ae81ff">0</span>]),int(list_period[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;-&#39;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>):
    TIME<span style="color:#f92672">.</span>append(datetime<span style="color:#f92672">.</span>strptime(str(y), <span style="color:#e6db74">&#39;%Y&#39;</span>))
    
df_rcp45[<span style="color:#e6db74">&#39;Date&#39;</span>] <span style="color:#f92672">=</span> TIME   
df_rcp45<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> df_rcp45[<span style="color:#e6db74">&#39;Date&#39;</span>]
df_rcp45 <span style="color:#f92672">=</span> df_rcp45<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#34;Date&#34;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) 
df_rcp45<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>Nous voulons ensuite, pour chaque année, la variabilité inter-modèle. Pour cela, nous calculerons les valeurs minimum et maximum en appliquant la méthode .apply.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_rcp45[<span style="color:#e6db74">&#39;min&#39;</span>] <span style="color:#f92672">=</span> df_rcp45<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>min, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_rcp45[<span style="color:#e6db74">&#39;max&#39;</span>] <span style="color:#f92672">=</span> df_rcp45<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>max, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_rcp45[<span style="color:#e6db74">&#39;mean&#39;</span>] <span style="color:#f92672">=</span> df_rcp45<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>mean, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_rcp45<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>On peut faire maintenant le même travail sur les simulations RCP8 et les simulations historiques:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list_rcp85 <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;CRCM5-v1_NAM-44_ll_CCCma-CanESM2_rcp85&#39;</span>,<span style="color:#e6db74">&#39;CRCM5-v1_NAM-44_ll_MPI-M-MPI-ESM-MR_rcp85&#39;</span>]
df_rcp85 <span style="color:#f92672">=</span> []
matrix_85 <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> period <span style="color:#f92672">in</span> list_period: 
    globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period] <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,len(list_rcp85)):
        filename<span style="color:#f92672">=</span> rep <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;anomalie_&#39;</span> <span style="color:#f92672">+</span>  list_rcp85[i] <span style="color:#f92672">+</span>  <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> variable_in <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> period  <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_1971-2000.nc&#39;</span>   
        nc <span style="color:#f92672">=</span> netCDF4<span style="color:#f92672">.</span>Dataset(filename)
        var <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[variable_in][:]  
        lats <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lat&#39;</span>][:]; lons <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lon&#39;</span>][:]            
        subset <span style="color:#f92672">=</span> ((lats <span style="color:#f92672">&gt;</span> latbounds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&amp;</span> (lats <span style="color:#f92672">&lt;</span> latbounds[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">&amp;</span> 
             (lons <span style="color:#f92672">&gt;</span> lonbounds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&amp;</span> (lons <span style="color:#f92672">&lt;</span> lonbounds[<span style="color:#ae81ff">1</span>]))
        <span style="color:#75715e">#mask = np.where(subset)</span>
        data<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(var[:,subset], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;float&#39;</span>) 
        globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period]<span style="color:#f92672">.</span>append(data<span style="color:#f92672">.</span>mean(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))        
    df_rcp85<span style="color:#f92672">.</span>append(pd<span style="color:#f92672">.</span>DataFrame(globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period])<span style="color:#f92672">.</span>T) 
    
df_rcp85 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat(df_rcp85)
df_rcp85[<span style="color:#e6db74">&#39;Date&#39;</span>] <span style="color:#f92672">=</span> TIME   
df_rcp85<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> df_rcp85[<span style="color:#e6db74">&#39;Date&#39;</span>]
df_rcp85 <span style="color:#f92672">=</span> df_rcp85<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#34;Date&#34;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)  

df_rcp85[<span style="color:#e6db74">&#39;min&#39;</span>] <span style="color:#f92672">=</span> df_rcp85<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>min, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_rcp85[<span style="color:#e6db74">&#39;max&#39;</span>] <span style="color:#f92672">=</span> df_rcp85<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>max, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_rcp85[<span style="color:#e6db74">&#39;mean&#39;</span>] <span style="color:#f92672">=</span> df_rcp85<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>mean, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

<span style="color:#75715e">### historical RCMs</span>
list_histo <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;CRCM5-v1_NAM-44_ll_CCCma-CanESM2_historical&#39;</span>, <span style="color:#e6db74">&#39;CRCM5-v1_NAM-44_ll_MPI-M-MPI-ESM-LR_historical&#39;</span>]
df_histo <span style="color:#f92672">=</span> []
globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period] <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,len(list_histo)):
    filename<span style="color:#f92672">=</span> rep <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;anomalie_&#39;</span> <span style="color:#f92672">+</span>  list_histo[i] <span style="color:#f92672">+</span>  <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> variable_in <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_1971-2000_1971-2000.nc&#39;</span>   
    nc <span style="color:#f92672">=</span> netCDF4<span style="color:#f92672">.</span>Dataset(filename)
    var <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[variable_in][:]  
    lats <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lat&#39;</span>][:]; lons <span style="color:#f92672">=</span> nc<span style="color:#f92672">.</span>variables[<span style="color:#e6db74">&#39;lon&#39;</span>][:]
    
    subset <span style="color:#f92672">=</span> ((lats <span style="color:#f92672">&gt;</span> latbounds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&amp;</span> (lats <span style="color:#f92672">&lt;</span> latbounds[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">&amp;</span> 
         (lons <span style="color:#f92672">&gt;</span> lonbounds[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">&amp;</span> (lons <span style="color:#f92672">&lt;</span> lonbounds[<span style="color:#ae81ff">1</span>]))
    <span style="color:#75715e">#mask = np.where(subset)</span>
    data<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(var[:,subset], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;float&#39;</span>) 
    globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period]<span style="color:#f92672">.</span>append(data<span style="color:#f92672">.</span>mean(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>))        
df_histo<span style="color:#f92672">.</span>append(pd<span style="color:#f92672">.</span>DataFrame(globals()[<span style="color:#e6db74">&#39;flattened_list_&#39;</span><span style="color:#f92672">+</span>period])<span style="color:#f92672">.</span>T) 
TIME<span style="color:#f92672">=</span>[]
<span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1971</span>,<span style="color:#ae81ff">2001</span>,<span style="color:#ae81ff">1</span>):
    TIME<span style="color:#f92672">.</span>append(datetime<span style="color:#f92672">.</span>strptime(str(y), <span style="color:#e6db74">&#39;%Y&#39;</span>))  
    
df_histo <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat(df_histo)
df_histo[<span style="color:#e6db74">&#39;Date&#39;</span>] <span style="color:#f92672">=</span> TIME   
df_histo<span style="color:#f92672">.</span>index <span style="color:#f92672">=</span> df_histo[<span style="color:#e6db74">&#39;Date&#39;</span>]
df_histo <span style="color:#f92672">=</span> df_histo<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#34;Date&#34;</span>], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)  

df_histo[<span style="color:#e6db74">&#39;min&#39;</span>] <span style="color:#f92672">=</span> df_histo<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>min, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_histo[<span style="color:#e6db74">&#39;max&#39;</span>] <span style="color:#f92672">=</span> df_histo<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>max, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
df_histo[<span style="color:#e6db74">&#39;mean&#39;</span>] <span style="color:#f92672">=</span> df_histo<span style="color:#f92672">.</span>apply(np<span style="color:#f92672">.</span>mean, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</code></pre></div><p>On combine le tout dans un seul et même DataFrame:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">result <span style="color:#f92672">=</span> []
result <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;min_rcp45&#39;</span>: df_rcp45[<span style="color:#e6db74">&#39;min&#39;</span>], <span style="color:#e6db74">&#39;max_rcp45&#39;</span>: df_rcp45[<span style="color:#e6db74">&#39;max&#39;</span>],<span style="color:#e6db74">&#39;mean_rcp45&#39;</span>: df_rcp45[<span style="color:#e6db74">&#39;mean&#39;</span>],
                       <span style="color:#e6db74">&#39;min_rcp85&#39;</span>: df_rcp85[<span style="color:#e6db74">&#39;min&#39;</span>], <span style="color:#e6db74">&#39;max_rcp85&#39;</span>: df_rcp85[<span style="color:#e6db74">&#39;max&#39;</span>],<span style="color:#e6db74">&#39;mean_rcp85&#39;</span>: df_rcp85[<span style="color:#e6db74">&#39;mean&#39;</span>],
                       <span style="color:#e6db74">&#39;min_histo&#39;</span>: df_histo[<span style="color:#e6db74">&#39;min&#39;</span>], <span style="color:#e6db74">&#39;max_histo&#39;</span>: df_histo[<span style="color:#e6db74">&#39;max&#39;</span>],<span style="color:#e6db74">&#39;mean_histo&#39;</span>: df_histo[<span style="color:#e6db74">&#39;mean&#39;</span>]},
        columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;min_rcp45&#39;</span>,<span style="color:#e6db74">&#39;max_rcp45&#39;</span>,<span style="color:#e6db74">&#39;mean_rcp45&#39;</span>,<span style="color:#e6db74">&#39;min_rcp85&#39;</span>,<span style="color:#e6db74">&#39;max_rcp85&#39;</span>,<span style="color:#e6db74">&#39;mean_rcp85&#39;</span>,<span style="color:#e6db74">&#39;min_histo&#39;</span>,<span style="color:#e6db74">&#39;max_histo&#39;</span>,<span style="color:#e6db74">&#39;mean_histo&#39;</span>]) 

result<span style="color:#f92672">.</span>tail()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<p>On peut maintenant visualiser notre variabilité inter-annuelle.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">color <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;black&#39;</span>,<span style="color:#e6db74">&#39;blue&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>]
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">10</span>)) 
gs <span style="color:#f92672">=</span> gridspec<span style="color:#f92672">.</span>GridSpec(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, width_ratios<span style="color:#f92672">=</span>[<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">1</span>]) 
gs<span style="color:#f92672">.</span>update( wspace<span style="color:#f92672">=</span><span style="color:#ae81ff">0.04</span>)
ax1 <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplot(gs[<span style="color:#ae81ff">0</span>])

plt<span style="color:#f92672">.</span>rcParams[<span style="color:#e6db74">&#34;figure.figsize&#34;</span>]<span style="color:#f92672">=</span>[<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">9</span>]       <span style="color:#75715e">#  </span>
plt<span style="color:#f92672">.</span>plot(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year, result[<span style="color:#e6db74">&#39;mean_histo&#39;</span>][:],  label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RCMs historical&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, c<span style="color:#f92672">=</span>color[<span style="color:#ae81ff">0</span>])
plt<span style="color:#f92672">.</span>plot(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year, result[<span style="color:#e6db74">&#39;mean_rcp45&#39;</span>][:],  label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RCMs scenario rcp 4.5&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, c<span style="color:#f92672">=</span>color[<span style="color:#ae81ff">1</span>])
plt<span style="color:#f92672">.</span>plot(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year, result[<span style="color:#e6db74">&#39;mean_rcp85&#39;</span>][:],  label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RCMs scenario rcp 8.5&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, c<span style="color:#f92672">=</span>color[<span style="color:#ae81ff">2</span>])

plt<span style="color:#f92672">.</span>fill_between(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year,result[<span style="color:#e6db74">&#39;min_histo&#39;</span>],result[<span style="color:#e6db74">&#39;max_histo&#39;</span>], color <span style="color:#f92672">=</span> color[<span style="color:#ae81ff">0</span>], alpha<span style="color:#f92672">=.</span><span style="color:#ae81ff">2</span>)
plt<span style="color:#f92672">.</span>fill_between(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year,result[<span style="color:#e6db74">&#39;min_rcp45&#39;</span>],result[<span style="color:#e6db74">&#39;max_rcp45&#39;</span>], color <span style="color:#f92672">=</span>  color[<span style="color:#ae81ff">1</span>], alpha<span style="color:#f92672">=.</span><span style="color:#ae81ff">2</span>)
plt<span style="color:#f92672">.</span>fill_between(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year,result[<span style="color:#e6db74">&#39;min_rcp85&#39;</span>],result[<span style="color:#e6db74">&#39;max_rcp85&#39;</span>], color <span style="color:#f92672">=</span>  color[<span style="color:#ae81ff">2</span>], alpha<span style="color:#f92672">=.</span><span style="color:#ae81ff">2</span>)
plt<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upper left&#34;</span>, markerscale<span style="color:#f92672">=</span><span style="color:#ae81ff">1.</span>, scatterpoints<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>)

plt<span style="color:#f92672">.</span>xticks(range(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>), fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)
plt<span style="color:#f92672">.</span>yticks( fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)

ax1<span style="color:#f92672">.</span>grid(axis <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;x&#34;</span>, linestyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;--&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
ax1<span style="color:#f92672">.</span>grid(axis <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;y&#34;</span>, linestyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;--&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)

plt<span style="color:#f92672">.</span>setp(plt<span style="color:#f92672">.</span>gca()<span style="color:#f92672">.</span>get_xticklabels(), rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">45</span>, ha<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;right&#34;</span>)

plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Date&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;°C&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)
plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Annual change in daily maximum temperature: (1971-2100) compared with normal (1971-2000)&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)
 
ax1<span style="color:#f92672">.</span>set_facecolor(<span style="color:#e6db74">&#39;white&#39;</span>)
plt<span style="color:#f92672">.</span>yticks( fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)
plt<span style="color:#f92672">.</span>show()  
</code></pre></div><p><img src="/img/formation/netcdf1/output_78_0.png" alt="png"></p>
<p>Ajoutons à côté de notre graphique un boxplot sur tous les modèles pour la période 1971-2000 et 2071-2100 uniquement.</p>
<p>Nous allons extraire ces périodes de notre résultat matriciel = []</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list_to_remove <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;min&#39;</span>,<span style="color:#e6db74">&#39;max&#39;</span>,<span style="color:#e6db74">&#39;mean&#39;</span>]
df_histo <span style="color:#f92672">=</span> df_histo<span style="color:#f92672">.</span>drop(list_to_remove, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)  
df_rcp45 <span style="color:#f92672">=</span> df_rcp45<span style="color:#f92672">.</span>drop(list_to_remove, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)  
df_rcp85 <span style="color:#f92672">=</span> df_rcp85<span style="color:#f92672">.</span>drop(list_to_remove, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) 
df_histo <span style="color:#f92672">=</span> df_histo<span style="color:#f92672">.</span>loc[<span style="color:#e6db74">&#39;1971&#39;</span> : <span style="color:#e6db74">&#39;2010&#39;</span>]<span style="color:#f92672">.</span>stack()
df_rcp45 <span style="color:#f92672">=</span> df_rcp45<span style="color:#f92672">.</span>loc[<span style="color:#e6db74">&#39;2071&#39;</span> : <span style="color:#e6db74">&#39;2100&#39;</span>]<span style="color:#f92672">.</span>stack()
df_rcp85 <span style="color:#f92672">=</span> df_rcp85<span style="color:#f92672">.</span>loc[<span style="color:#e6db74">&#39;2071&#39;</span> : <span style="color:#e6db74">&#39;2100&#39;</span>]<span style="color:#f92672">.</span>stack()

matrix_box <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;RCMs_histo&#39;</span>: df_histo, <span style="color:#e6db74">&#39;RCMs_rcp45&#39;</span>: df_rcp45,<span style="color:#e6db74">&#39;RCMs_rcp85&#39;</span>: df_rcp85},
        columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;RCMs_histo&#39;</span>,<span style="color:#e6db74">&#39;RCMs_rcp45&#39;</span>,<span style="color:#e6db74">&#39;RCMs_rcp85&#39;</span>])
matrix_box<span style="color:#f92672">.</span>head()
</code></pre></div><!-- raw HTML omitted -->
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">color <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;black&#39;</span>,<span style="color:#e6db74">&#39;blue&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>]
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">12</span>)) 
gs <span style="color:#f92672">=</span> gridspec<span style="color:#f92672">.</span>GridSpec(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, width_ratios<span style="color:#f92672">=</span>[<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">1</span>]) 
gs<span style="color:#f92672">.</span>update( wspace<span style="color:#f92672">=</span><span style="color:#ae81ff">0.04</span>)
ax1 <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplot(gs[<span style="color:#ae81ff">0</span>])

plt<span style="color:#f92672">.</span>rcParams[<span style="color:#e6db74">&#34;figure.figsize&#34;</span>]<span style="color:#f92672">=</span>[<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">9</span>]       <span style="color:#75715e">#  </span>
plt<span style="color:#f92672">.</span>plot(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year, result[<span style="color:#e6db74">&#39;mean_histo&#39;</span>][:],  label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RCMs historical&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, c<span style="color:#f92672">=</span>color[<span style="color:#ae81ff">0</span>])
plt<span style="color:#f92672">.</span>plot(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year, result[<span style="color:#e6db74">&#39;mean_rcp45&#39;</span>][:],  label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RCMs scenario rcp 4.5&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, c<span style="color:#f92672">=</span>color[<span style="color:#ae81ff">1</span>])
plt<span style="color:#f92672">.</span>plot(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year, result[<span style="color:#e6db74">&#39;mean_rcp85&#39;</span>][:],  label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RCMs scenario rcp 8.5&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, c<span style="color:#f92672">=</span>color[<span style="color:#ae81ff">2</span>])

plt<span style="color:#f92672">.</span>fill_between(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year,result[<span style="color:#e6db74">&#39;min_histo&#39;</span>],result[<span style="color:#e6db74">&#39;max_histo&#39;</span>], color <span style="color:#f92672">=</span> color[<span style="color:#ae81ff">0</span>], alpha<span style="color:#f92672">=.</span><span style="color:#ae81ff">2</span>)
plt<span style="color:#f92672">.</span>fill_between(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year,result[<span style="color:#e6db74">&#39;min_rcp45&#39;</span>],result[<span style="color:#e6db74">&#39;max_rcp45&#39;</span>], color <span style="color:#f92672">=</span>  color[<span style="color:#ae81ff">1</span>], alpha<span style="color:#f92672">=.</span><span style="color:#ae81ff">2</span>)
plt<span style="color:#f92672">.</span>fill_between(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year,result[<span style="color:#e6db74">&#39;min_rcp85&#39;</span>],result[<span style="color:#e6db74">&#39;max_rcp85&#39;</span>], color <span style="color:#f92672">=</span>  color[<span style="color:#ae81ff">2</span>], alpha<span style="color:#f92672">=.</span><span style="color:#ae81ff">2</span>)
plt<span style="color:#f92672">.</span>legend(loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;upper left&#34;</span>, markerscale<span style="color:#f92672">=</span><span style="color:#ae81ff">1.</span>, scatterpoints<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>)

<span style="color:#75715e">#ax.set_xlim(result.index.year[0], result.index.year[-1])</span>
plt<span style="color:#f92672">.</span>xticks(range(result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, result<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>year[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>), fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)
plt<span style="color:#f92672">.</span>yticks( fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)

ax1<span style="color:#f92672">.</span>grid(axis <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;x&#34;</span>, linestyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;--&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
ax1<span style="color:#f92672">.</span>grid(axis <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;y&#34;</span>, linestyle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;--&#34;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)

plt<span style="color:#f92672">.</span>setp(plt<span style="color:#f92672">.</span>gca()<span style="color:#f92672">.</span>get_xticklabels(), rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">45</span>, ha<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;right&#34;</span>)

plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Date&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;°C&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)
plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Annual change in daily maximum temperature: (1971-2100) compared with normal (1971-2000)&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)


my_pal <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;RCMs_histo&#34;</span>: <span style="color:#e6db74">&#34;grey&#34;</span>, <span style="color:#e6db74">&#34;RCMs_rcp45&#34;</span>: <span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;RCMs_rcp85&#34;</span>:<span style="color:#e6db74">&#34;red&#34;</span>}
ax2 <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplot(gs[<span style="color:#ae81ff">1</span>])
<span style="color:#75715e">#ax2 = matrix_box.boxplot(column=[&#39;RCMs_histo&#39;, &#39;RCMs_rcp45&#39;, &#39;RCMs_rcp85&#39;])</span>
ax2 <span style="color:#f92672">=</span> sns<span style="color:#f92672">.</span>boxplot(data<span style="color:#f92672">=</span>matrix_box, palette<span style="color:#f92672">=</span>my_pal)  
<span style="color:#75715e"># Add transparency to colors</span>
<span style="color:#66d9ef">for</span> patch <span style="color:#f92672">in</span> ax2<span style="color:#f92672">.</span>artists:
 r, g, b, a <span style="color:#f92672">=</span> patch<span style="color:#f92672">.</span>get_facecolor()
 patch<span style="color:#f92672">.</span>set_facecolor((r, g, b, <span style="color:#f92672">.</span><span style="color:#ae81ff">2</span>))
plt<span style="color:#f92672">.</span>setp(plt<span style="color:#f92672">.</span>gca()<span style="color:#f92672">.</span>get_xticklabels(), rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">45</span>, ha<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;right&#34;</span>)
 
ax1<span style="color:#f92672">.</span>set_facecolor(<span style="color:#e6db74">&#39;white&#39;</span>)
ax2<span style="color:#f92672">.</span>set_facecolor(<span style="color:#e6db74">&#39;white&#39;</span>)
ax2<span style="color:#f92672">.</span>spines[<span style="color:#e6db74">&#39;top&#39;</span>]<span style="color:#f92672">.</span>set_visible(False)
ax2<span style="color:#f92672">.</span>spines[<span style="color:#e6db74">&#39;bottom&#39;</span>]<span style="color:#f92672">.</span>set_visible(False)
ax2<span style="color:#f92672">.</span>spines[<span style="color:#e6db74">&#39;right&#39;</span>]<span style="color:#f92672">.</span>set_visible(False)
ax2<span style="color:#f92672">.</span>spines[<span style="color:#e6db74">&#39;left&#39;</span>]<span style="color:#f92672">.</span>set_visible(False)

medians <span style="color:#f92672">=</span> matrix_box<span style="color:#f92672">.</span>median()<span style="color:#f92672">.</span>values
median_labels <span style="color:#f92672">=</span> [str(np<span style="color:#f92672">.</span>round(s, <span style="color:#ae81ff">2</span>))<span style="color:#f92672">+</span><span style="color:#e6db74">&#39; °C&#39;</span> <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> medians]
pos <span style="color:#f92672">=</span> range(len(medians))
i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> tick,label <span style="color:#f92672">in</span> zip(pos,ax2<span style="color:#f92672">.</span>get_xticklabels()):
    ax2<span style="color:#f92672">.</span>text(pos[tick], medians[tick] <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.1</span>, median_labels[tick], 
            horizontalalignment<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>, size<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;medium&#39;</span>, color <span style="color:#f92672">=</span> color[i], weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)
    i<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
x1, x2, x3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>
ax2<span style="color:#f92672">.</span>text(x1, matrix_box<span style="color:#f92672">.</span>min()<span style="color:#f92672">.</span>min()<span style="color:#f92672">.</span>round()<span style="color:#f92672">-</span><span style="color:#ae81ff">0.15</span> , <span style="color:#e6db74">&#34;1971-2000&#34;</span>, ha<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>, va<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bottom&#39;</span>, size<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;medium&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)   
ax2<span style="color:#f92672">.</span>text((x2<span style="color:#f92672">+</span>x3)<span style="color:#f92672">*.</span><span style="color:#ae81ff">5</span>, matrix_box<span style="color:#f92672">.</span>min()<span style="color:#f92672">.</span>median()<span style="color:#f92672">-</span><span style="color:#ae81ff">0.4</span> , <span style="color:#e6db74">&#34;2071-2100&#34;</span>, ha<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;center&#39;</span>, va<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bottom&#39;</span>, size<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;medium&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, weight<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;semibold&#39;</span>)
plt<span style="color:#f92672">.</span>yticks( fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span>)
    
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;./figures/VI_YEAR_Mean_tasmax.png&#39;</span>, bbox_inches<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tight&#39;</span>, format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;png&#39;</span>, dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>)
plt<span style="color:#f92672">.</span>show()  
</code></pre></div><p><img src="/img/formation/netcdf1/output_81_0.png" alt="png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
</code></pre></div>
          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/formation_python/14-statistique-descriptive-cours/" rel="next">14- La statistique descriptive - Rappels</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/formation_python/15.2-cartopy_library/" rel="prev">15-2- La librairie Cartopy - Cours</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on May 5, 2019</p>

          





  
  

<p class="edit-page">
  <a href="https://github.com/gcushen/hugo-academic/edit/master/content/courses%5cFormation_Python%5c15.1-Netcdf_Tutorial.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
