<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="The Cartopy python library allows you to analyze, process and plot georeferenced data with the help of Matplotlib.
https://scitools.org.uk/cartopy/docs/latest/#
To install the library under the prompt of anaconda: conda install -c conda-forge cartopy
1 - Example of drawing a 2D Netcdf field  We will work climatology (1981-2010) monthly minimum daily temperature At first we will import the Python libraries and open the Netcdf file  The Dataset class of the netCDF4 module is used to open and read Netcdf files.">

  
  <link rel="alternate" hreflang="en-us" href="/courses/tutorial_python_netcdf/3-cartopy_library/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/courses/tutorial_python_netcdf/3-cartopy_library/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/courses/tutorial_python_netcdf/3-cartopy_library/">
  <meta property="og:title" content="3 Cartopy | GDueymes">
  <meta property="og:description" content="The Cartopy python library allows you to analyze, process and plot georeferenced data with the help of Matplotlib.
https://scitools.org.uk/cartopy/docs/latest/#
To install the library under the prompt of anaconda: conda install -c conda-forge cartopy
1 - Example of drawing a 2D Netcdf field  We will work climatology (1981-2010) monthly minimum daily temperature At first we will import the Python libraries and open the Netcdf file  The Dataset class of the netCDF4 module is used to open and read Netcdf files."><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-05-05T00:00:00&#43;01:00">
    
    <meta property="article:modified_time" content="2019-05-05T00:00:00&#43;01:00">
  

  



  


  


  





  <title>3 Cartopy | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/tutorial_python_netcdf/">Python Netcdf</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/tutorial_python_netcdf/1-netcdf_tutorial/">Tutorial Python Netcdf</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/tutorial_python_netcdf/1-netcdf_tutorial/">1 Netcdf Part 1</a>
      </li>
      
      <li >
        <a href="/courses/tutorial_python_netcdf/2-netcdf_tutorial_2/">2 Netcdf Part 2</a>
      </li>
      
      <li class="active">
        <a href="/courses/tutorial_python_netcdf/3-cartopy_library/">3 Cartopy</a>
      </li>
      
      <li >
        <a href="/courses/tutorial_python_netcdf/4-xarray_library/">4 Xarray</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#1-example-of-drawing-a-2d-netcdf-field">1 - Example of drawing a 2D Netcdf field</a></li>
<li><a href="#2-another-example-2d-netcdf">2 - Another example  2D Netcdf</a></li>
<li><a href="#3-cartopy-example-with-overplot">3 - Cartopy: example with overplot</a></li>
<li><a href="#4-cartopy-modis">4 - Cartopy:  MODIS</a></li>
</ul></li>
</ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>3 Cartopy</h1>

          <div class="article-style">
            

<p><img src="/img/netcdf/cartopy.png" alt="image0" /></p>

<p>The Cartopy python library allows you to analyze, process and plot georeferenced data with the help of Matplotlib.</p>

<p><a href="https://scitools.org.uk/cartopy/docs/latest/#" target="_blank">https://scitools.org.uk/cartopy/docs/latest/#</a></p>

<p>To install the library under the prompt of anaconda:
 conda install -c conda-forge cartopy</p>

<h2 id="1-example-of-drawing-a-2d-netcdf-field">1 - Example of drawing a 2D Netcdf field</h2>

<ul>
<li>We will work climatology (1981-2010) monthly minimum daily temperature</li>
<li>At first we will import the Python libraries and open the Netcdf file</li>
</ul>

<p>The Dataset class of the netCDF4 module is used to open and read Netcdf files.
Here we will store the Netcdf file in the variable nc_fid.</p>

<pre><code class="language-python">from netCDF4 import Dataset
import warnings
warnings.filterwarnings(&quot;ignore&quot;)

filename='./DATA/ANUSPLIN/ANUSPLIN_NLDAS_10km_CLIMATO_TASMIN_1981_2010_06.nc'
nc_fid=Dataset(filename,'r')
nc_fid.variables
</code></pre>

<pre><code>OrderedDict([('lon', &lt;class 'netCDF4._netCDF4.Variable'&gt;
              float32 lon(y, x)
                  units: degrees_east
                  long_name: Longitude
                  CoordinateAxisType: Lon
              unlimited dimensions: 
              current shape = (1068, 420)
              filling on, default _FillValue of 9.969209968386869e+36 used),
             ('lat', &lt;class 'netCDF4._netCDF4.Variable'&gt;
              float32 lat(y, x)
                  units: degrees_north
                  long_name: Latitude
                  CoordinateAxisType: Lat
              unlimited dimensions: 
              current shape = (1068, 420)
              filling on, default _FillValue of 9.969209968386869e+36 used),
             ('time', &lt;class 'netCDF4._netCDF4.Variable'&gt;
              float64 time(time)
                  long_name: Time
                  delta_t: 
                  units: Days
              unlimited dimensions: 
              current shape = (1,)
              filling on, default _FillValue of 9.969209968386869e+36 used),
             ('TASMIN', &lt;class 'netCDF4._netCDF4.Variable'&gt;
              float32 TASMIN(time, y, x)
                  long_name: Daily minimum temperature
                  units: Celcius
                  missing_value: -999.0
                  coordinates: lon lat
              unlimited dimensions: 
              current shape = (1, 1068, 420)
              filling on, default _FillValue of 9.969209968386869e+36 used)])
</code></pre>

<p>We will read TASMIN, lat and lon variables.</p>

<pre><code class="language-python">lats = nc_fid.variables['lat'][:]
lons = nc_fid.variables['lon'][:]
time = nc_fid.variables['time'][:]
Vals = nc_fid.variables['TASMIN'][:].squeeze()
print( Vals.shape)
</code></pre>

<pre><code>(1068, 420)
</code></pre>

<p>We will now call the cartopy and matplotlib libraries from Python to create a graphical instance.
The carto library brings functions to visually enrich maps made with cartopy: adding a scale &hellip;</p>

<pre><code class="language-python">import matplotlib.pylab as plt
import cartopy.crs as ccrs
import cartopy.feature as cfeature
import numpy as np
import matplotlib as mpl
from carto import scale_bar
</code></pre>

<p>We create an instance of Cartopy to create a map. We choose here our projection, grid orientation and total coverage.</p>

<p>Here is a very useful link to choose a projection type: <a href="https://scitools.org.uk/cartopy/docs/latest/crs/projections.html" target="_blank">https://scitools.org.uk/cartopy/docs/latest/crs/projections.html</a></p>

<pre><code class="language-python">projections = [ccrs.PlateCarree(),
               ccrs.Robinson(),
               ccrs.Mercator(),
               ccrs.Orthographic(),
               ccrs.InterruptedGoodeHomolosine(),
               ccrs.LambertConformal(),
              ]


for proj in projections:
    plt.figure()
    ax = plt.axes(projection=proj)
    ax.stock_img()
    ax.coastlines()
    ax.set_title(f'{type(proj)}')
</code></pre>

<p><img src="/img/netcdf/output_7_0.png" alt="png" /></p>

<p><img src="/img/netcdf/output_7_1.png" alt="png" /></p>

<p><img src="/img/netcdf/output_7_2.png" alt="png" /></p>

<p><img src="/img/netcdf/output_7_3.png" alt="png" /></p>

<p><img src="/img/netcdf/output_7_4.png" alt="png" /></p>

<p><img src="/img/netcdf/output_7_5.png" alt="png" /></p>

<p>In this example, we will work with a so-called &ldquo;LambertConformal&rdquo; projection.
To create a regional map, we use the GeoAxis set_extent method to limit the size of our region.</p>

<pre><code class="language-python">fig=plt.figure(figsize=(5,3), frameon=True)   
ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-100,-60,18,62])
</code></pre>

<p><img src="/img/netcdf/output_9_0.png" alt="png" /></p>

<p>We will add some products to our map with Cartopy&rsquo;s cartopy.feature method:
<a href="https://scitools.org.uk/cartopy/docs/v0.14/matplotlib/feature_interface.html" target="_blank">https://scitools.org.uk/cartopy/docs/v0.14/matplotlib/feature_interface.html</a></p>

<p>|  |  |
|&ndash;|&ndash;|
| cartopy.feature.<b>BORDERS</b> | Borders |
| cartopy.feature.<b>COASTLINE</b> | Coast |
| cartopy.feature.<b>LAKES</b> | Lakes |
| cartopy.feature.<b>LAND</b> | Continents |
| cartopy.feature.<b>OCEAN</b> | Ocean |
| cartopy.feature.<b>RIVERS</b> | Rivers |
| cartopy.feature.<b>STATES</b> | States |</p>

<p>We will also add the provinces with Cartopy&rsquo;s NaturalEarthFeature class:
<a href="https://scitools.org.uk/cartopy/docs/v0.16/matplotlib/feature_interface.html#cartopy.feature.NaturalEarthFeature" target="_blank">https://scitools.org.uk/cartopy/docs/v0.16/matplotlib/feature_interface.html#cartopy.feature.NaturalEarthFeature</a></p>

<p>We work here by adding layers.</p>

<pre><code class="language-python"># adding caost:
ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-130,-60,18,62])
ax.coastlines(resolution='110m');
plt.show()

</code></pre>

<p><img src="/img/netcdf/output_11_0.png" alt="png" /></p>

<pre><code class="language-python"># adding land and oceanss:

ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-130,-60,18,62])
ax.coastlines(resolution='110m');
ax.add_feature(cfeature.OCEAN.with_scale('50m'))
ax.add_feature(cfeature.LAND.with_scale('50m'))
plt.show()
</code></pre>

<p><img src="/img/netcdf/output_12_0.png" alt="png" /></p>

<pre><code class="language-python"># adding lakes and rivers
ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-130,-60,18,62])
ax.coastlines(resolution='110m');
ax.add_feature(cfeature.OCEAN.with_scale('50m'))
ax.add_feature(cfeature.LAKES.with_scale('50m'))
ax.add_feature(cfeature.LAND.with_scale('50m'))
ax.add_feature(cfeature.BORDERS.with_scale('50m'))
plt.show()
</code></pre>

<p><img src="/img/netcdf/output_13_0.png" alt="png" /></p>

<pre><code class="language-python"># Adding states
ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-130,-60,18,62])
ax.coastlines(resolution='110m');
ax.add_feature(cfeature.OCEAN.with_scale('50m'))
ax.add_feature(cfeature.LAND.with_scale('50m'))
ax.add_feature(cfeature.LAKES.with_scale('50m'))
ax.add_feature(cfeature.BORDERS.with_scale('50m'))
states_provinces = cfeature.NaturalEarthFeature(
        category='cultural',
        name='admin_1_states_provinces_lines',
        scale='50m',
        facecolor='none')

ax.add_feature(states_provinces, edgecolor='gray')
plt.show()
</code></pre>

<p><img src="/img/netcdf/output_14_0.png" alt="png" /></p>

<p>We can now fill our map with our georeferenced field with the method pcolormesh of matplotlib: <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.pcolormesh.html" target="_blank">https://matplotlib.org/api/_as_gen/matplotlib.pyplot.pcolormesh.html</a></p>

<p>Here Lat Lon coordinates are in 2D, so in each grid point we know the latitude and longitude of our fields.</p>

<p>It is possible that for a netcdf file Lat and Lon are in 1D. We must then write them in 2D with the following command:</p>

<p>-lon, lat = np.meshgrid (lons, lats)</p>

<p>We will also produce our own color palette. Here is a useful link to select our colors and create our palette: <a href="http://colorbrewer2.org/#type=diverging&amp;scheme=RdYlBu&amp;n=8" target="_blank">http://colorbrewer2.org/#type=diverging&amp;scheme=RdYlBu&amp;n=8</a></p>

<p>You can also use one of the color palettes predefined by Matplotlip: <a href="https://matplotlib.org/examples/color/colormaps_reference.html" target="_blank">https://matplotlib.org/examples/color/colormaps_reference.html</a></p>

<p>We will use to draw our map type pcolormesh matplotib. Other types of plots are available: <a href="https://matplotlib.org/basemap/users/examples.html" target="_blank">https://matplotlib.org/basemap/users/examples.html</a></p>

<p>To improve the reading of our map, we can at this level add:</p>

<ul>
<li>a legend under the map: cbar.set_label</li>

<li><p>add a color bar with a display interval: plt.colorbar</p>

<pre><code class="language-python">Y=np.array([[77,0,111],[115,14,181],[160,17,222],[195,14,240],\
           [0,0,93],[21,38,177],[33,95,227],[32,162,247],[59,224,248],[202,255,250],\
           [4,255,179],[37,181,139],[32,132,81],[72,162,60],[157,240,96],[213,255,166],\
           [241,247,132],[248,185,68],[255,124,4],[235,78,14],[215,32,24],[189,24,40],[162,16,56],[135,16,65],[107,15,73]])/255.

colbar=mpl.colors.ListedColormap(Y)
fig=plt.figure(figsize=(10,6), frameon=True)  
ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-130,-60,18,62])

mm = ax.pcolormesh(lons,\
               lats,\
               Vals,\
               vmin=-28,\
               vmax=28, \
               transform=ccrs.PlateCarree(),\
               cmap=colbar )


ax.coastlines(resolution='110m');
ax.add_feature(cfeature.OCEAN.with_scale('50m'))
ax.add_feature(cfeature.LAND.with_scale('50m'))
ax.add_feature(cfeature.LAKES.with_scale('50m'))
ax.add_feature(cfeature.BORDERS.with_scale('50m'))

states_provinces = cfeature.NaturalEarthFeature(
    category='cultural',
    name='admin_1_states_provinces_lines',
    scale='50m',
    facecolor='none')

ax.add_feature(states_provinces, edgecolor='gray')  
ax.stock_img();
plt.show() 

</code></pre></li>
</ul>

<p><img src="/img/netcdf/output_16_0.png" alt="png" /></p>

<p>If the pallet is not suitable, it is possible to use a palette of Matplotlib.</p>

<pre><code class="language-python">fig=plt.figure(figsize=(10,6), frameon=True)  
ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-130,-60,18,62])

mm = ax.pcolormesh(lons,\
                   lats,\
                   Vals,\
                   vmin=-28,\
                   vmax=28, \
                   transform=ccrs.PlateCarree(),\
                   cmap='jet' )


ax.coastlines(resolution='110m');
ax.add_feature(cfeature.OCEAN.with_scale('50m'))
ax.add_feature(cfeature.LAND.with_scale('50m'))
ax.add_feature(cfeature.LAKES.with_scale('50m'))
ax.add_feature(cfeature.BORDERS.with_scale('50m'))

states_provinces = cfeature.NaturalEarthFeature(
        category='cultural',
        name='admin_1_states_provinces_lines',
        scale='50m',
        facecolor='none')

ax.add_feature(states_provinces, edgecolor='gray')  
ax.stock_img();
plt.show() 

</code></pre>

<p><img src="/img/netcdf/output_18_0.png" alt="png" /></p>

<p>We can finally add:
    - a title to our chart: plt.title
    - a color bar plt.colorbar
    - a title to our color bar: plt.xlabel
    - latitudes and longitudes with the function: gridlines ()
    - a scale bar: scale_bar ()</p>

<p>Then save our chart with the command: plt.savefig</p>

<pre><code class="language-python">Y=np.array([[77,0,111],[115,14,181],[160,17,222],[195,14,240],\
               [0,0,93],[21,38,177],[33,95,227],[32,162,247],[59,224,248],[202,255,250],\
               [4,255,179],[37,181,139],[32,132,81],[72,162,60],[157,240,96],[213,255,166],\
               [241,247,132],[248,185,68],[255,124,4],[235,78,14],[215,32,24],[189,24,40],[162,16,56],[135,16,65],[107,15,73]])/255.

colbar=mpl.colors.ListedColormap(Y)
fig=plt.figure(figsize=(22,12), frameon=True)  
ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-130,-60,18,62])

mm = ax.pcolormesh(lons,\
                   lats,\
                   Vals,\
                   vmin=-28,\
                   vmax=28, \
                   transform=ccrs.PlateCarree(),\
                   cmap=colbar )


ax.coastlines(resolution='110m');
ax.add_feature(cfeature.OCEAN.with_scale('50m'))
ax.add_feature(cfeature.LAND.with_scale('50m'))
ax.add_feature(cfeature.LAKES.with_scale('50m'))
ax.add_feature(cfeature.BORDERS.with_scale('50m'))

states_provinces = cfeature.NaturalEarthFeature(
        category='cultural',
        name='admin_1_states_provinces_lines',
        scale='50m',
        facecolor='none')

ax.add_feature(states_provinces, edgecolor='gray')  
ax.stock_img();

# Define gridline locations and draw the lines using cartopy's built-in gridliner:
xticks = np.arange(-150.0,-40.0,20)
yticks =np.arange(10,80,10)
ax.gridlines()

# Standard 6,000 km scale bar.
scale_bar(ax, (0.85, 0.2), 500 ,plot_kwargs = dict(linestyle='dashed', color='black'))

cbar = plt.colorbar(mm, orientation='horizontal', shrink=0.75, drawedges='True', ticks=np.arange(-28, 28.1, 4),extend='both')
cbar.set_label(u'\n Projection = Lambert Conformal Conic / Lambert Conique Conforme\nResolution: 5 Arcs-Minutes (10 km)\nData provided by Natural Resources Canada and the University of Washington/ Données fournies par Ressources Naturelles Canada et l Université de Washington', size='medium') # Affichage de la légende de la barre de couleur
cbar.ax.tick_params(labelsize=17) 
 
plt.xlabel(u'\n\n\nTemperature / Température (°C)',size='x-large')
string_title=u'Daily Minimum Temperature / Température Minimale Quotidienne\n in June / en Juin \nMonthly Mean Climatology / Climatologie Moyenne Mensuelle (1981 - 2010)\n\n'
plt.title(string_title, size='xx-large')
plt.savefig('./figures/ANUSPLIN_NLDAS_10km_CLIM_TASMIN_06_1981-2010.png', bbox_inches='tight', pad_inches=0.1)
plt.show() 

</code></pre>

<p><img src="/img/netcdf/output_20_0.png" alt="png" /></p>

<h2 id="2-another-example-2d-netcdf">2 - Another example  2D Netcdf</h2>

<ul>
<li><p>We will work with the climatology of the total monthly precipitation accumulation  (1981-2010) for the month of December.</p>

<pre><code class="language-python">from netCDF4 import Dataset
import matplotlib.pylab as plt
import cartopy.crs as ccrs
import cartopy.feature as cfeature
import numpy as np
from carto import scale_bar
</code></pre>

<pre><code class="language-python">rep_data='./DATA/ANUSPLIN/'
fic=rep_data+'ANUSPLIN_NLDAS_10km_CLIMATO_PrecTOT_1981_2010_12.nc'
dset=Dataset(fic)
</code></pre>

<pre><code class="language-python">precip=dset.variables['PrecTOT'][:].squeeze()
lon=dset.variables['lon'][:].squeeze()
lat=dset.variables['lat'][:].squeeze()
</code></pre>

<pre><code class="language-python">## Interrogeons un peu chaque variable
print('-----------------------------------------')
print('dimension de precipitation = ',precip.shape)
print('Min de precip est = ', np.nanmin(precip))
print('Max de precip est = ', np.nanmax(precip))
print('-----------------------------------------')
print('-----------------------------------------')
print('dimension de latitude = ',lat.shape)
print('Min de lat est = ', np.min(lat))
print('Max de lat est = ', np.max(lat))
print('-----------------------------------------')
print('-----------------------------------------')
print('dimension de longitude = ',lon.shape)
print('Min de lon est = ', np.min(lon))
print('Max de lon est = ', np.max(lon))
print('-----------------------------------------')
dimension de precipitation =  (1068, 420)
Min de precip est =  2.2327309
Max de precip est =  809.1944
dimension de latitude =  (1068, 420)
Min de lat est =  25.125
Max de lat est =  60.041664
dimension de longitude =  (1068, 420)
Min de lon est =  -140.95833
Max de lon est =  -52.04167
</code></pre>

<pre><code class="language-python">fig = plt.figure(figsize=(22,12))

ax = plt.subplot(111, projection=ccrs.LambertConformal())
ax.set_extent([-130,-60,18,62])
ax.coastlines(resolution='110m');
ax.add_feature(cfeature.OCEAN.with_scale('50m'))
ax.add_feature(cfeature.LAND.with_scale('50m'))
ax.add_feature(cfeature.LAKES.with_scale('50m'))
ax.add_feature(cfeature.BORDERS.with_scale('50m'))

## Choisissons une colormap
cmap0=plt.cm.jet_r
cmap0.set_under('w') ## on met en blanc les valeurs inferieures au min de clev
cmap0.set_over('darkblue') ## bleu fonce pour les valeurs extremes de pluie

mm = ax.pcolormesh(lon,\
               lat,\
               precip,\
               vmin=0,\
               vmax=150, \
               transform=ccrs.PlateCarree(),\
               cmap=cmap0 )

states_provinces = cfeature.NaturalEarthFeature(
    category='cultural',
    name='admin_1_states_provinces_lines',
    scale='50m',
    facecolor='none')

ax.add_feature(states_provinces, edgecolor='gray')  
ax.stock_img();

ax.gridlines()

# Define gridline locations and draw the lines using cartopy's built-in gridliner:
xticks = np.arange(-150.0,-40.0,20)
yticks =np.arange(10,80,10)

fig.canvas.draw()

# Standard 6,000 km scale bar.
scale_bar(ax, (0.85, 0.2), 500 ,plot_kwargs = dict(linestyle='dashed', color='black'))

cbar = plt.colorbar(mm, shrink=0.75, drawedges='True', ticks=np.arange(0, 150.1, 20),extend='both')
cbar.ax.tick_params(labelsize=17) 

plt.xlabel(u'\Precipitation (mm)',size='x-large')
string_title=u'Precipitation climatology ANUSPLIN: December 1981-2010'
plt.title(string_title, size='xx-large')
plt.savefig('./figures/My_2Dlalon_plot.png', bbox_inches='tight', pad_inches=0.1,  dpi=150)
plt.show()  
plt.close()
</code></pre></li>
</ul>

<p><img src="/img/netcdf/output_26_0.png" alt="png" /></p>

<h2 id="3-cartopy-example-with-overplot">3 - Cartopy: example with overplot</h2>

<p>Sometimes we want to have many plots on the same picture.</p>

<ul>
<li>We will work the climatologies of the total monthly accumulation of precipitation (1981-2010) for all the months of the year.</li>
</ul>

<p>We will produce the same previous operation but for each month using a loop for.</p>

<pre><code class="language-python">## we import librairies that we need

from netCDF4 import Dataset
import matplotlib.pylab as plt
import cartopy.crs as ccrs
import cartopy.feature as cfeature
import numpy as np
from carto import scale_bar

month_name=[&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;June&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]
rep_data='./DATA/ANUSPLIN/'

fig=plt.figure(figsize=(12,15))
clevs=np.arange(5,150.1,5)
## Colormap we will use
cmap0=plt.cm.jet_r
cmap0.set_under('w') 
cmap0.set_over('darkblue')

for imonth in np.arange(1,13):  # loop over 12 months
    ax=fig.add_subplot(4,3,imonth, projection=ccrs.LambertConformal())   
    fic=rep_data+'ANUSPLIN_NLDAS_10km_CLIMATO_PrecTOT_1981_2010_'+'{:02d}'.format(imonth)+'.nc'
    dset=Dataset(fic)
    precip=dset.variables['PrecTOT'][:].squeeze()
    lon=dset.variables['lon'][:].squeeze()
    lat=dset.variables['lat'][:].squeeze()
    
    ax.set_extent([-130,-60,18,62])
    ax.coastlines(resolution='110m');
    ax.add_feature(cfeature.LAND.with_scale('50m'))
    ax.add_feature(cfeature.OCEAN.with_scale('50m'))
    ax.add_feature(cfeature.LAKES.with_scale('50m'))
    ax.add_feature(cfeature.BORDERS.with_scale('50m'))

    mm = ax.pcolormesh(lon,\
                   lat,\
                   precip,\
                   vmin=0,\
                   vmax=150, \
                   transform=ccrs.PlateCarree(),\
                   cmap=cmap0 )
    plt.title('Normale '+ month_name[imonth-1],fontsize=12)
    states_provinces = cfeature.NaturalEarthFeature(
        category='cultural',
        name='admin_1_states_provinces_lines',
        scale='50m',
        facecolor='none')

    ax.add_feature(states_provinces, edgecolor='gray')  
    ax.stock_img();
    ax.gridlines();
    # Standard 6,000 km scale bar.
    scale_bar(ax, (0.85, 0.2), 500 ,plot_kwargs = dict(linestyle='dashed', color='black'))

plt.savefig('./figures/My_2Dlalon_multipanel_plot.png')
plt.show()
</code></pre>

<p><img src="/img/netcdf/output_28_0.png" alt="png" /></p>

<h2 id="4-cartopy-modis">4 - Cartopy:  MODIS</h2>

<p><a href="https://lance-modis.eosdis.nasa.gov/imagery/gallery/2012270-0926/Miriam.A2012270.2050.2km.jpg" target="_blank">https://lance-modis.eosdis.nasa.gov/imagery/gallery/2012270-0926/Miriam.A2012270.2050.2km.jpg</a></p>

<p><a href="https://lance-modis.eosdis.nasa.gov/imagery/gallery/2012270-0926/Miriam.A2012270.2050.txt" target="_blank">https://lance-modis.eosdis.nasa.gov/imagery/gallery/2012270-0926/Miriam.A2012270.2050.txt</a></p>

<pre><code class="language-python">fig = plt.figure(figsize=(12, 20))

fname = './figures/Miriam.A2012270.2050.1km.jpg'
img_extent = (-120.67660000000001, -106.32104523100001, 13.2301484511245, 30.766899999999502)
img = plt.imread(fname)

ax = plt.axes(projection=ccrs.PlateCarree())

# set a margin around the data
ax.set_xmargin(0.05)
ax.set_ymargin(0.10)

# ajout de l'image
ax.imshow(img, origin='upper', extent=img_extent, transform=ccrs.PlateCarree())
ax.coastlines(resolution='50m', color='black', linewidth=1)

# ajout d'une ville
ax.plot(-117.1625, 32.715, 'bo', markersize=7, transform=ccrs.Geodetic())
ax.text(-117, 33, 'San Diego', transform=ccrs.Geodetic())
</code></pre>

<pre><code>Text(-117, 33, 'San Diego')
</code></pre>

<p><img src="/img/netcdf/output_30_1.png" alt="png" /></p>

          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/tutorial_python_netcdf/2-netcdf_tutorial_2/" rel="next">2 Netcdf Part 2</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/tutorial_python_netcdf/4-xarray_library/" rel="prev">4 Xarray</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on May 5, 2019</p>

          





  
  

<p class="edit-page">
  <a href="https://github.com/gcushen/hugo-academic/edit/master/content/courses/Tutorial_Python_Netcdf/3-Cartopy_Library.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
