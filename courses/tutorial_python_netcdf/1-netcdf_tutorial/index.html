<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.6.2">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Guillaume Dueymes">

  
  
  
    
  
  <meta name="description" content="Using Network Common Data Form (Netcdf) is a way to create, access, and share scientific data in a format that is self-documenting and transparent for many types of machines.
The Netcdf file itself has information describing the data it contains.
A NetCDF file has dimensions, variables, and attributes.
Here is a small example of a NetCDF file, to illustrate these concepts of dimensions, variables and attributes.
The notation used to describe this NetCDF file is called Network Common Data Language (CDL).">

  
  <link rel="alternate" hreflang="en-us" href="/courses/tutorial_python_netcdf/1-netcdf_tutorial/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/courses/tutorial_python_netcdf/1-netcdf_tutorial/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="GDueymes">
  <meta property="og:url" content="/courses/tutorial_python_netcdf/1-netcdf_tutorial/">
  <meta property="og:title" content="1 Netcdf Part 1 | GDueymes">
  <meta property="og:description" content="Using Network Common Data Form (Netcdf) is a way to create, access, and share scientific data in a format that is self-documenting and transparent for many types of machines.
The Netcdf file itself has information describing the data it contains.
A NetCDF file has dimensions, variables, and attributes.
Here is a small example of a NetCDF file, to illustrate these concepts of dimensions, variables and attributes.
The notation used to describe this NetCDF file is called Network Common Data Language (CDL)."><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-05-05T00:00:00&#43;01:00">
    
    <meta property="article:modified_time" content="2019-05-05T00:00:00&#43;01:00">
  

  



  


  


  





  <title>1 Netcdf Part 1 | GDueymes</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    
    
      <a class="navbar-brand" href="/">GDueymes</a>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/courses/"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/Guillaume_Dueymes2019.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/tutorial_python_netcdf/">Python Netcdf</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/tutorial_python_netcdf/1-netcdf_tutorial/">Tutorial Python Netcdf</a>
    <ul class="nav docs-sidenav">
      
      <li class="active">
        <a href="/courses/tutorial_python_netcdf/1-netcdf_tutorial/">1 Netcdf Part 1</a>
      </li>
      
      <li >
        <a href="/courses/tutorial_python_netcdf/2-netcdf_tutorial_2/">2 Netcdf Part 2</a>
      </li>
      
      <li >
        <a href="/courses/tutorial_python_netcdf/3-cartopy_library/">3 Cartopy</a>
      </li>
      
      <li >
        <a href="/courses/tutorial_python_netcdf/4-xarray_library/">4 Xarray</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#1-create-a-netcdf-file">1- Create a Netcdf file:</a></li>
<li><a href="#2-read-a-netcdf-file">2- Read a Netcdf file</a></li>
<li><a href="#3-examples-of-manipulations-of-a-netcdf-file">3- Examples of manipulations of a Netcdf file</a></li>
<li><a href="#4-netcdf-gridpoint-extraction">4- Netcdf gridpoint extraction</a></li>
</ul></li>
</ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>1 Netcdf Part 1</h1>

          <div class="article-style">
            

<p>Using Network Common Data Form (Netcdf)  is a way to create, access, and share scientific data in a format that is self-documenting and transparent for many types of machines.</p>

<p><img src="/img/netcdf/xarray.png" alt="image0" /></p>

<p>The Netcdf file itself has information describing the data it contains.</p>

<p>A NetCDF file has dimensions, variables, and attributes.</p>

<p>Here is a small example of a NetCDF file, to illustrate these concepts of dimensions, variables and attributes.</p>

<p>The notation used to describe this NetCDF file is called Network Common Data Language (CDL). It gives a &ldquo;text&rdquo; version that allows an easy understanding of the structure and contents of a binary NetCDF file:</p>

<pre><code>netcdf ./data/NARR_tasmax_201701.nc {
  dimensions:
x = 349;
y = 277;
time = 31;
  variables:
float lon(y=277, x=349);
  :units = &quot;degrees_east&quot;;
  :long_name = &quot;Longitude&quot;;
  :CoordinateAxisType = &quot;Lon&quot;;

float lat(y=277, x=349);
  :units = &quot;degrees_north&quot;;
  :long_name = &quot;Latitude&quot;;
  :CoordinateAxisType = &quot;Lat&quot;;

double time(time=31);
  :long_name = &quot;Time&quot;;
  :delta_t = &quot;&quot;;

float tasmax(time=31, y=277, x=349);
  :long_name = &quot;Daily maximum temperature&quot;;
  :units = &quot;Celcius&quot;;
  :missing_value = -999.0; // double
  :coordinates = &quot;lon lat&quot;;
</code></pre>

<p>}</p>

<p>Panoply is an apensource software used to quickly read aned visualize Netcdf file:
<a href="https://www.giss.nasa.gov/tools/panoply/download/" target="_blank">https://www.giss.nasa.gov/tools/panoply/download/</a></p>

<p>The python module that we will use in this section is netCDF4:
<a href="https://pypi.org/project/netCDF4/" target="_blank">https://pypi.org/project/netCDF4/</a></p>

<p>To install it under anaconda: <b>conda install -c anaconda netcdf4</b></p>

<p><img src="/img/netcdf/CanESM2_rcp85_r1i1p1_global_tos.jpg" alt="image0" /></p>

<h2 id="1-create-a-netcdf-file">1- Create a Netcdf file:</h2>

<pre><code class="language-python">from netCDF4 import Dataset
import os 
import warnings
warnings.filterwarnings(&quot;ignore&quot;)

file_name = &quot;./DATA/2D_Temperature.nc&quot;
if os.path.isfile(file_name):
    os.remove(file_name)
    
#open the file for writing, you can Also specify format=&quot;NETCDF4_CLASSIC&quot; or &quot;NETCDF3_CLASSIC&quot;
#The format is NETCDF4 by default
ds = Dataset(file_name, mode=&quot;w&quot;)
</code></pre>

<ul>
<li>Netcdf4-python: <b>createDimension</b></li>
</ul>

<p>We will create here a 2D field: (20,20)</p>

<pre><code class="language-python">ds.createDimension(&quot;x&quot;, 20)
ds.createDimension(&quot;y&quot;, 20)
ds.createDimension(&quot;time&quot;, None)
</code></pre>

<pre><code>&lt;class 'netCDF4._netCDF4.Dimension'&gt; (unlimited): name = 'time', size = 0
</code></pre>

<ul>
<li><p>Netcdf4-python: <b>createVariable</b></p>

<pre><code class="language-python">var1 = ds.createVariable(&quot;field1&quot;, &quot;f4&quot;, (&quot;time&quot;, &quot;x&quot;, &quot;y&quot;))
var2 = ds.createVariable(&quot;field2&quot;, &quot;f4&quot;, (&quot;time&quot;, &quot;x&quot;, &quot;y&quot;))

#add netcdf attributes
var1.units = &quot;Celcius&quot;
var1.long_name = &quot;Surface air temperature&quot;

var2.units = &quot;Kelvin&quot;
var2.long_name = &quot;Surface air temperature&quot;

</code></pre></li>
</ul>

<p>We can now assign our field or variable.</p>

<pre><code class="language-python">#generate random data and tell the program where it should go
import numpy as np
data = np.random.randn(10, 20, 20)
var1[:] = data
var2[:] =  data + 273.15
#actually write data to the disk
ds.close();
</code></pre>

<h2 id="2-read-a-netcdf-file">2- Read a Netcdf file</h2>

<p>We will read the file Netcdf4 that we created previously.</p>

<pre><code class="language-python">from netCDF4 import Dataset
ds = Dataset(&quot;./DATA/2D_Temperature.nc&quot;)
</code></pre>

<p>We will select our variables of interest: no data is loaded at this level.</p>

<pre><code class="language-python"># Which variables are in our Netcdf file ?
print(ds.variables.keys())

data1_var = ds.variables[&quot;field1&quot;]
data2_var = ds.variables[&quot;field2&quot;]

#What's the dimension ?
print(data1_var.dimensions, data1_var.shape)
</code></pre>

<pre><code>odict_keys(['field1', 'field2'])
('time', 'x', 'y') (10, 20, 20)
</code></pre>

<p>We can now read our file:</p>

<pre><code class="language-python">#now we ask to really read the data into the memory
all_data = data1_var[:]
#print all_data.shape
data1 = data1_var[1,:,:]
data2 = data2_var[2,:,:]
#data1
print(data1.shape, all_data.shape, all_data.mean(axis = 0).mean(axis = 0).mean(axis = 0))
</code></pre>

<pre><code>(20, 20) (10, 20, 20) 0.0055584796
</code></pre>

<h2 id="3-examples-of-manipulations-of-a-netcdf-file">3- Examples of manipulations of a Netcdf file</h2>

<p>In this example we will work with daily maximum temperature data for all January months from 1971 to 2000 from the CRCM5 regional model developed at the ESCER center.</p>

<p>We will import our own module for calculating temperature indices, this module is calld Indices_Temperature.</p>

<p>At first we will import the necessary libraries and define the input parameters.</p>

<pre><code class="language-python">from netCDF4 import Dataset
import Indices_Temperature
import numpy as np

Mois='01'
model='CRCM5-v1_NAM-44_ll_CCCma-CanESM2'
path_model='CRCM5-v1_CCCma-CanESM2_historical'
variable='tasmax'
indice = 'Tmax90p'
yi = 1971
yf = 2000
#########################################################
rep_data='./DATA/CRCM5/'
rep_out='./DATA/CRCM5/'
tot=(yf-yi)+1 
</code></pre>

<ul>
<li><p>Let&rsquo;s open &lsquo;CRCM5-v1_NAM-44_ll_CCCma-CanESM2_historical_tasmax_197101.nc&rsquo; file:</p>

<pre><code class="language-python">nc_Modc=Dataset('./DATA/CRCM5/'+model+'_historical_'+variable+'_197101.nc','r')
lats=nc_Modc.variables['lat'][:]
lons=nc_Modc.variables['lon'][:]
varc=nc_Modc.variables[variable][:]
</code></pre>

<pre><code class="language-python">## Quick look of our file: 
print('-----------------------------------------')
print('Temperature dimension = ',varc.shape)
print('Minimum of temperature = ', np.nanmin(varc))
print('Maximum of temperature = ', np.nanmax(varc))
print('-----------------------------------------')
print('-----------------------------------------')
print('Latitude dimension= ',lats.shape)
print('Minimum of latitude = ', np.min(lats))
print('Maximum of latitude = ', np.max(lats))
print('-----------------------------------------')
print('-----------------------------------------')
print('Longitude dimesion = ',lons.shape)
print('Minimum of longitude = ', np.min(lons))
print('Maximum of longitude = ', np.max(lons))

Temperature dimension =  (31, 130, 155)
Minimum of temperature =  -57.66677
Maximum of temperature =  30.657953
Latitude dimension=  (130, 155)
Minimum of latitude =  12.538727
Maximum of latitude =  75.86
Longitude dimesion =  (130, 155)
Minimum of longitude =  -170.71053
Maximum of longitude =  -23.28948
</code></pre></li>
</ul>

<p>We can now loop over all our Netcdf files and apply a function to calculate our indice.</p>

<pre><code class="language-python">nt=0
IND = np.zeros((tot,130,155),dtype=float)
for year in range(yi,yf+1):
    ###### ouverture et lecture des fichiers Netcdf
    hist=model+'_historical_'+variable+'_'+str(year)+Mois+'.nc'     
    modelc=rep_data+'/'+hist
    nc_Modc=Dataset(modelc,'r')
    lats=nc_Modc.variables['lat'][:]
    lons=nc_Modc.variables['lon'][:]
    varc=nc_Modc.variables[variable][:]
    
    ###### boucle sur tous les points de grille et calcul de l'indice
    for ni in range(0, len(varc[0])):
        for nj in range(0, len(varc[0][0])):
            if indice == 'Mean_tasmax':
                IND[nt,ni,nj]=Indices_Temperature.MOY(varc[:,ni,nj])
                description='Monthly Mean of tasmax'
                unite='°Celcius'
            elif indice == 'Tmax90p':
                IND[nt,ni,nj]=Indices_Temperature.Tmax90p(varc[:,ni,nj])
                description='Monthly Mean of Tmax90p' 
                unite='°Celcius'               
    nt+=1 
    
    ###### Écriture du fichier Netcdf en sortie
C = Dataset(rep_out+model+'_historical_'+indice+'_'+str(yi)+'-'+str(yf)+'_'+Mois+'.nc', 'w')
C.description = 'Indice temperature'
C.conventions = 'CF-1.0'  
C.model_id = model
C.grid='latlon'
C.CDO = 'Climate Data Operators version 1.6.2 (http://code.zmaw.de/projects/cdo)'
C.institution = 'UQAM - ESCER Center, University of Quebec in Montreal'
C.contact = 'Guillaume Dueymes'
########################################
# Dimensions
C.createDimension('x', len(varc[0][0]))
C.createDimension('y', len(varc[0]))
C.createDimension('time', tot)

var=C.createVariable(str(indice), np.float32, ('time','y','x')) 
var.long_name = str(description)
var.unit = str(unite)
lat=C.createVariable('lat', np.float32, ('y','x'))
lon=C.createVariable('lon', np.float32, ('y','x')) 

time = C.createVariable('time', np.float64, ('time',))
time.long_name = 'time'

for var in ['lon','lat','time']:
    for att in nc_Modc.variables[var].ncattrs():
        setattr(C.variables[var],att,getattr(nc_Modc.variables[var],att))

time[:]=range(1,nt+1)
lat[:,:] = lats
lon[:,:] = lons
C.variables[str(indice)][:,:,:] = IND[::]
C.close()
    
</code></pre>

<pre><code class="language-python">IND.shape
</code></pre>

<pre><code>(30, 130, 155)
</code></pre>

<h2 id="4-netcdf-gridpoint-extraction">4- Netcdf gridpoint extraction</h2>

<p>In this example we will work with maximum daily temperature data from Regional Reanalysis (NARR) Regional Reanalysis. For more information about this product:</p>

<p>www.emc.ncep.noaa.gov/mmb/rreanl</p>

<p>The Netcdf files that we will open are daily values from January 1, 2017 to December 31, 2017. Files are archived by month.</p>

<p>The NARR grid point closest to the ECCC Montréal / McTavish weather station (45.5N, -73.8W) will be extracted here.</p>

<p>We first import the libraries.</p>

<pre><code class="language-python">import netCDF4
import numpy as np
import pandas as pd
import datetime
from datetime import date, timedelta
from dateutil.relativedelta import relativedelta
</code></pre>

<pre><code class="language-python">rep1='./DATA/NARR/'
model='NARR'
variable='tasmax'
variable_name='Temperature maximale'
yeari=2017
monthi=1
yearf = 2017
monthf = 12
station='Montreal' 
lati = 45.5
loni = -73.8

day_start=1
day_end = pd.date_range('{}-{}'.format(yearf, monthf), periods=1, freq='M').day.tolist()[0]
start=datetime.datetime(yeari,monthi,day_start)
end=datetime.datetime(yearf,monthf,day_end)
d0 = date(yeari, monthi, day_start)
d1 = date(yearf, monthf, day_end)
delta = d1 - d0
nb_days = delta.days+1
var_data=np.zeros(nb_days)

</code></pre>

<p>We define a function that will calculate the distance between each grid point of the Netcdf file and our reference latitude / longitude. We then deduce the minimum distance.</p>

<p>The other function allows us to increment our months when reading Netcdf files.</p>

<pre><code class="language-python">def getclosest_ij(lats,lons,latpt,lonpt):
     # find squared distance of every point on grid
     dist_sq = (lats-latpt)**2 + (lons-lonpt)**2 
     # 1D index of minimum dist_sq element
     minindex_flattened = dist_sq.argmin()
     # Get 2D index for latvals and lonvals arrays from 1D index
     return np.unravel_index(minindex_flattened, lats.shape)

def add_month(now):
    try:
        then = (now + relativedelta(months=1)).replace(day=now.day)
    except ValueError:
        then = (now + relativedelta(months=2)).replace(day=1)
    return then
</code></pre>

<p>We can know apply our function over each grid point, month by month and save the value into a DataFrame.</p>

<pre><code class="language-python">
i=0
IND=[]
# Début de notre boucle temporelle
incr=start
while incr &lt;= end:
    filename= rep1 + model + '_' + variable + '_' + str(incr.year) + '{:02d}'.format(incr.month) + '.nc'   
    f = netCDF4.Dataset(filename)
   # print(f.variables.keys()) # get all variable names
    var = f.variables[variable] # temperature variable
    #print(temp) 
    #temp.dimensions
    #temp.shape
    lat, lon = f.variables['lat'], f.variables['lon']
    #print(lat)
    #print(lon)
    #print(lat[:])
    # extract lat/lon values (in degrees) to numpy arrays
    latvals = lat[:]; lonvals = lon[:] 
    # a function to find the index of the point closest pt
    # (in squared distance) to give lat/lon value.    
    iy_min, ix_min = getclosest_ij(latvals, lonvals, lati, loni)
    #print(iy_min)
    #print(ix_min)
    IND.append(var[:,iy_min,ix_min])
    incr=add_month(incr)
    
flattened_list = [y for x in IND for y in x]
start=datetime.datetime(yeari,monthi,day_start)
TIME=[]
for i in range(0,nb_days,1): 
 #   TIME.append((start+timedelta(days=i)).strftime(&quot;%Y-%m-%d&quot;))
    TIME.append((start+timedelta(days=i)))
dataFrame_NARR = pd.DataFrame({'Date': TIME, variable_name: flattened_list}, columns = ['Date',variable_name]) 
dataFrame_NARR = dataFrame_NARR.set_index('Date')   
dataFrame_NARR.head()
</code></pre>

<table>
<thead>
<tr>
<th align="left">Date</th>
<th align="right">Temperature maximale</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">2017-01-01 00:00:00</td>
<td align="right">-0.893957</td>
</tr>

<tr>
<td align="left">2017-01-02 00:00:00</td>
<td align="right">-1.53144</td>
</tr>

<tr>
<td align="left">2017-01-03 00:00:00</td>
<td align="right">-1.73783</td>
</tr>

<tr>
<td align="left">2017-01-04 00:00:00</td>
<td align="right">-0.240698</td>
</tr>

<tr>
<td align="left">2017-01-05 00:00:00</td>
<td align="right">-0.791754</td>
</tr>
</tbody>
</table>

<p>We save our DataFrame in csv.</p>

<pre><code class="language-python">dataFrame_NARR.to_csv('./DATA/NARR/NARR_'+station+'_1pt_'+str(variable)+'_'+ '{:02d}'.format(monthi) + str(yeari)+'_'+ '{:02d}'.format(monthf) + str(yearf)+'.csv')    
</code></pre>

<ul>
<li>Observation vs NARR
Now we have extracted our gridpoint near Montreal, we can compare these values with observations.<br /></li>
</ul>

<p>We will extract the data from the Montreal McTavish station and put them in the NARR dataFrame.</p>

<pre><code class="language-python">dataframe_station = pd.read_csv('./DATA/station/MONTREAL_TAVISH_tasmax_1948_2017.csv', header=None, names=['Maximum temperature: OBS'])
start = date(1948, 1, 1)
end = date(2017, 12, 31)
delta=(end-start) 
nb_days = delta.days + 1 
rng = pd.date_range(start, periods=nb_days, freq='D')

dataframe_station['datetime'] = rng
dataframe_station.index = dataframe_station['datetime'] 
dataframe_station = dataframe_station.drop([&quot;datetime&quot;], axis=1)
</code></pre>

<pre><code class="language-python">dataframe_station.head()
</code></pre>

<table>
<thead>
<tr>
<th align="left">datetime</th>
<th align="right">Maximum temperature: OBS</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">1948-01-01 00:00:00</td>
<td align="right">-10</td>
</tr>

<tr>
<td align="left">1948-01-02 00:00:00</td>
<td align="right">-3.9</td>
</tr>

<tr>
<td align="left">1948-01-03 00:00:00</td>
<td align="right">-0.6</td>
</tr>

<tr>
<td align="left">1948-01-04 00:00:00</td>
<td align="right">-2.8</td>
</tr>

<tr>
<td align="left">1948-01-05 00:00:00</td>
<td align="right">-2.2</td>
</tr>
</tbody>
</table>

<pre><code class="language-python">dataFrame_NARR = dataFrame_NARR.rename(columns={&quot;Temperature maximale&quot;: &quot;Maximum temperature: NARR&quot;})
df_NARR_Station = pd.concat([dataframe_station,dataFrame_NARR],axis=1)
df_NARR_Station.tail()
</code></pre>

<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">Maximum temperature: OBS</th>
<th align="right">Maximum temperature: NARR</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">2017-12-27 00:00:00</td>
<td align="right">-17.6</td>
<td align="right">-18.819</td>
</tr>

<tr>
<td align="left">2017-12-28 00:00:00</td>
<td align="right">-20.5</td>
<td align="right">-19.3721</td>
</tr>

<tr>
<td align="left">2017-12-29 00:00:00</td>
<td align="right">-18.4</td>
<td align="right">-16.4532</td>
</tr>

<tr>
<td align="left">2017-12-30 00:00:00</td>
<td align="right">-17.3</td>
<td align="right">-16.2088</td>
</tr>

<tr>
<td align="left">2017-12-31 00:00:00</td>
<td align="right">-18.3</td>
<td align="right">-16.7728</td>
</tr>
</tbody>
</table>

<p>We want to plot valeurs for 2016 and 2017 years.</p>

<pre><code class="language-python">df=df_NARR_Station.loc['2016' : '2017']
df.head()
</code></pre>

<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">Maximum temperature: OBS</th>
<th align="right">Maximum temperature: NARR</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">2016-01-01 00:00:00</td>
<td align="right">-0.1</td>
<td align="right">nan</td>
</tr>

<tr>
<td align="left">2016-01-02 00:00:00</td>
<td align="right">0.4</td>
<td align="right">nan</td>
</tr>

<tr>
<td align="left">2016-01-03 00:00:00</td>
<td align="right">0.2</td>
<td align="right">nan</td>
</tr>

<tr>
<td align="left">2016-01-04 00:00:00</td>
<td align="right">-13.5</td>
<td align="right">nan</td>
</tr>

<tr>
<td align="left">2016-01-05 00:00:00</td>
<td align="right">-7.5</td>
<td align="right">nan</td>
</tr>
</tbody>
</table>

<pre><code class="language-python">import matplotlib.pyplot as plt
color = ['black', 'red']
fig = plt.figure(figsize=(16,8))
plt.plot(df.index, df['Maximum temperature: NARR'][:],  label='NARR Temperature', linewidth=2, c=color[0])
plt.plot(df.index, df['Maximum temperature: OBS'][:],  label='Observation Temperature', linewidth=2, c=color[1])

# Autre méthode pour tracer avec Pandas
#df_NARR_Station['2017'].plot(figsize=(10,5))

plt.xlabel(&quot;Time&quot;)
plt.ylabel(&quot;Temperature&quot;, {'color': 'black', 'fontsize': 10})
plt.title(&quot;Time serie: Station MTL vs NARR&quot;, y=1.05)
plt.legend(loc='upper left', ncol=1, bbox_to_anchor=(0, 1, 1, 0),fontsize =10)
plt.savefig(&quot;figures/NARR_time_Serie_temperature.png&quot;, dpi=300, bbox_inches='tight')   # bbox_inches= : option qui permet de propostionner le graphique lors de l'enregistrement
plt.show()

</code></pre>

<p><img src="/img/netcdf/NARR_time_Serie_temperature.png" alt="png" /></p>

<ul>
<li><p>Example of using the <b> .rolling () &lt;/ b&gt; function to calculate a moving average on a signal.</p>

<pre><code class="language-python">import matplotlib.pyplot as plt
df_NARR_Station['rollingmean5 Station']=  df_NARR_Station['Maximum temperature: OBS'].rolling(window=5).mean()
df_NARR_Station['rollingmean5 NARR']=  df_NARR_Station['Maximum temperature: NARR'].rolling(window=5).mean()
df_NARR_Station.tail()
</code></pre></li>
</ul>

<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">Maximum temperature: OBS</th>
<th align="right">Maximum temperature: NARR</th>
<th align="right">rollingmean5 Station</th>
<th align="right">rollingmean5 NARR</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">2017-12-27 00:00:00</td>
<td align="right">-17.6</td>
<td align="right">-18.819</td>
<td align="right">-8.04</td>
<td align="right">-8.31893</td>
</tr>

<tr>
<td align="left">2017-12-28 00:00:00</td>
<td align="right">-20.5</td>
<td align="right">-19.3721</td>
<td align="right">-11.12</td>
<td align="right">-11.0995</td>
</tr>

<tr>
<td align="left">2017-12-29 00:00:00</td>
<td align="right">-18.4</td>
<td align="right">-16.4532</td>
<td align="right">-13.88</td>
<td align="right">-13.6478</td>
</tr>

<tr>
<td align="left">2017-12-30 00:00:00</td>
<td align="right">-17.3</td>
<td align="right">-16.2088</td>
<td align="right">-16.12</td>
<td align="right">-15.6138</td>
</tr>

<tr>
<td align="left">2017-12-31 00:00:00</td>
<td align="right">-18.3</td>
<td align="right">-16.7728</td>
<td align="right">-18.42</td>
<td align="right">-17.5252</td>
</tr>
</tbody>
</table>

<pre><code class="language-python">df_NARR_Station['2017-01':'2017-12'].plot(figsize=(16,8))
plt.xlabel(&quot;Temps&quot;)
plt.ylabel(&quot;Température&quot;)
plt.title(&quot;Maximum temperature time serie: Station MTL vs NARR&quot;, y=1.05)
plt.savefig(&quot;figures/NARR_time_Serie_temperature2.png&quot;, dpi=300, bbox_inches='tight')   # bbox_inches= : option qui permet de propostionner le graphique lors de l'enregistrement
plt.show()
</code></pre>

<p><img src="/img/netcdf/NARR_time_Serie_temperature2.png" alt="png" /></p>

          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/tutorial_python_netcdf/2-netcdf_tutorial_2/" rel="prev">2 Netcdf Part 2</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on May 5, 2019</p>

          





  
  

<p class="edit-page">
  <a href="https://github.com/gcushen/hugo-academic/edit/master/content/courses/Tutorial_Python_Netcdf/1-Netcdf_Tutorial.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

      
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.bcfae8267aba63cc55af53a503896bd9.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
